(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[   1085095,      27295]
NotebookOptionsPosition[   1052090,      26854]
NotebookOutlinePosition[   1052485,      26870]
CellTagsIndexPosition[   1052442,      26867]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Clear", "[", "\"\<`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]}], "Input",
 CellLabel->
  "In[223]:=",ExpressionUUID->"35414358-9cce-404a-b33a-abdb7a6986c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{
    "{", "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/pic_1d/\
05_light_propagation_in_free_space/data\>\"", "}"}], "]"}]}], ";"}]], "Input",\

 CellLabel->
  "In[225]:=",ExpressionUUID->"98642d0f-5832-45f9-b8ed-04467496a470"],

Cell[BoxData[
 RowBox[{"Get", "[", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<.\>\"", ",", "\"\<imports.wl\>\""}], "}"}], "]"}], 
  "]"}]], "Input",
 CellLabel->
  "In[226]:=",ExpressionUUID->"2a987feb-7c03-4ce2-aad6-c20c5afee12a"],

Cell[CellGroupData[{

Cell["PIC_1D", "Section",ExpressionUUID->"9b762f27-4219-427f-9e79-ed8f4cdb4c7f"],

Cell[CellGroupData[{

Cell["01_whistler_dispersion", "Subsection",ExpressionUUID->"7a848a5a-aba4-4b48-a057-e00fb269e622"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"c6776fc6-170e-4c85-8be8-fb0455cd75f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[35]:=",ExpressionUUID->"0a3b8942-02d9-4e97-b7a4-fde7759b5922"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->"In[36]:=",ExpressionUUID->"7cb0b11d-5057-4184-96b5-71e03da3d996"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->"In[37]:=",ExpressionUUID->"b09a43c0-ee69-41ea-9af1-337d08b98870"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->"In[38]:=",ExpressionUUID->"d91caf77-0cde-4350-bdc1-36afcbcbc488"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[39]:=",ExpressionUUID->"61d0a445-f7fd-40bd-a08d-4749f3a3b19a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[40]:=",ExpressionUUID->"55deacc0-898f-4621-8934-8d58830930c0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"fe45854c-eb52-4c34-804d-e0fa09830067"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[67]:=",ExpressionUUID->"6a0638a8-aaee-4965-be25-1670ff82ffc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[68]:=",ExpressionUUID->"50a9efda-d764-4a41-82a5-3c129608138d"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->"In[69]:=",ExpressionUUID->"eebd8508-0302-44e4-af48-83820ff9683f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[70]:=",ExpressionUUID->"d92d7554-db5f-46aa-852f-7cf228ebb7c6"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[71]:=",ExpressionUUID->"16b8b2f9-aaad-4475-989d-1bd4692e16ce"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"d23e26ea-413a-4d7d-a17f-d7078d878b09"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[72]:=",ExpressionUUID->"fc6b6562-aa0c-4781-95a6-ed21fe4d8940"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[73]:=",ExpressionUUID->"c264884a-1e5f-4535-8ae2-8d0f087025ef"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->"In[74]:=",ExpressionUUID->"09442f77-de8b-4de7-840e-c972682d3590"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->"In[75]:=",ExpressionUUID->"3f35607c-0b71-4b14-b0f7-42e245994ba0"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[76]:=",ExpressionUUID->"ee0dc67b-1e6b-40e0-bb53-9e34106fa2ef"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[77]:=",ExpressionUUID->"f87b0d0a-1294-4226-874c-71f40e5b80a7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"f930aad0-3d2f-4c25-be79-99f24e19ae52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[78]:=",ExpressionUUID->"5e1a0dcd-43e9-42f1-a326-c312f75028d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[79]:=",ExpressionUUID->"2a16fd78-b5a6-4541-90fb-a4c692ea3424"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[80]:=",ExpressionUUID->"67cbd786-f700-4c50-b56e-b0ae355c4c92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->"In[81]:=",ExpressionUUID->"4f76be3a-5844-407a-9dee-966685d6f2c1"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[83]:=",ExpressionUUID->"61b094eb-e36e-4616-baa5-ffa29ccc27ef"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"9e31b8e6-9d24-40eb-8f28-e4b857c4fb31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[84]:=",ExpressionUUID->"9b3ea0d2-447c-4220-bfa7-2aab7846efae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[85]:=",ExpressionUUID->"cd506471-4841-4afd-be44-513875af4e36"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->"In[86]:=",ExpressionUUID->"88615e18-c871-4c47-a251-720bcf61486f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[87]:=",ExpressionUUID->"83075589-4a05-4595-b05d-f1b5d38dc115"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["02_mirror_motion", "Subsection",ExpressionUUID->"12ff51a1-f2a2-4258-a9e0-30b1754a91dd"],

Cell[CellGroupData[{

Cell["Setup", "Subsubsection",ExpressionUUID->"ad406739-b333-4148-b0bf-19f0911d6e7a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileBorisC", "]"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"non", "-", "relativistic"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compileBorisC", "[", 
   RowBox[{
    RowBox[{"B0", ":", 
     RowBox[{"{", "__Real", "}"}]}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "B0", "]"}], "==", "3"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", "=", "1.*^-5"}], "}"}], ",", "\n", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cE", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dB", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dt", ",", "_Real"}], "}"}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v0", ",", "cE", ",", "dB", ",", "dt"}], "}"}], ","}]}], 
       "*)"}], "\n", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[DoubleStruckT]", "=", 
           RowBox[{".5", "dt", " ", 
            RowBox[{"(", 
             RowBox[{"B0", "+", "dB"}], ")"}]}]}], ",", 
          RowBox[{"v", "=", "v0"}], ",", "t", ",", "\[DoubleStruckB]", ",", 
          "v1"}], "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}], ";", "\n", 
         RowBox[{"v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"\[DoubleStruckT]", ".", "\[DoubleStruckT]"}], 
                "]"}]}], ")"}], "<", "\[Epsilon]"}], ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"small", " ", "angle", " ", "expantion"}], "*)"}], "\n", 
            
            RowBox[{
             RowBox[{"Times", "[", 
              RowBox[{"2", ",", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{"v", ",", "\[DoubleStruckT]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"v", ".", "\[DoubleStruckT]"}], " ", 
                 "\[DoubleStruckT]"}], "-", 
                RowBox[{
                 RowBox[{"t", "^", "2"}], "v"}]}]}], "]"}], "+", "v"}], "\n", 
            ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"exact", " ", "solution"}], "*)"}], "\n", 
            RowBox[{
             RowBox[{"\[DoubleStruckB]", "=", 
              RowBox[{"\[DoubleStruckT]", "/", "t"}]}], ";", "\n", 
             RowBox[{"v1", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"v", ".", "\[DoubleStruckB]"}], ")"}], 
               "\[DoubleStruckB]"}]}], ";", "\n", 
             RowBox[{"v1", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v", "-", "v1"}], ")"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"2", "t"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"Cross", "[", 
                  RowBox[{"v", ",", "\[DoubleStruckB]"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"2", "t"}], "]"}]}]}], ")"}]}]}]}], "\n", "]"}]}], 
         ";", "\n", 
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}]}]}], "\n", "]"}]}], "\n", "]"}]}],
    "\n", "]"}]}]}], "Input",
 CellLabel->"In[72]:=",ExpressionUUID->"1114d31a-7b88-451c-93cf-353ef1b2240a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "compileMirrorField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileMirrorField", "[", 
   RowBox[{
    RowBox[{"B0_", "?", "Positive"}], ",", 
    RowBox[{"\[Xi]_", "?", "NonNegative"}]}], "]"}], ":=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"xyz", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", "xyz"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"\[Xi]", "^", "2"}], 
            RowBox[{"x", "^", "2"}]}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "y"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "z"}]}], "}"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"RuntimeAttributes", "\[Rule]", 
     RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->"In[74]:=",ExpressionUUID->"7cb87010-c713-486e-b15e-b7878b4e3067"],

Cell[BoxData[
 RowBox[{"figure", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[CapitalOmega]0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Omega]b0", "=", 
       RowBox[{".05", "*", "2", "Pi"}]}], ",", 
      RowBox[{"x0", "=", "0"}], ",", 
      RowBox[{"v0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Alpha]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"60", "Degree"}], "]"}]}], ",", 
      RowBox[{"\[Phi]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CapitalOmega]0", "=", "1"}], ",", 
         RowBox[{"\[Omega]b0", "=", ".05"}], ",", 
         RowBox[{"x0", "=", "0"}], ",", 
         RowBox[{"v0", "=", "1"}], ",", 
         RowBox[{"\[Alpha]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"60", "Degree"}], "]"}]}], ",", 
         RowBox[{"\[Phi]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ","}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Xi]", ",", "mirrorField", ",", "boris", ",", "\[CapitalDelta]t", 
        ",", "nt", ",", "vv", ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Xi]", "=", 
        RowBox[{"\[Omega]b0", "/", "v0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mirrorField", "=", 
        RowBox[{"compileMirrorField", "[", 
         RowBox[{"\[CapitalOmega]0", ",", "\[Xi]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boris", "=", 
        RowBox[{"compileBorisC", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], "//", "N"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]t", "=", 
        RowBox[{"2.", 
         RowBox[{
          RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", "100"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nt", "=", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"2.", 
            RowBox[{
             RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", 
             "\[CapitalDelta]t"}]}], ",", 
           RowBox[{"1", 
            RowBox[{"\[CapitalOmega]0", "/", "\[Omega]b0"}]}]}], "]"}], "//", 
         "Ceiling"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vv", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"Cos", "[", "\[Alpha]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Cos", "[", "\[Phi]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Sin", "[", "\[Phi]0", "]"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", "=", "x0"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "vv"}], "}"}], "=", 
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"xx", "=", 
                  RowBox[{"xx", "-", 
                   RowBox[{"Divide", "[", 
                    RowBox[{
                    RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"mirrorField", "[", "xx", "]"}], "]"}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"xx", "-", 
                 RowBox[{"Divide", "[", 
                  RowBox[{
                   RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                   RowBox[{"\[CapitalOmega]0", 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Xi]", "^", "2"}], 
                    RowBox[{"x", "^", "2"}]}]}], ")"}]}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"boris", "[", 
                 RowBox[{"vv", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"mirrorField", "[", "xx", "]"}], ",", 
                  "\[CapitalDelta]t"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "vv"}], "}"}]}]}], "\[IndentingNewLine]", 
             "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "vv"}], "}"}], ",", "nt"}], "]"}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{"x", ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->"In[76]:=",ExpressionUUID->"cc12956e-a916-45dd-b0b6-3ca21bbe03a6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"0f2fe521-d50b-4664-bd75-9161ecf7cade"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[87]:=",ExpressionUUID->"6e4dccb9-c148-4c83-bfc1-71b49b7c7a17"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particles", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"importParticle", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time\>\"", ",", "\"\<q1\>\"", ",", "\"\<v1\>\"", ",", 
               "\"\<v2\>\"", ",", "\"\<v3\>\""}], "}"}]}], "]"}], "&"}], "/@",
           "files"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", 
              RowBox[{"Merge", "[", 
               RowBox[{"assoc", ",", "Identity"}], "]"}]}], "]"}]}], "}"}], 
          ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[88]:=",ExpressionUUID->"50b21277-8b1a-4283-8497-706b1807f865"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particles"}]], "Input",
 CellLabel->"In[89]:=",ExpressionUUID->"3abf6406-9d86-4bb0-952c-855ed67b8069"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"particles", "=", "particles"}], ",", 
     RowBox[{"figure", "=", "figure"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"particles", "[", "\"\<xi\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<q1\>\"", "]"}]}], "]"}], "/", 
        RowBox[{"particles", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v1\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}]}],
            "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v2\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}]}],
            "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v3\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}]}],
            "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"xx", ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}]}],
            "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[90]:=",ExpressionUUID->"f628baa5-467e-4b60-80b8-8ebbdff606d3"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["03_equilibrium_distribution", "Subsection",ExpressionUUID->"248cf7f7-060d-49b2-a43c-a6f21b548731"],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"59c51e44-867f-41f8-8066-ba8064fc41aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[49]:=",ExpressionUUID->"d5761db1-3e45-4022-b3e8-3467bb2f9466"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[50]:=",ExpressionUUID->"90c1b668-6319-463f-b2d4-9c305aff5f03"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[51]:=",ExpressionUUID->"820bc3e5-ae74-46bb-a9d9-12f06423fe43"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->"In[52]:=",ExpressionUUID->"b54cfed9-213d-4bbf-9080-b631f1ac11aa"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"T2OT1eq", "=", "2.111"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "mom0", ",", "P1", ",", "P2", ",", "P3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{"T2OT1eq", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "T2OT1eq"}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "\[Eta]s"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"\[Eta]s", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{
                RowBox[{"\[Eta]s", "^", "2"}], " ", "\[Beta]1", " ", 
                RowBox[{"T2OT1eq", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[53]:=",ExpressionUUID->"88b7a3e5-0f6e-4e13-8a67-4e97dc72534c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[54]:=",ExpressionUUID->"ed495d52-317f-4333-9c46-918e8314cd61"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[55]:=",ExpressionUUID->"85176739-00db-418c-b80d-f35a2246377c"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->"In[56]:=",ExpressionUUID->"eca78e2d-0140-4b23-b259-bfb1dfc46a05"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"\[Theta]2O\[Theta]1eq", "=", 
      SqrtBox["2.111"]}], ",", 
     RowBox[{"\[Beta]eq", "=", ".8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "\[Eta]\[Beta]s", ",", "ns", ",", "mom0", ",", "P1", ",", "P2", ",", 
       "P3"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]\[Beta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Beta]eq", " ", 
           RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Beta]eq", " ", 
              RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]s", "-", 
          RowBox[{"\[Beta]eq", " ", "\[Eta]\[Beta]s"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "-", "\[Beta]eq"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "\[Eta]s", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]s", "/", "\[Eta]s"}]}]}], ")"}]}]}], 
              "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[57]:=",ExpressionUUID->"6aebea96-f446-48e0-a65c-a2c94c842a59"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "3"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[58]:=",ExpressionUUID->"0e502284-8c90-40ee-9d2c-f2f775a156ad"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[59]:=",ExpressionUUID->"806fd733-6a12-48a7-b7d8-4af70947331e"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->"In[64]:=",ExpressionUUID->"755d9e82-3aa6-4d8c-8d6a-ba8dd4d6aef9"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]", "=", "1.1"}], ",", 
     RowBox[{"\[Zeta]", "=", "5"}], ",", 
     RowBox[{"vs", "=", "1.8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", "ns",
        ",", "\[Theta]", ",", "b", ",", "Ab", ",", "Bz", ",", "T", ",", 
       "mom0", ",", "P1", ",", "P2", ",", "P3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Power", "[", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], ",", 
         "\[Zeta]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", "\[Eta]s"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", "=", 
       SqrtBox["\[Beta]"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"vs", "/", "\[Theta]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ab", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{".5", "+", 
             RowBox[{"b", "^", "2"}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bz", "=", 
       RowBox[{
        SqrtBox["\[Pi]"], 
        RowBox[{
         RowBox[{"Gamma", "[", 
          RowBox[{"1", "+", 
           RowBox[{".5", "\[Zeta]"}]}], "]"}], "/", 
         RowBox[{"Gamma", "[", 
          RowBox[{"1.5", "+", 
           RowBox[{".5", "\[Zeta]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T", "=", 
       RowBox[{".5", 
        RowBox[{"\[Beta]", "/", "Ab"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", 
           RowBox[{"(", 
            RowBox[{"2.5", "+", 
             RowBox[{"b", "^", "2"}]}], ")"}], 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{".75", "+", 
             RowBox[{
              RowBox[{"b", "^", "2"}], 
              RowBox[{"(", 
               RowBox[{"3", "+", 
                RowBox[{"b", "^", "2"}]}], ")"}]}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", 
                RowBox[{"T", "/", 
                 RowBox[{"(", 
                  RowBox[{"3", "+", "\[Zeta]"}], ")"}]}]}]}], "}"}], "]"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", "T", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   RowBox[{".5", "\[Zeta]"}]}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"3", "+", "\[Zeta]"}], ")"}]}]}]}], "}"}], "]"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[61]:=",ExpressionUUID->"2b0c24c7-6ab8-46d5-a4cf-42f65ab7ed4c"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["04_whistler_anisotropy_instability", "Subsection",ExpressionUUID->"955fbcbb-48d3-4368-8872-f36084005a11"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"5640419b-9a82-493a-8d96-a2d1db72643b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[765]:=",ExpressionUUID->"12637b7e-e12c-4bf0-acd8-41638ea1e41b"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[766]:=",ExpressionUUID->"8a93c410-5263-4a24-8541-9d32bf379ad9"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[767]:=",ExpressionUUID->"f984cbe1-ad2a-476e-b620-aa87cabf7cec"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[768]:=",ExpressionUUID->"188d3419-2be7-49d4-9bb3-5958dde61bb7"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[769]:=",ExpressionUUID->"d424de56-a667-443c-954f-a5fc3e9f96b8"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[770]:=",ExpressionUUID->"682be251-c085-4aee-8504-689ae093cd2f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"23e6502a-800d-42cf-8ca8-b08a5f40718b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[771]:=",ExpressionUUID->"0d699bc1-c4d0-4660-bd73-3427e4cf0fa4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", "assoc"}], "}"}], ",", "Last"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"5a64f3ab-9a51-4646-90fa-0e49edf304fa"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[773]:=",ExpressionUUID->"66ec21cd-6578-43a2-9181-f9d3dbfba81c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"partspec", "=", 
      RowBox[{"{", 
       RowBox[{"100", ",", "25"}], "}"}]}], ",", 
     RowBox[{"sampleLocs", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "150", ",", "300", ",", "450"}], "}"}]}], ",", 
     RowBox[{"\[Omega]max", "=", "1.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "fullgrid", ",", "dB3", ",", "dB2", ",", "dB", 
       ",", "\[Omega]t", ",", "pos\[Omega]", ",", "w", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"partspec", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"$_Real", "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullgrid", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"fullgrid", ",", 
            RowBox[{
             RowBox[{"post", "[", 
              RowBox[{"field", "[", "\"\<dB2\>\"", "]"}], "]"}], 
             "\[Transpose]"}]}], "}"}], "]"}], "]"}], "[", "sampleLocs", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"fullgrid", ",", 
            RowBox[{
             RowBox[{"post", "[", 
              RowBox[{"field", "[", "\"\<dB3\>\"", "]"}], "]"}], 
             "\[Transpose]"}]}], "}"}], "]"}], "]"}], "[", "sampleLocs", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{"dB2", "-", 
        RowBox[{"I", " ", "dB3"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"partspec", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", 
          RowBox[{"partspec", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pos\[Omega]", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", 
                RowBox[{"w", "*", "#"}], "]"}]}], ",", "2"}], "]"}]}], "&"}], 
          ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Sequence", "@@", "partspec"}]}], "]"}], "&"}], "/@", 
           "dB"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"t", ",", 
          RowBox[{"Sequence", "@@", "partspec"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "dB", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Dashed", ",", "\[IndentingNewLine]", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", ".5"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", ".5"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"Map", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ArrayPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Transpose", "[", "#", "]"}], "//", "Reverse"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"DataRange", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"\[Omega]t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
            "\[IndentingNewLine]", "]"}], "&"}], ",", "\[IndentingNewLine]", 
          "dB"}], "\[IndentingNewLine]", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Grid", "[", 
         RowBox[{"plots", "~", "Partition", "~", "2"}], "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[774]:=",ExpressionUUID->"903fd496-7496-46ac-ab37-e7ccfdab71a7"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[775]:=",ExpressionUUID->"e0ef405b-4ed3-412e-bae4-868dbc8abff6"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[776]:=",ExpressionUUID->"1ee23c6d-40aa-44f9-a989-44066e393b5c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"d05201f4-17f4-41a5-a674-9c71b2a3a94f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[777]:=",ExpressionUUID->"280ee7ad-8f60-4372-8f53-149a87f6a148"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"6bcca795-\
4a19-48fd-af95-74ce699bdbf4"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[779]:=",ExpressionUUID->"79873bb0-41eb-4523-a46b-9209e405ddc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[780]:=",ExpressionUUID->"dd84f8c4-f914-448e-9a2f-deeb0f848c11"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "q1", ",", "posx", ",", "P1", ",", "P2", ",", 
       "P3", ",", "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"t", ",", 
           RowBox[{"$_Real", "/;", 
            RowBox[{"IntervalMemberQ", "[", 
             RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ";;", "1", ";;", 
           RowBox[{"-", "5"}]}], "]"}], "]"}], "//", "Reverse"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"q1", ",", 
         RowBox[{"_Real", "?", "NonNegative"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "posx", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of q1lim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"posx", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"q1", "//", "posx"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nv1v1\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nv2v2\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nv3v3\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"P1", ",", "P2", ",", "P3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P1", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P2", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P3", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"P1", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\!\(\*SuperscriptBox[\(q\), \(1\)]\)\\)\>\"", ",", 
               "\"\<\\!\\(t \!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<\!\(\*SubscriptBox[\(P\), \
\(\[DoubleVerticalBar]\)]\)\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".03", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"P2", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\!\(\*SuperscriptBox[\(q\), \(1\)]\)\\)\>\"", ",", 
               "\"\<\\!\\(t \!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<\!\(\*SubscriptBox[\(P\), \(\(\[UpTee]\)\(1\)\)]\)\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".03", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[781]:=",ExpressionUUID->"b0f67790-64fc-4a40-acb7-ee42cc9fe71f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[782]:=",ExpressionUUID->"7f2f7c20-0847-401a-9f3e-d04dcc4d2cfe"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[783]:=",ExpressionUUID->"bfc11b4e-073a-4ee0-9101-f64acc8a8f9f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"ffde4ce8-cb71-4a16-83ef-b75f6bd17a4c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[784]:=",ExpressionUUID->"c252d70d-bdfb-4258-afad-5992cc455b92"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"772be807-\
8d69-41b5-8b01-dd79a2fe26d6"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[786]:=",ExpressionUUID->"e9cd32b8-e19b-4cf0-8a4c-18e674a314bd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{"1.3", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[787]:=",ExpressionUUID->"7af93b55-dfc6-468d-aa94-ffbfff2e7923"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".1"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[789]:=",ExpressionUUID->"845efa36-916e-4653-8549-8139f3cef155"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"1dd12eef-ba26-416a-82bb-6436906c4e69"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[790]:=",ExpressionUUID->"1a1c4cf9-29b8-4ef7-b3d1-6196dbc07f60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"60ccddad-\
f998-4bf9-8641-1e49d66102b7"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[792]:=",ExpressionUUID->"50bed9eb-d3fe-402d-a16a-78c79aa4faf3"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{".1", "/", "100"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[795]:=",ExpressionUUID->"f3a925a6-b4b3-4ca0-a177-724ccdff4f87"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["05_light_propagation_in_free_space", "Subsection",ExpressionUUID->"11ac30f6-f7b3-408e-8e98-764df1779594"],

Cell[TextData[{
 "1D wave equation for the electric field:\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox["c", "2"], 
      FractionBox[
       RowBox[{
        SuperscriptBox["\[PartialD]", "2"], "\[DoubleStruckCapitalE]"}], 
       RowBox[{"\[PartialD]", 
        SuperscriptBox["x", "2"]}]]}], "-", 
     FractionBox[
      RowBox[{
       SuperscriptBox["\[PartialD]", "2"], "\[DoubleStruckCapitalE]"}], 
      RowBox[{"\[PartialD]", 
       SuperscriptBox["t", "2"]}]]}], "=", 
    FractionBox[
     RowBox[{"\[PartialD]", "\[DoubleStruckJ]"}], 
     RowBox[{"\[PartialD]", "t"}]]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "05f5c938-7d4f-48f4-a8f2-9b9cdb747f8d"],
 ".\nSuppose the driving current is given by\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckJ]", "(", 
     RowBox[{"x", ",", "t"}], ")"}], "=", 
    RowBox[{
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     SuperscriptBox["\[DoubleStruckE]", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Nu]", " ", "t"}]], 
     RowBox[{"\[Delta]", "(", "x", ")"}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "376a814c-6498-43f4-96de-e023bf784b41"],
 ".\nAssuming ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", 
     RowBox[{"x", ",", "t"}], ")"}], "=", 
    RowBox[{
     RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], 
     SuperscriptBox["\[DoubleStruckE]", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Omega]", " ", "t"}]]}]}], 
   TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "b82cfe6d-0808-4408-b899-44b951b1ff4a"],
 " and ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Nu]", "=", "\[Omega]"}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "bbdc4161-b53d-4d60-bfcd-0f951dc89ada"],
 ",\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox["c", "2"], 
      FractionBox[
       RowBox[{
        SuperscriptBox["\[PartialD]", "2"], "\[DoubleStruckCapitalE]"}], 
       RowBox[{"\[PartialD]", 
        SuperscriptBox["x", "2"]}]]}], "+", 
     RowBox[{
      SuperscriptBox["\[Omega]", "2"], "\[DoubleStruckCapitalE]"}]}], "=", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Omega]", " ", 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Delta]", "(", "x", ")"}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "3d5b182f-75db-457c-bdbe-db58aa49a202"],
 ".\nUsing the Fourier transformation,\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], "=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Pi]"}]], 
     RowBox[{"\[Integral]", 
      RowBox[{
       RowBox[{"\[DoubleStruckCapitalE]", "(", "k", ")"}], 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "7637423c-fee2-49fb-b9d6-848e41450912"],
 " and ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Delta]", "(", "x", ")"}], "=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Pi]"}]], 
     RowBox[{"\[Integral]", 
      RowBox[{
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "e54d568f-59d6-4ac8-8d46-10f31503dfcb"],
 ",\nthe wave equation in Fourier space reads\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["\[Omega]", "2"], "-", 
       RowBox[{
        SuperscriptBox["c", "2"], 
        SuperscriptBox["k", "2"]}]}], ")"}], 
     RowBox[{"\[DoubleStruckCapitalE]", "(", "k", ")"}]}], "=", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Omega]", " ", 
     SubscriptBox["\[DoubleStruckJ]", "0"]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "987c82a4-0f69-4d1d-b5e0-da343fe39edd"],
 ".\nThe electric field is then\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "k", ")"}], "=", 
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", 
       SuperscriptBox["\[Omega]", "2"]]}], 
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", "\[Omega]"}], 
      RowBox[{"1", "+", "n"}]], 
     FractionBox["1", 
      RowBox[{"1", "-", "n"}]], " ", 
     SubscriptBox["\[DoubleStruckJ]", "0"]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "6f32caf5-aa59-4ba6-bbae-20f124344139"],
 ",\nwhere ",
 Cell[BoxData[
  FormBox[
   RowBox[{"n", "=", 
    RowBox[{"c", " ", 
     RowBox[{"k", "/", "\[Omega]"}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "3e3a8fc3-ad51-4edb-90c2-47c9c12373d3"],
 ".\nIn the real space,\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], "=", 
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", 
       SuperscriptBox["\[Omega]", "2"]]}], 
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", "\[Omega]"}], 
      RowBox[{"2", "\[Pi]"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       FractionBox["1", 
        RowBox[{"1", "-", "n"}]], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], TraditionalForm]],
  FormatType->TraditionalForm,ExpressionUUID->
  "33807e67-421f-4dd5-b1f5-0b4e63cceed0"],
 ".\nUsing the \[Delta]-function identity,\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["lim", 
      RowBox[{"\[Epsilon]", "\[Rule]", 
       SuperscriptBox["0", "+"]}]], 
     FractionBox["1", 
      RowBox[{"x", "\[PlusMinus]", 
       RowBox[{"\[ImaginaryI]", " ", "\[Epsilon]"}]}]]}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"\[MinusPlus]", "\[ImaginaryI]"}], " ", "\[Pi]", 
      "\[VeryThinSpace]", 
      RowBox[{"\[Delta]", "(", "x", ")"}]}], "+", 
     RowBox[{"\[ScriptCapitalP]", "(", 
      FractionBox["1", "x"], ")"}]}]}], TraditionalForm]],ExpressionUUID->
  "2dffd0f0-ef82-4c62-85a1-162c1916d4c2"],
 " (Plemelj's formula) and ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Delta]", "(", 
     RowBox[{"\[Phi]", "(", "x", ")"}], ")"}], "=", 
    RowBox[{
     SubscriptBox["\[Sum]", "j"], 
     FractionBox[
      RowBox[{"\[Delta]", "(", 
       RowBox[{"x", "-", 
        SubscriptBox["x", "j"]}], ")"}], 
      RowBox[{"\[LeftBracketingBar]", 
       RowBox[{
        RowBox[{"\[Phi]", "'"}], 
        RowBox[{"(", 
         SubscriptBox["x", "j"], ")"}]}], "\[RightBracketingBar]"}]]}]}], 
   TraditionalForm]],ExpressionUUID->"c0c45be3-51df-4fd7-b4e2-a9678949dfe2"],
 ", \n",
 Cell[BoxData[{
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], "=", 
    RowBox[{
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", "\[Omega]"}], 
      RowBox[{"2", "\[Pi]"}]], 
     FractionBox["1", 
      SuperscriptBox["\[Omega]", "2"]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Pi]", "\[VeryThinSpace]", 
          RowBox[{"\[Delta]", "(", 
           RowBox[{"n", "-", "1"}], ")"}]}], "+", 
         RowBox[{"\[ScriptCapitalP]", "(", 
          FractionBox["1", 
           RowBox[{"n", "-", "1"}]], ")"}]}], ")"}], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Omega]"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"\[Delta]", "(", 
          RowBox[{"n", "-", "1"}], ")"}], "+", 
         RowBox[{"\[ImaginaryI]", " ", 
          RowBox[{"\[ScriptCapitalP]", "(", 
           FractionBox["1", 
            RowBox[{"n", "-", "1"}]], ")"}]}]}], ")"}], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Omega]"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       FractionBox[
        RowBox[{"\[LeftBracketingBar]", "\[Omega]", "\[RightBracketingBar]"}],
         "c"], 
       RowBox[{"\[Delta]", "(", 
        RowBox[{"k", "-", 
         RowBox[{"\[Omega]", "/", "c"}]}], ")"}], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"=", 
    RowBox[{
     FractionBox[
      RowBox[{"sign", "(", "\[Omega]", ")"}], 
      RowBox[{"4", "c"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     SuperscriptBox["\[ExponentialE]", 
      RowBox[{"\[ImaginaryI]", " ", 
       RowBox[{"\[Omega]", "/", "c"}], " ", "x"}]]}]}], TraditionalForm]}],
  FormatType->TraditionalForm,ExpressionUUID->
  "ec2ad197-e881-4185-910d-4f7a418eda8f"],
 "."
}], "Text",ExpressionUUID->"b6e89462-517a-4272-b1c8-9d3cff229ac2"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"83033dc3-03fe-494c-83f8-09a7cea38e20"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[34]:=",ExpressionUUID->"2e8b766d-de28-4724-a82e-57ce13041cc0"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->"In[35]:=",ExpressionUUID->"df84e1b8-9996-4549-9865-d8ca561e7844"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->"In[36]:=",ExpressionUUID->"2c1cc811-5c56-4e7d-b239-a909122267ca"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"e536acb6-4a1e-4aa4-95ad-c153a3c8e5d2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[91]:=",ExpressionUUID->"639fc146-ee71-401b-b564-530a8d923343"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", "assoc"}], "}"}], ",", "Last"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[92]:=",ExpressionUUID->"ec8856e0-822a-4821-9d37-d89f71c03e42"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->"In[93]:=",ExpressionUUID->"b29509a6-b8fd-4608-b022-c7e0bca85e64"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"field", "=", "field"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dB3", ",", "t", ",", "q1", ",", "max"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"Most", "[", 
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "dB3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB3", "/", "max"}], "+", "1"}], ")"}], "/", "2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Transpose", "[", "dB3", "]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Graphics", "[", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"Dashed", ",", "Black", ",", "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"150", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"FrameTicks", "->", "Automatic"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Large"}], ",", "\[IndentingNewLine]", 
          RowBox[{"AspectRatio", "->", 
           RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRangePadding", "->", 
           RowBox[{"Thread", "[", 
            RowBox[{"Scaled", "[", 
             RowBox[{".01", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"BarLegend", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<TemperatureMap\>\"", ",", 
           RowBox[{"max", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[94]:=",ExpressionUUID->"2b8505e6-36c9-40bf-89b6-9b84b4ac0b31"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tslice", "=", "150"}], ",", 
     RowBox[{"q1slice", "=", "0"}], ",", 
     RowBox[{"J0", "=", "0.04"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dB3", ",", "dB2", ",", "t", ",", "q1", ",", "x", ",", "post", ",", 
       "posq"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dB3", "=", 
       RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"t", "-", "tslice"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"Abs", "[", 
           RowBox[{"t", "-", "tslice"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "==", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"Extract", "[", 
          RowBox[{"post", "//", "First"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"Most", "[", 
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"field", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"field", "[", "\"\<xi\>\"", "]"}], "q1"}], "]"}], "/", 
        RowBox[{"field", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posq", "=", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"q1", "-", "q1slice"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"Abs", "[", 
           RowBox[{"q1", "-", "q1slice"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posq", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "posq", "]"}], "==", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no q1 selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"Extract", "[", 
          RowBox[{"posq", "//", "First"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{"#", ",", "\[IndentingNewLine]", 
          RowBox[{"Graphics", "[", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"Dashed", ",", "Black", ",", "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"J0", "/", "4"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"-", "J0"}], "/", "4"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Large"}], ",", "\[IndentingNewLine]", 
          RowBox[{"AspectRatio", "->", 
           RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRangePadding", "->", 
           RowBox[{"Thread", "[", 
            RowBox[{"Scaled", "[", 
             RowBox[{".01", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"GridLines", "->", "Automatic"}]}], "\[IndentingNewLine]", 
         "]"}], "&"}], "/@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"t", "-", "100"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"2", "Pi"}], ")"}]}], ",", 
                RowBox[{"posq", "/@", "dB2"}]}], "}"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"t", "-", "100"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"2", "Pi"}], ")"}]}], ",", 
                RowBox[{"posq", "/@", "dB3"}]}], "}"}], "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Directive", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"PlotLegends", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<dE2\>\"", ",", "\"\<dE3\>\""}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"70", ",", "200"}], "}"}], "-", "100"}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{"2", "Pi"}], ")"}]}], ",", "All"}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"post", "@", "dB2"}]}], "}"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"post", "@", "dB3"}]}], "}"}], "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Directive", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"PlotLegends", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<dE2\>\"", ",", "\"\<dE3\>\""}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "100"}], ",", "200"}], "}"}], ",", "All"}], 
             "}"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
         "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellLabel->"In[95]:=",ExpressionUUID->"d9fc689b-c383-4cc9-8df1-736bde95232d"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["REL_PIC_1D", "Section",ExpressionUUID->"163ba665-8fd0-405d-9580-3a36d2aa6564"],

Cell[CellGroupData[{

Cell["01_whistler_dispersion", "Subsection",ExpressionUUID->"0da3b5f0-b6f0-4c4c-8d28-cd56d6451203"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"0d1a11ea-b118-44af-ac1f-533e02602631"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "7"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", "mU2O2", 
         ",", "relKE"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"First", "[", "#", "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{
                RowBox[{"Rest", "[", "#", "]"}], ",", "3"}], "]"}], "]"}], 
             ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{
                RowBox[{"Rest", "[", "#", "]"}], ",", "3"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"relKE", ",", "mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}], ",", 
          RowBox[{"\"\<relKE\>\"", "->", "relKE"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[137]:=",ExpressionUUID->"8807c4e3-ec8d-496b-9639-11286153d68d"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[138]:=",ExpressionUUID->"3aecea53-b05d-49c4-9ec0-e3372b3169fa"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
        "relKE"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"relKE", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<relKE\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{"relKE", ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<(\[Gamma]-1)mc^2\>\""}], 
             ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", "relKE"}], 
               "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[139]:=",ExpressionUUID->"fd926f80-4ec6-41c0-af51-2d89552b2dc3"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[140]:=",ExpressionUUID->"b9d89e3d-c23a-4872-ab1d-d54f05e0260a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[141]:=",ExpressionUUID->"1645c18c-99fb-4bdc-b9b5-1e39bd48ed84"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[142]:=",ExpressionUUID->"9149625c-b2c0-4d94-81b2-316193133685"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"9d9a9dd3-2db6-4688-8aaf-7f6670fe20bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[143]:=",ExpressionUUID->"7147733f-960f-4fb6-bed6-867e0a542b88"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[144]:=",ExpressionUUID->"338b1c37-8c81-413b-99ad-14c9e76a4ca2"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[145]:=",ExpressionUUID->"69847ad8-f216-425c-a972-e228e75f5c75"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[146]:=",ExpressionUUID->"69300999-d15e-451f-b681-bd1f0845c765"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[147]:=",ExpressionUUID->"22e97311-975a-4a17-ad36-521ef11dd714"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"91571c8e-def2-4c33-85cb-150cadd3b274"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[148]:=",ExpressionUUID->"cf8d80ec-6943-4058-8466-6c887c362b2c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importStressEnergyTensor", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[149]:=",ExpressionUUID->"bfc2b61e-66d8-4145-bd3f-b202fa3bcce8"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[150]:=",ExpressionUUID->"039fc0d3-7707-4cfa-87ac-046b662f0765"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[151]:=",ExpressionUUID->"7861b5a9-720e-4095-9170-0b78abbfe05b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[152]:=",ExpressionUUID->"e463224c-a3e7-4bf7-8b01-b03a3e674d32"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[153]:=",ExpressionUUID->"bd9b575a-38d2-468a-8bf9-00babf562648"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"field", "[", "\"\<n\[Gamma]c2\>\"", "]"}], "/", 
                   RowBox[{
                    RowBox[{"moment", "[", "\"\<c\>\"", "]"}], "^", "2"}]}], 
                  "-", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]\[Gamma]\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[154]:=",ExpressionUUID->"b5778f75-0ad5-4cc6-9ac2-a7a9a42cf765"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[DoubleVerticalBar]\
\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\(\[UpTee]\)\(\
\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[155]:=",ExpressionUUID->"711d5ef3-7dd2-453a-800d-5a85fc5ec2d9"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"ffe42cc3-6ba8-4ec4-8498-21d8edeae960"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[156]:=",ExpressionUUID->"b8295a59-82b4-4bda-b891-af8ad09fc534"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[157]:=",ExpressionUUID->"bd1d3b2c-1931-4a6f-8aac-9a908d9457d6"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[158]:=",ExpressionUUID->"b45f13e5-b21b-4995-be2a-e1d67885a3d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[159]:=",ExpressionUUID->"22228e5a-54ce-4d1d-88bc-ac0c99d84e96"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[161]:=",ExpressionUUID->"bd0111ba-1892-4715-88c9-8c008983096f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"1c183399-e840-48c5-87bf-b3c0af7e4f2d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[162]:=",ExpressionUUID->"d4a5a1e2-853e-49b2-86d1-d212dacf8094"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[163]:=",ExpressionUUID->"928687ae-b547-43b3-8022-d43e9b39efd9"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[164]:=",ExpressionUUID->"0e16ba5b-12e6-47fc-a972-bfa6821bef98"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[165]:=",ExpressionUUID->"263ffaaf-ed62-470d-b8b9-6fe9c380897d"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["02_mirror_motion", "Subsection",ExpressionUUID->"dee97a49-9f34-42fe-a754-eb12502f33ac"],

Cell[CellGroupData[{

Cell["Setup", "Subsubsection",ExpressionUUID->"09e4d96b-96f9-4161-a973-0e4a57e332ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileBorisC", "]"}], "\n", 
  RowBox[{"(*", "relativistic", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compileBorisC", "[", 
   RowBox[{
    RowBox[{"c_Real", "?", "Positive"}], ",", 
    RowBox[{
     RowBox[{"B0", ":", 
      RowBox[{"{", "__Real", "}"}]}], "/;", 
     RowBox[{
      RowBox[{"Length", "[", "B0", "]"}], "==", "3"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", "=", "1.*^-5"}], "}"}], ",", "\n", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Gamma]v0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cE", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dB", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dt", ",", "_Real"}], "}"}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Gamma]v0", ",", "cE", ",", "dB", ",", "dt"}], "}"}], 
         ","}]}], "*)"}], "\n", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[DoubleStruckT]", "=", 
           RowBox[{".5", "dt", " ", 
            RowBox[{"(", 
             RowBox[{"B0", "+", "dB"}], ")"}]}]}], ",", 
          RowBox[{"\[Gamma]v", "=", "\[Gamma]v0"}], ",", "t", ",", 
          "\[DoubleStruckB]", ",", "v1", ",", "v"}], "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"\[Gamma]v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}], ";", "\n", 
         RowBox[{"\[DoubleStruckT]", "/=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"1", "+", 
            RowBox[{"Total", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Gamma]v", "/", "c"}], ")"}], "^", "2"}], "]"}]}], 
           "]"}]}], ";", "\n", 
         RowBox[{"\[Gamma]v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"\[DoubleStruckT]", ".", "\[DoubleStruckT]"}], 
                "]"}]}], ")"}], "<", "\[Epsilon]"}], ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"small", " ", "angle", " ", "expantion"}], "*)"}], "\n", 
            
            RowBox[{
             RowBox[{"Times", "[", 
              RowBox[{"2", ",", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{"\[Gamma]v", ",", "\[DoubleStruckT]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"\[Gamma]v", ".", "\[DoubleStruckT]"}], " ", 
                 "\[DoubleStruckT]"}], "-", 
                RowBox[{
                 RowBox[{"t", "^", "2"}], "\[Gamma]v"}]}]}], "]"}], "+", 
             "\[Gamma]v"}], "\n", ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"exact", " ", "solution"}], "*)"}], "\n", 
            RowBox[{
             RowBox[{"\[DoubleStruckB]", "=", 
              RowBox[{"\[DoubleStruckT]", "/", "t"}]}], ";", "\n", 
             RowBox[{"v1", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Gamma]v", ".", "\[DoubleStruckB]"}], ")"}], 
               "\[DoubleStruckB]"}]}], ";", "\n", 
             RowBox[{"v1", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"\[Gamma]v", "-", "v1"}], ")"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"2", "t"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"Cross", "[", 
                  RowBox[{"\[Gamma]v", ",", "\[DoubleStruckB]"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"2", "t"}], "]"}]}]}], ")"}]}]}]}], "\n", "]"}]}], 
         ";", "\n", 
         RowBox[{"\[Gamma]v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}]}]}], "\n", "]"}]}], "\n", "]"}]}],
    "\n", "]"}]}]}], "Input",
 CellLabel->
  "In[529]:=",ExpressionUUID->"93076d1c-9425-4bcd-bc17-d5c02a48a42d"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "compileMirrorField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileMirrorField", "[", 
   RowBox[{
    RowBox[{"B0_", "?", "Positive"}], ",", 
    RowBox[{"\[Xi]_", "?", "NonNegative"}]}], "]"}], ":=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"xyz", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", "xyz"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"\[Xi]", "^", "2"}], 
            RowBox[{"x", "^", "2"}]}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "y"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "z"}]}], "}"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"RuntimeAttributes", "\[Rule]", 
     RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->
  "In[531]:=",ExpressionUUID->"791b97e8-8417-4daf-987a-f003df120cd8"],

Cell[BoxData[
 RowBox[{"figure", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"c", "=", "4."}], ",", 
      RowBox[{"\[CapitalOmega]0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Omega]b0", "=", 
       RowBox[{".05", "*", "2", "Pi"}]}], ",", 
      RowBox[{"x0", "=", "0"}], ",", 
      RowBox[{"v0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Alpha]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"60", "Degree"}], "]"}]}], ",", 
      RowBox[{"\[Phi]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CapitalOmega]0", "=", "1"}], ",", 
         RowBox[{"\[Omega]b0", "=", ".05"}], ",", 
         RowBox[{"x0", "=", "0"}], ",", 
         RowBox[{"v0", "=", "1"}], ",", 
         RowBox[{"\[Alpha]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"60", "Degree"}], "]"}]}], ",", 
         RowBox[{"\[Phi]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ","}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Xi]", ",", "mirrorField", ",", "boris", ",", "\[CapitalDelta]t", 
        ",", "nt", ",", "\[Gamma]v", ",", "x", ",", "vv"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Xi]", "=", 
        RowBox[{"\[Omega]b0", "/", "v0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mirrorField", "=", 
        RowBox[{"compileMirrorField", "[", 
         RowBox[{"\[CapitalOmega]0", ",", "\[Xi]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boris", "=", 
        RowBox[{"compileBorisC", "[", 
         RowBox[{"c", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "//", "N"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]t", "=", 
        RowBox[{"2.", 
         RowBox[{
          RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", "100"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nt", "=", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"2.", 
            RowBox[{
             RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", 
             "\[CapitalDelta]t"}]}], ",", 
           RowBox[{"1", 
            RowBox[{"\[CapitalOmega]0", "/", "\[Omega]b0"}]}]}], "]"}], "//", 
         "Ceiling"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Gamma]v", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"Cos", "[", "\[Alpha]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Cos", "[", "\[Phi]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Sin", "[", "\[Phi]0", "]"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", "=", "x0"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "\[Gamma]v"}], "}"}], "=", 
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"\[Gamma]v", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"\[Gamma]v", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", 
                 RowBox[{"\[CapitalDelta]t", "/", 
                  SqrtBox[
                   RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Gamma]v", ".", "\[Gamma]v"}], "/", 
                    RowBox[{"c", "^", "2"}]}]}]]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"xx", "=", 
                  RowBox[{"xx", "-", 
                   RowBox[{"Divide", "[", 
                    RowBox[{
                    RowBox[{"Cross", "[", 
                    RowBox[{"\[Gamma]v", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"mirrorField", "[", "xx", "]"}], "]"}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"xx", "-", 
                 RowBox[{"Divide", "[", 
                  RowBox[{
                   RowBox[{"Cross", "[", 
                    RowBox[{"\[Gamma]v", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                   RowBox[{"\[CapitalOmega]0", 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Xi]", "^", "2"}], 
                    RowBox[{"x", "^", "2"}]}]}], ")"}]}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Gamma]v", "=", 
                RowBox[{"boris", "[", 
                 RowBox[{"\[Gamma]v", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"mirrorField", "[", "xx", "]"}], ",", 
                  "\[CapitalDelta]t"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"\[Gamma]v", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", 
                 RowBox[{"\[CapitalDelta]t", "/", 
                  SqrtBox[
                   RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Gamma]v", ".", "\[Gamma]v"}], "/", 
                    RowBox[{"c", "^", "2"}]}]}]]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "\[Gamma]v"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "\[Gamma]v"}], "}"}], ",", "nt"}], "]"}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"vv", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "/", 
              SqrtBox[
               RowBox[{"1", "+", 
                RowBox[{
                 RowBox[{"#", ".", "#"}], "/", 
                 RowBox[{"c", "^", "2"}]}]}]]}], "&"}], "/@", "\[Gamma]v"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"vv", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"\[CapitalDelta]t", 
              RowBox[{"{", 
               RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{"x", ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[533]:=",ExpressionUUID->"e7dee2aa-b573-4f5d-8407-8302133eb552"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"47a45929-8cb2-4784-96e4-3fed653a158f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[534]:=",ExpressionUUID->"bdaddcf9-af69-4c36-9938-f161f8f23ee4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particles", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"importRelativisticParticle", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time\>\"", ",", "\"\<q1\>\"", ",", "\"\<v1\>\"", ",", 
               "\"\<v2\>\"", ",", "\"\<v3\>\""}], "}"}]}], "]"}], "&"}], "/@",
           "files"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", 
              RowBox[{"Merge", "[", 
               RowBox[{"assoc", ",", "Identity"}], "]"}]}], "]"}]}], "}"}], 
          ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[535]:=",ExpressionUUID->"6ba9fcdc-0ae5-48ef-aa65-efb13191da8a"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particles"}]], "Input",
 CellLabel->
  "In[536]:=",ExpressionUUID->"3aa96428-bbca-41b4-8f90-772f9d722c6c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"particles", "=", "particles"}], ",", 
     RowBox[{"figure", "=", "figure"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"particles", "[", "\"\<xi\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<q1\>\"", "]"}]}], "]"}], "/", 
        RowBox[{"particles", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v1\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v2\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v3\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"xx", ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[537]:=",ExpressionUUID->"76cd5ce3-c68b-4cc8-968c-014dcd0674e8"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["03_equilibrium_distribution", "Subsection",ExpressionUUID->"0b4cc019-c60e-4c2a-b7a8-841371401aac"],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"8a6b4402-b769-44bd-a5e4-9e4d3c10b9ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[539]:=",ExpressionUUID->"4cb53ca9-4784-406b-a128-6cfc28587dd4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[540]:=",ExpressionUUID->"1e15b98e-888d-47a2-89b7-7104a6476ca5"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[541]:=",ExpressionUUID->"70ebb9eb-c69d-4954-8e32-5641f585c7fb"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",ExpressionUUID->"414bc519-26e4-492b-\
bbc9-31fb745c8216"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"T2OT1eq", "=", "2.111"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "c", ",", "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", 
       ",", "mom0", ",", "P1", ",", "P2", ",", "P3", ",", "T1s", ",", "T2s"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"particle", "[", "\"\<c\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{"T2OT1eq", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "T2OT1eq"}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{"particle", "[", "\"\<nU1\>\"", "]"}], 
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "/", "mom0"}]}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{"particle", "[", "\"\<nU2\>\"", "]"}], 
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "/", "mom0"}]}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{"particle", "[", "\"\<nU3\>\"", "]"}], 
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "/", "mom0"}]}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "\[Eta]", "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"u1", "^", "2"}], "/", 
               SqrtBox[
                RowBox[{"1", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                  RowBox[{"c", "^", "2"}]}]}]]}], ")"}], 
             RowBox[{"Divide", "[", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "-", 
                 RowBox[{
                  RowBox[{"u2", "^", "2"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Beta]1", " ", "T2OT1eq", " ", "\[Eta]"}], 
                   ")"}]}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], "T2OT1eq", " ", 
                "\[Eta]"}]}], "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", "\[Eta]s", "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"T2s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "\[Eta]", "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{".5", 
               RowBox[{
                RowBox[{"u2", "^", "2"}], "/", 
                SqrtBox[
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                   RowBox[{"c", "^", "2"}]}]}]]}]}], ")"}], 
             RowBox[{"Divide", "[", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "-", 
                 RowBox[{
                  RowBox[{"u2", "^", "2"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Beta]1", " ", "T2OT1eq", " ", "\[Eta]"}], 
                   ")"}]}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], "T2OT1eq", " ", 
                "\[Eta]"}]}], "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", "\[Eta]s", "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "\[Eta]s"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"\[Eta]s", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"\[Eta]s", " ", "T1s"}]}], "}"}], "]"}]}], "}"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{
                  RowBox[{"\[Eta]s", "^", "2"}], " ", "\[Beta]1", " ", 
                  RowBox[{"T2OT1eq", "/", "2"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"\[Eta]s", " ", "T2s"}]}], "}"}], "]"}]}], "}"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[542]:=",ExpressionUUID->"1d0ef20e-c74f-4116-9f6e-d6f785dc620d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[543]:=",ExpressionUUID->"c65b7fef-a4af-4cb6-87e8-282ce58ea2ab"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[544]:=",ExpressionUUID->"9c02a2c2-5fb9-49dc-873e-09fcf8d67e18"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",ExpressionUUID->"ff04b8af-20cc-4974-\
8e51-6ae6a7a9e77c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"\[Theta]2O\[Theta]1eq", "=", 
      SqrtBox["2.111"]}], ",", 
     RowBox[{"\[Beta]eq", "=", ".8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "c", ",", "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", 
       ",", "\[Eta]\[Beta]s", ",", "ns", ",", "mom0", ",", "P1", ",", "P2", 
       ",", "P3", ",", "T1s", ",", "T2s"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"particle", "[", "\"\<c\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]\[Beta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Beta]eq", " ", 
           RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Beta]eq", " ", 
              RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]s", "-", 
          RowBox[{"\[Beta]eq", " ", "\[Eta]\[Beta]s"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "-", "\[Beta]eq"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Eta]", ",", "\[Eta]\[Beta]"}], "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"u1", "^", "2"}], "/", 
               SqrtBox[
                RowBox[{"1", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                  RowBox[{"c", "^", "2"}]}]}]]}], ")"}], 
             RowBox[{"Divide", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "]"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]"}], ")"}]}], "]"}], "-", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]\[Beta]", " ", "\[Beta]eq"}], ")"}]}], "]"}]}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], 
                RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", "\[Eta]", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]", "/", "\[Eta]"}]}]}], ")"}]}]}], 
              "\[IndentingNewLine]", "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", 
        RowBox[{"\[Eta]s", ",", "\[Eta]\[Beta]s"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Eta]", ",", "\[Eta]\[Beta]"}], "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{".5", 
               RowBox[{
                RowBox[{"u2", "^", "2"}], "/", 
                SqrtBox[
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                   RowBox[{"c", "^", "2"}]}]}]]}]}], ")"}], 
             RowBox[{"Divide", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "]"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]"}], ")"}]}], "]"}], "-", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]\[Beta]", " ", "\[Beta]eq"}], ")"}]}], "]"}]}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], 
                RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", "\[Eta]", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]", "/", "\[Eta]"}]}]}], ")"}]}]}], 
              "\[IndentingNewLine]", "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", 
        RowBox[{"\[Eta]s", ",", "\[Eta]\[Beta]s"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", "T1s"}]}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "\[Eta]s", 
                    " ", 
                    RowBox[{"\[Beta]1", "/", "2"}]}], ")"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{"\[Beta]eq", " ", 
                    RowBox[{"\[Eta]\[Beta]s", "/", "\[Eta]s"}]}]}], ")"}]}]}],
                 "}"}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", "T2s"}]}], "}"}], "]"}]}], 
             "\[IndentingNewLine]", "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[545]:=",ExpressionUUID->"226eafcb-3860-4f1b-85d8-314673996fc8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "3"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[546]:=",ExpressionUUID->"dcf6b43a-ce40-4c49-8f31-be1ae1a74fbd"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[547]:=",ExpressionUUID->"3404d0fe-412a-4129-964c-f54e5a195ea3"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",ExpressionUUID->"c9cd9156-d50c-41a8-\
9063-a8caa6e09315"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]", "=", "1.1"}], ",", 
     RowBox[{"\[Zeta]", "=", "5"}], ",", 
     RowBox[{"vs", "=", "1.8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "c", ",", "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", 
       ",", "ns", ",", "\[Theta]", ",", "b", ",", "Ab", ",", "Bz", ",", "T", 
       ",", "TT", ",", "mom0", ",", "P1", ",", "P2", ",", "P3", ",", "f", ",",
        "nuv"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"particle", "[", "\"\<c\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Power", "[", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], ",", 
         "\[Zeta]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", "\[Eta]s"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", "=", 
       SqrtBox["\[Beta]"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"vs", "/", "\[Theta]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ab", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{".5", "+", 
             RowBox[{"b", "^", "2"}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bz", "=", 
       RowBox[{
        SqrtBox["\[Pi]"], 
        RowBox[{
         RowBox[{"Gamma", "[", 
          RowBox[{"1", "+", 
           RowBox[{".5", "\[Zeta]"}]}], "]"}], "/", 
         RowBox[{"Gamma", "[", 
          RowBox[{"1.5", "+", 
           RowBox[{".5", "\[Zeta]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T", "=", 
       RowBox[{".5", 
        RowBox[{"\[Beta]", "/", "Ab"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", 
           RowBox[{"(", 
            RowBox[{"2.5", "+", 
             RowBox[{"b", "^", "2"}]}], ")"}], 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{".75", "+", 
             RowBox[{
              RowBox[{"b", "^", "2"}], 
              RowBox[{"(", 
               RowBox[{"3", "+", 
                RowBox[{"b", "^", "2"}]}], ")"}]}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"TT", "=", 
       RowBox[{".5", 
        RowBox[{
         RowBox[{"\[Beta]", "^", "2"}], "/", "Ab"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", 
           RowBox[{"(", 
            RowBox[{"8.25", "+", 
             RowBox[{
              RowBox[{"b", "^", "2"}], 
              RowBox[{"(", 
               RowBox[{"7", "+", 
                RowBox[{"b", "^", "2"}]}], ")"}]}]}], ")"}], 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{"1.875", "+", 
             RowBox[{
              RowBox[{"b", "^", "2"}], 
              RowBox[{"(", 
               RowBox[{"11.25", "+", 
                RowBox[{"7.5", 
                 RowBox[{"b", "^", "2"}]}], "+", 
                RowBox[{"b", "^", "4"}]}], ")"}]}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", "=", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"u1", ",", "u2"}], "}"}], ",", 
         RowBox[{
          RowBox[{"Divide", "[", 
           RowBox[{"1", ",", 
            RowBox[{"2", "\[Pi]", " ", 
             RowBox[{"\[Theta]", "^", "3"}], " ", "Ab", " ", "Bz"}]}], "]"}], 
          
          RowBox[{"Exp", "[", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                SqrtBox[
                 RowBox[{
                  RowBox[{"u1", "^", "2"}], "+", 
                  RowBox[{"u2", "^", "2"}]}]], "-", "vs"}], ")"}], "^", 
              "2"}]}], "/", 
            RowBox[{"\[Theta]", "^", "2"}]}], "]"}], 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"u2", "^", "2"}], "/", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"u1", "^", "2"}], "+", 
               RowBox[{"u2", "^", "2"}]}], ")"}]}], ",", 
            RowBox[{"\[Zeta]", "/", "2"}]}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"nuv", "=", 
       RowBox[{"NIntegrate", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"u1", "^", "2"}], "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"u1", "^", "2"}], "+", 
                  RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                RowBox[{"c", "^", "2"}]}]}], "]"}]}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"u2", "^", "2"}], "/", "2"}], "/", 
             RowBox[{"Sqrt", "[", 
              RowBox[{"1", "+", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"u1", "^", "2"}], "+", 
                  RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                RowBox[{"c", "^", "2"}]}]}], "]"}]}]}], "}"}], 
          RowBox[{"f", "[", 
           RowBox[{"u1", ",", "u2"}], "]"}], "2", "Pi", " ", "u2"}], ",", 
         RowBox[{"{", 
          RowBox[{"u1", ",", 
           RowBox[{
            RowBox[{"-", "vs"}], "-", 
            RowBox[{"5", "\[Theta]"}]}], ",", 
           RowBox[{"vs", "+", 
            RowBox[{"5", "\[Theta]"}]}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"u2", ",", "0", ",", 
           RowBox[{
            RowBox[{"5", "\[Theta]"}], "+", "vs"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", 
                  RowBox[{"T", "/", 
                   RowBox[{"(", 
                    RowBox[{"3", "+", "\[Zeta]"}], ")"}]}]}]}], "}"}], "]"}], 
              ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{
                  RowBox[{"ns", "/", 
                   RowBox[{"(", 
                    RowBox[{"3", "+", "\[Zeta]"}], ")"}]}], 
                  RowBox[{"(", 
                   RowBox[{"T", "-", 
                    RowBox[{".5", 
                    RowBox[{"TT", "/", 
                    RowBox[{"c", "^", "2"}]}]}]}], ")"}]}]}], "}"}], "]"}], 
              ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", 
                  RowBox[{"nuv", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], "]"}]}], "}"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Cyan", ",", "Black"}], "}"}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", "T", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{".5", "\[Zeta]"}]}], ")"}], "/", 
                   RowBox[{"(", 
                    RowBox[{"3", "+", "\[Zeta]"}], ")"}]}]}]}], "}"}], "]"}], 
              ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{".5", "\[Zeta]"}]}], ")"}], "/", 
                   RowBox[{"(", 
                    RowBox[{"3", "+", "\[Zeta]"}], ")"}]}], 
                  RowBox[{"(", 
                   RowBox[{"T", "-", 
                    RowBox[{".5", 
                    RowBox[{"TT", "/", 
                    RowBox[{"c", "^", "2"}]}]}]}], ")"}]}]}], "}"}], "]"}], 
              ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", 
                  RowBox[{"nuv", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], "]"}]}], "}"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Cyan", ",", "Black"}], "}"}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[548]:=",ExpressionUUID->"1f7dc602-0dad-4b5d-ac06-b3bb706db840"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["04_whistler_anisotropy_instability", "Subsection",ExpressionUUID->"4ad95c69-10c4-47aa-a789-da3a98d39e2b"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"18065d79-877e-4249-ad95-bce7ce9617f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "7"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", "mU2O2", 
         ",", "relKE"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"First", "[", "#", "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{
                RowBox[{"Rest", "[", "#", "]"}], ",", "3"}], "]"}], "]"}], 
             ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{
                RowBox[{"Rest", "[", "#", "]"}], ",", "3"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"relKE", ",", "mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}], ",", 
          RowBox[{"\"\<relKE\>\"", "->", "relKE"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"aae450eb-f661-481f-8d2e-a7e05d0d1991"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[1103]:=",ExpressionUUID->"8f74d52a-4b51-4dda-ac83-000318535b86"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
        "relKE"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"relKE", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<relKE\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{"relKE", ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<(\[Gamma]-1)mc^2\>\""}], 
             ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", "relKE"}], 
               "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[1104]:=",ExpressionUUID->"d9451187-42ba-47b2-a771-40a84b4483bc"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[1105]:=",ExpressionUUID->"81c52bb0-256e-4a0d-88ca-663f729fc290"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1106]:=",ExpressionUUID->"c732b4f2-95af-4cf0-8138-cf5443681c1e"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1107]:=",ExpressionUUID->"43f5c49f-11f0-4949-af5e-516d6133403b"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"538fbbce-3733-450f-ba7a-81f0da6e611d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1108]:=",ExpressionUUID->"5bc624e6-c8ca-428f-8a0c-871d8e606011"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", "assoc"}], "}"}], ",", "Last"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[1109]:=",ExpressionUUID->"d3a04fac-aa9b-40d1-90a8-556e992301c7"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[1110]:=",ExpressionUUID->"4902d5dd-95a2-42b0-9d57-0c1f9995f885"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"partspec", "=", 
      RowBox[{"{", 
       RowBox[{"100", ",", "25"}], "}"}]}], ",", 
     RowBox[{"sampleLocs", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "150", ",", "300", ",", "450"}], "}"}]}], ",", 
     RowBox[{"\[Omega]max", "=", "1.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "fullgrid", ",", "dB3", ",", "dB2", ",", "dB", 
       ",", "\[Omega]t", ",", "pos\[Omega]", ",", "w", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"partspec", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"$_Real", "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullgrid", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"fullgrid", ",", 
            RowBox[{
             RowBox[{"post", "[", 
              RowBox[{"field", "[", "\"\<dB2\>\"", "]"}], "]"}], 
             "\[Transpose]"}]}], "}"}], "]"}], "]"}], "[", "sampleLocs", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"fullgrid", ",", 
            RowBox[{
             RowBox[{"post", "[", 
              RowBox[{"field", "[", "\"\<dB3\>\"", "]"}], "]"}], 
             "\[Transpose]"}]}], "}"}], "]"}], "]"}], "[", "sampleLocs", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{"dB2", "-", 
        RowBox[{"I", " ", "dB3"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"partspec", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", 
          RowBox[{"partspec", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pos\[Omega]", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", 
                RowBox[{"w", "*", "#"}], "]"}]}], ",", "2"}], "]"}]}], "&"}], 
          ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Sequence", "@@", "partspec"}]}], "]"}], "&"}], "/@", 
           "dB"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"t", ",", 
          RowBox[{"Sequence", "@@", "partspec"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "dB", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Dashed", ",", "\[IndentingNewLine]", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", ".5"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", ".5"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"Map", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ArrayPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Transpose", "[", "#", "]"}], "//", "Reverse"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"DataRange", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"\[Omega]t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
            "\[IndentingNewLine]", "]"}], "&"}], ",", "\[IndentingNewLine]", 
          "dB"}], "\[IndentingNewLine]", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Grid", "[", 
         RowBox[{"plots", "~", "Partition", "~", "2"}], "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1115]:=",ExpressionUUID->"de2e79d2-8362-47b8-9a48-572f9c6f0c5b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "1500"}], "}"}], "]"}]}], ",", 
     RowBox[{"xlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "q1", ",", "posx", ",", "dB3", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"q1", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"xlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "posx", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of xlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"posx", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"q1", "//", "posx"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"posx", "/@", 
        RowBox[{"post", "@", 
         RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "dB3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB3", "/", "max"}], "+", "1"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Show", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Transpose", "[", "dB3", "]"}], "//", "Reverse"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"q1", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ImageSize", "\[Rule]", "1200"}], ",", "\[IndentingNewLine]", 
         RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"AspectRatio", "\[Rule]", 
          RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{"PlotRangePadding", "\[Rule]", 
          RowBox[{"Thread", "[", 
           RowBox[{"Scaled", "[", 
            RowBox[{".005", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
        "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{"plots", ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<TemperatureMap\>\"", ",", 
              RowBox[{"max", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1131]:=",ExpressionUUID->"d06e55a7-47fc-4074-8b3d-ee49ba7ba881"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1112]:=",ExpressionUUID->"d60791df-bb46-4db1-8e1f-5b31e8767587"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1113]:=",ExpressionUUID->"4585bc0e-c822-473c-8d68-6c18072a0673"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"71a44c54-da91-4f1d-b73f-e991ce3c55f9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1132]:=",ExpressionUUID->"6338a44a-b53e-47bc-870a-2a9768a5aa34"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importStressEnergyTensor", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1133]:=",ExpressionUUID->"33b9d70c-0d95-4f6d-a2fd-843c5cf3d55f"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[1134]:=",ExpressionUUID->"24ce44d7-b0fa-49ea-a6c2-2e5675708e35"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[1135]:=",ExpressionUUID->"8406d3c9-b58a-4608-b90f-f17ea633e582"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "q1", ",", "posx", ",", "P1", ",", "P2", ",", 
       "P3", ",", "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"t", ",", 
           RowBox[{"$_Real", "/;", 
            RowBox[{"IntervalMemberQ", "[", 
             RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ";;", "1", ";;", 
           RowBox[{"-", "5"}]}], "]"}], "]"}], "//", "Reverse"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"q1", ",", 
         RowBox[{"_Real", "?", "NonNegative"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "posx", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of q1lim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"posx", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"q1", "//", "posx"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nu1v1\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nu2v2\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nu3v3\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"P1", ",", "P2", ",", "P3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P1", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P2", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P3", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"P1", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\!\(\*SuperscriptBox[\(q\), \(1\)]\)\\)\>\"", ",", 
               "\"\<\\!\\(t \!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<\!\(\*SubscriptBox[\(P\), \
\(\[DoubleVerticalBar]\)]\)\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".03", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"P2", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\!\(\*SuperscriptBox[\(q\), \(1\)]\)\\)\>\"", ",", 
               "\"\<\\!\\(t \!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<\!\(\*SubscriptBox[\(P\), \(\(\[UpTee]\)\(1\)\)]\)\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".03", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",ExpressionUUID->"23c416c1-a235-41f3-\
9f33-1100723a23f4"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[69]:=",ExpressionUUID->"dbad6ebf-cae8-44a3-ba9d-85b8fd476850"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[70]:=",ExpressionUUID->"469972d6-6a52-4b6f-bc4c-be8a59475cab"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"field", "[", "\"\<n\[Gamma]c2\>\"", "]"}], "/", 
                   RowBox[{
                    RowBox[{"moment", "[", "\"\<c\>\"", "]"}], "^", "2"}]}], 
                  "-", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]\[Gamma]\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[71]:=",ExpressionUUID->"2d2efebb-7a61-4031-a39c-2172bd3a0d92"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[DoubleVerticalBar]\
\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\(\[UpTee]\)\(\
\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[72]:=",ExpressionUUID->"15eef123-05a1-4819-993b-fc92f58646a1"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"18553aef-e916-4318-84fe-a4e5303727f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1137]:=",ExpressionUUID->"863af7e7-8a9a-4df8-95b9-bd7958891789"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1138]:=",ExpressionUUID->"ace63c7b-17aa-4525-a086-3fe071ee9ef6"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[1139]:=",ExpressionUUID->"bfe565af-8ead-4546-9c6e-be34718254bd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      SqrtBox[
       RowBox[{"1", "/", "10"}]], 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[1140]:=",ExpressionUUID->"1321023b-ecaa-410f-8aed-34bceed8d4b1"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{".1", "/", "100"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1142]:=",ExpressionUUID->"df675d0c-e8ab-4244-ba34-20bfe4d5f91f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"e086e0bd-3862-45fc-ae43-78ab7bc76fa9"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1143]:=",ExpressionUUID->"32bfb2ce-3a85-4565-9a2a-bb1ec0af27bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1144]:=",ExpressionUUID->"2506b01e-dae8-44ed-bd4c-0c5b345422ac"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[1145]:=",ExpressionUUID->"3ee9d24c-490d-4003-9deb-80cda4b628b5"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".1"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
            RowBox[{"PlotRange", "->", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1146]:=",ExpressionUUID->"4f341d95-67b6-49bc-ba14-b3d5fafbf6e4"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["05_light_propagation_in_free_space", "Subsection",ExpressionUUID->"ddabeeff-7684-42c0-bbf9-77b4809e5baf"],

Cell[TextData[{
 "1D wave equation for the electric field:\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox["c", "2"], 
      FractionBox[
       RowBox[{
        SuperscriptBox["\[PartialD]", "2"], "\[DoubleStruckCapitalE]"}], 
       RowBox[{"\[PartialD]", 
        SuperscriptBox["x", "2"]}]]}], "-", 
     FractionBox[
      RowBox[{
       SuperscriptBox["\[PartialD]", "2"], "\[DoubleStruckCapitalE]"}], 
      RowBox[{"\[PartialD]", 
       SuperscriptBox["t", "2"]}]]}], "=", 
    FractionBox[
     RowBox[{"\[PartialD]", "\[DoubleStruckJ]"}], 
     RowBox[{"\[PartialD]", "t"}]]}], TraditionalForm]],ExpressionUUID->
  "1dc42b07-eb4e-4863-9e6b-435b4a10c051"],
 ".\nSuppose the driving current is given by\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckJ]", "(", 
     RowBox[{"x", ",", "t"}], ")"}], "=", 
    RowBox[{
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     SuperscriptBox["\[DoubleStruckE]", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Nu]", " ", "t"}]], 
     RowBox[{"\[Delta]", "(", "x", ")"}]}]}], TraditionalForm]],
  ExpressionUUID->"d8788e19-ded4-4812-9044-a1b1c7cd307e"],
 ".\nAssuming ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", 
     RowBox[{"x", ",", "t"}], ")"}], "=", 
    RowBox[{
     RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], 
     SuperscriptBox["\[DoubleStruckE]", 
      RowBox[{
       RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Omega]", " ", "t"}]]}]}], 
   TraditionalForm]],ExpressionUUID->"7a1b92ba-640e-4105-abdd-5193c1d36b72"],
 " and ",
 Cell[BoxData[
  FormBox[
   RowBox[{"\[Nu]", "=", "\[Omega]"}], TraditionalForm]],ExpressionUUID->
  "29fb3c1a-9f1e-4758-8676-e11ea3c6615d"],
 ",\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{
      SuperscriptBox["c", "2"], 
      FractionBox[
       RowBox[{
        SuperscriptBox["\[PartialD]", "2"], "\[DoubleStruckCapitalE]"}], 
       RowBox[{"\[PartialD]", 
        SuperscriptBox["x", "2"]}]]}], "+", 
     RowBox[{
      SuperscriptBox["\[Omega]", "2"], "\[DoubleStruckCapitalE]"}]}], "=", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Omega]", " ", 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Delta]", "(", "x", ")"}]}]}], TraditionalForm]],
  ExpressionUUID->"4d1b4d25-1cb0-4ab4-8f03-5c0bad3e2740"],
 ".\nUsing the Fourier transformation,\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], "=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Pi]"}]], 
     RowBox[{"\[Integral]", 
      RowBox[{
       RowBox[{"\[DoubleStruckCapitalE]", "(", "k", ")"}], 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], TraditionalForm]],
  ExpressionUUID->"6928f727-7beb-49e0-bf5d-bd6f2cdeb24d"],
 " and ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Delta]", "(", "x", ")"}], "=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Pi]"}]], 
     RowBox[{"\[Integral]", 
      RowBox[{
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], TraditionalForm]],
  ExpressionUUID->"427e9033-13c4-4e7a-a668-0db49e606ce5"],
 ",\nthe wave equation in Fourier space reads\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       SuperscriptBox["\[Omega]", "2"], "-", 
       RowBox[{
        SuperscriptBox["c", "2"], 
        SuperscriptBox["k", "2"]}]}], ")"}], 
     RowBox[{"\[DoubleStruckCapitalE]", "(", "k", ")"}]}], "=", 
    RowBox[{
     RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Omega]", " ", 
     SubscriptBox["\[DoubleStruckJ]", "0"]}]}], TraditionalForm]],
  ExpressionUUID->"0bcd48cf-f94d-4b8c-b22a-6a17ac21b7a8"],
 ".\nThe electric field is then\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "k", ")"}], "=", 
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", 
       SuperscriptBox["\[Omega]", "2"]]}], 
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", "\[Omega]"}], 
      RowBox[{"1", "+", "n"}]], 
     FractionBox["1", 
      RowBox[{"1", "-", "n"}]], " ", 
     SubscriptBox["\[DoubleStruckJ]", "0"]}]}], TraditionalForm]],
  ExpressionUUID->"892669b2-4a6f-487c-8f6a-fac0cdf035ef"],
 ",\nwhere ",
 Cell[BoxData[
  FormBox[
   RowBox[{"n", "=", 
    RowBox[{"c", " ", 
     RowBox[{"k", "/", "\[Omega]"}]}]}], TraditionalForm]],ExpressionUUID->
  "1cb00300-466c-4795-a6cd-4781b4ee60ad"],
 ".\nIn the real space,\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], "=", 
    RowBox[{
     RowBox[{"-", 
      FractionBox["1", 
       SuperscriptBox["\[Omega]", "2"]]}], 
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", "\[Omega]"}], 
      RowBox[{"2", "\[Pi]"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       FractionBox["1", 
        RowBox[{"1", "-", "n"}]], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], TraditionalForm]],
  ExpressionUUID->"437f0a4c-412c-47fc-8330-69287f10ad58"],
 ".\nUsing the \[Delta]-function identity,\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{
     SubscriptBox["lim", 
      RowBox[{"\[Epsilon]", "\[Rule]", 
       SuperscriptBox["0", "+"]}]], 
     FractionBox["1", 
      RowBox[{"x", "\[PlusMinus]", 
       RowBox[{"\[ImaginaryI]", " ", "\[Epsilon]"}]}]]}], "=", 
    RowBox[{
     RowBox[{
      RowBox[{"\[MinusPlus]", "\[ImaginaryI]"}], " ", "\[Pi]", 
      "\[VeryThinSpace]", 
      RowBox[{"\[Delta]", "(", "x", ")"}]}], "+", 
     RowBox[{"\[ScriptCapitalP]", "(", 
      FractionBox["1", "x"], ")"}]}]}], TraditionalForm]],ExpressionUUID->
  "87b22392-57c1-41b8-af8b-cc3bc0e935ee"],
 " (Plemelj's formula) and ",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"\[Delta]", "(", 
     RowBox[{"\[Phi]", "(", "x", ")"}], ")"}], "=", 
    RowBox[{
     SubscriptBox["\[Sum]", "j"], 
     FractionBox[
      RowBox[{"\[Delta]", "(", 
       RowBox[{"x", "-", 
        SubscriptBox["x", "j"]}], ")"}], 
      RowBox[{"\[LeftBracketingBar]", 
       RowBox[{
        RowBox[{"\[Phi]", "'"}], 
        RowBox[{"(", 
         SubscriptBox["x", "j"], ")"}]}], "\[RightBracketingBar]"}]]}]}], 
   TraditionalForm]],ExpressionUUID->"ce0134dc-af79-4a1b-b201-702277ffd460"],
 ", \n",
 Cell[BoxData[{
  FormBox[
   RowBox[{
    RowBox[{"\[DoubleStruckCapitalE]", "(", "x", ")"}], "=", 
    RowBox[{
     FractionBox[
      RowBox[{"\[ImaginaryI]", " ", "\[Omega]"}], 
      RowBox[{"2", "\[Pi]"}]], 
     FractionBox["1", 
      SuperscriptBox["\[Omega]", "2"]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"-", "\[ImaginaryI]"}], " ", "\[Pi]", "\[VeryThinSpace]", 
          RowBox[{"\[Delta]", "(", 
           RowBox[{"n", "-", "1"}], ")"}]}], "+", 
         RowBox[{"\[ScriptCapitalP]", "(", 
          FractionBox["1", 
           RowBox[{"n", "-", "1"}]], ")"}]}], ")"}], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Omega]"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"\[Delta]", "(", 
          RowBox[{"n", "-", "1"}], ")"}], "+", 
         RowBox[{"\[ImaginaryI]", " ", 
          RowBox[{"\[ScriptCapitalP]", "(", 
           FractionBox["1", 
            RowBox[{"n", "-", "1"}]], ")"}]}]}], ")"}], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"=", 
    RowBox[{
     FractionBox["1", 
      RowBox[{"2", "\[Omega]"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     RowBox[{"\[Integral]", 
      RowBox[{
       FractionBox["1", 
        RowBox[{"1", "+", "n"}]], 
       FractionBox[
        RowBox[{"\[LeftBracketingBar]", "\[Omega]", "\[RightBracketingBar]"}],
         "c"], 
       RowBox[{"\[Delta]", "(", 
        RowBox[{"k", "-", 
         RowBox[{"\[Omega]", "/", "c"}]}], ")"}], " ", 
       SuperscriptBox["\[ExponentialE]", 
        RowBox[{"\[ImaginaryI]", " ", "k", " ", "x"}]], 
       RowBox[{"\[DifferentialD]", "k"}]}]}]}]}], 
   TraditionalForm], "\[IndentingNewLine]", 
  FormBox[
   RowBox[{"=", 
    RowBox[{
     FractionBox[
      RowBox[{"sign", "(", "\[Omega]", ")"}], 
      RowBox[{"4", "c"}]], 
     SubscriptBox["\[DoubleStruckJ]", "0"], 
     SuperscriptBox["\[ExponentialE]", 
      RowBox[{"\[ImaginaryI]", " ", 
       RowBox[{"\[Omega]", "/", "c"}], " ", "x"}]]}]}], TraditionalForm]}],
  ExpressionUUID->"e9311110-b3c5-4464-a963-d67f5042d051"],
 "."
}], "Text",ExpressionUUID->"bb5180d1-a280-4659-9537-98dc69b1eb2c"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"127ad174-1734-4278-8bee-a4a000c61256"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "7"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2"}], "}"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[307]:=",ExpressionUUID->"7050a40e-2fff-4674-a7e0-7a310949f3e6"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[308]:=",ExpressionUUID->"acb96b8b-d0d3-4db1-8deb-8f36685ead59"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[309]:=",ExpressionUUID->"d2f80a14-a4c3-4c0c-bc12-0fc336710f85"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"88e29246-a6cd-44ee-b639-c9009853426b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[310]:=",ExpressionUUID->"ae0d0f3b-a917-4f60-a99c-42042683646d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", "assoc"}], "}"}], ",", "Last"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[311]:=",ExpressionUUID->"ba7c203b-cc14-4a00-ad93-b771b491d964"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[312]:=",ExpressionUUID->"bef0aa91-291f-4952-98a1-840d61ac57b2"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{"field", "=", "field"}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dB3", ",", "t", ",", "q1", ",", "max"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"Most", "[", 
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"Abs", "[", "dB3", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{"dB3", "/", "max"}], "+", "1"}], ")"}], "/", "2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"Transpose", "[", "dB3", "]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<TemperatureMap\>\""}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Graphics", "[", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"Dashed", ",", "Black", ",", "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"150", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"FrameTicks", "->", "Automatic"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Large"}], ",", "\[IndentingNewLine]", 
          RowBox[{"AspectRatio", "->", 
           RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRangePadding", "->", 
           RowBox[{"Thread", "[", 
            RowBox[{"Scaled", "[", 
             RowBox[{".01", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"BarLegend", "[", 
         RowBox[{"{", 
          RowBox[{"\"\<TemperatureMap\>\"", ",", 
           RowBox[{"max", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "1"}], ",", "1"}], "}"}]}]}], "}"}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[313]:=",ExpressionUUID->"98a9290e-a163-48c8-a696-d2d061d6cefc"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tslice", "=", "150"}], ",", 
     RowBox[{"q1slice", "=", "0"}], ",", 
     RowBox[{"J0", "=", "0.04"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dB3", ",", "dB2", ",", "t", ",", "q1", ",", "x", ",", "post", ",", 
       "posq"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dB3", "=", 
       RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"t", "-", "tslice"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"Abs", "[", 
           RowBox[{"t", "-", "tslice"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "==", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"Extract", "[", 
          RowBox[{"post", "//", "First"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"Most", "[", 
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"field", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"field", "[", "\"\<xi\>\"", "]"}], "q1"}], "]"}], "/", 
        RowBox[{"field", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posq", "=", 
       RowBox[{"Position", "[", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"q1", "-", "q1slice"}], "]"}], ",", 
         RowBox[{"Min", "[", 
          RowBox[{"Abs", "[", 
           RowBox[{"q1", "-", "q1slice"}], "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posq", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "posq", "]"}], "==", "0"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no q1 selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"Extract", "[", 
          RowBox[{"posq", "//", "First"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Show", "[", 
         RowBox[{"#", ",", "\[IndentingNewLine]", 
          RowBox[{"Graphics", "[", 
           RowBox[{"{", "\[IndentingNewLine]", 
            RowBox[{"Dashed", ",", "Black", ",", "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{"J0", "/", "4"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"InfiniteLine", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", 
                 RowBox[{
                  RowBox[{"-", "J0"}], "/", "4"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
            "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Large"}], ",", "\[IndentingNewLine]", 
          RowBox[{"AspectRatio", "->", 
           RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRangePadding", "->", 
           RowBox[{"Thread", "[", 
            RowBox[{"Scaled", "[", 
             RowBox[{".01", 
              RowBox[{"{", 
               RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"GridLines", "->", "Automatic"}]}], "\[IndentingNewLine]", 
         "]"}], "&"}], "/@", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"t", "-", "100"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"2", "Pi"}], ")"}]}], ",", 
                RowBox[{"posq", "/@", "dB2"}]}], "}"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"t", "-", "100"}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"2", "Pi"}], ")"}]}], ",", 
                RowBox[{"posq", "/@", "dB3"}]}], "}"}], "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Directive", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"PlotLegends", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<dE2\>\"", ",", "\"\<dE3\>\""}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"70", ",", "200"}], "}"}], "-", "100"}], ")"}], "/", 
               RowBox[{"(", 
                RowBox[{"2", "Pi"}], ")"}]}], ",", "All"}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"post", "@", "dB2"}]}], "}"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"post", "@", "dB3"}]}], "}"}], "]"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"PlotStyle", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Directive", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}], "]"}]}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"PlotLegends", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"\"\<dE2\>\"", ",", "\"\<dE3\>\""}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "100"}], ",", "200"}], "}"}], ",", "All"}], 
             "}"}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]",
         "}"}]}]}]}], "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellLabel->
  "In[314]:=",ExpressionUUID->"37176db6-86ab-4527-b996-df6e95337db6"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Hybrid_1D", "Section",ExpressionUUID->"9ef99579-bb41-40c5-b013-d697ac8909e0"],

Cell[CellGroupData[{

Cell["01_emic_dispersion", "Subsection",ExpressionUUID->"e1347178-35eb-4a94-a91c-ba6dc557560a"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"381cfa11-8200-4d99-a9aa-a7dc86dd28de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[189]:=",ExpressionUUID->"3fe88431-1279-4c54-9695-9e823972b42e"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[190]:=",ExpressionUUID->"c2393e1f-1ffc-40da-b0fc-c2f02b55061c"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[191]:=",ExpressionUUID->"b84b5ef3-991c-467a-9196-d465d0550ded"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[192]:=",ExpressionUUID->"d5660d51-7188-4f75-a5fb-c33d46180fcd"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[193]:=",ExpressionUUID->"1c034072-b703-4954-9367-18792528649b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[194]:=",ExpressionUUID->"e1508f6b-345c-4d05-b906-9702b467099c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"13b7c2f1-d652-46ec-b800-4707f9079059"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[195]:=",ExpressionUUID->"7b88ca36-cad5-4c59-9ffe-5bf1d18c9435"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[196]:=",ExpressionUUID->"f051950d-a748-4f9e-8301-fb92033b78bd"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[197]:=",ExpressionUUID->"80043343-ceed-43d7-a203-b7297d3acb4b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[198]:=",ExpressionUUID->"92ac6757-246f-42dd-8e2c-ea33a7a35dcb"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[199]:=",ExpressionUUID->"8d354012-f55b-4173-aaf8-5e60bbac78df"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"9d98fa21-0fcb-426d-b646-77bcb2295aa0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[200]:=",ExpressionUUID->"8b0feb06-83c6-41bc-880a-6acf24156d1d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[201]:=",ExpressionUUID->"4495ff96-619a-4f61-ac2b-5b8fa7247acb"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[202]:=",ExpressionUUID->"bc404668-761a-4a4e-ae81-b907de328c24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[203]:=",ExpressionUUID->"54d4e6df-3241-4f61-942c-1c917a166c84"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[204]:=",ExpressionUUID->"e928620d-5b81-428a-980e-9315ffe6068c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[205]:=",ExpressionUUID->"ff1a082d-e175-4941-a9a0-364fadbb392e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"becc40bf-9554-4f7b-9000-f72558511078"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[206]:=",ExpressionUUID->"5c673f6c-afba-4a1a-9b56-74150bff6a17"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[207]:=",ExpressionUUID->"b4e29b4f-0412-4dfe-83e0-34e98f96a098"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[208]:=",ExpressionUUID->"411be4a3-adf2-49e7-9428-a7a94e20d8fc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[209]:=",ExpressionUUID->"7d51a2c9-d5fe-41bc-a618-406359832f72"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[211]:=",ExpressionUUID->"40d518d3-4f42-4596-a887-7c7b5714118c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"f02d28e0-f013-4d3e-bed2-47fbca4889d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[212]:=",ExpressionUUID->"96aa12a8-87d5-473b-91ff-e2d931b5be77"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[213]:=",ExpressionUUID->"603d23bd-7bfe-4c11-b10d-8c30ef07b498"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[214]:=",ExpressionUUID->"01485372-63bc-4c2d-8018-e9cd2859beab"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[215]:=",ExpressionUUID->"26e08bfc-4bde-4e02-ab0d-e660ad4f7534"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["02_mirror_motion", "Subsection",ExpressionUUID->"7599dd85-c9a7-4644-8521-4c1e121c10d3"],

Cell[CellGroupData[{

Cell["Setup", "Subsubsection",ExpressionUUID->"eab06cc8-b6b8-48a7-8bf1-c14815d6124d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileBorisC", "]"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"non", "-", "relativistic"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compileBorisC", "[", 
   RowBox[{
    RowBox[{"B0", ":", 
     RowBox[{"{", "__Real", "}"}]}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "B0", "]"}], "==", "3"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", "=", "1.*^-5"}], "}"}], ",", "\n", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cE", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dB", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dt", ",", "_Real"}], "}"}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v0", ",", "cE", ",", "dB", ",", "dt"}], "}"}], ","}]}], 
       "*)"}], "\n", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[DoubleStruckT]", "=", 
           RowBox[{".5", "dt", " ", 
            RowBox[{"(", 
             RowBox[{"B0", "+", "dB"}], ")"}]}]}], ",", 
          RowBox[{"v", "=", "v0"}], ",", "t", ",", "\[DoubleStruckB]", ",", 
          "v1"}], "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}], ";", "\n", 
         RowBox[{"v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"\[DoubleStruckT]", ".", "\[DoubleStruckT]"}], 
                "]"}]}], ")"}], "<", "\[Epsilon]"}], ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"small", " ", "angle", " ", "expantion"}], "*)"}], "\n", 
            
            RowBox[{
             RowBox[{"Times", "[", 
              RowBox[{"2", ",", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{"v", ",", "\[DoubleStruckT]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"v", ".", "\[DoubleStruckT]"}], " ", 
                 "\[DoubleStruckT]"}], "-", 
                RowBox[{
                 RowBox[{"t", "^", "2"}], "v"}]}]}], "]"}], "+", "v"}], "\n", 
            ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"exact", " ", "solution"}], "*)"}], "\n", 
            RowBox[{
             RowBox[{"\[DoubleStruckB]", "=", 
              RowBox[{"\[DoubleStruckT]", "/", "t"}]}], ";", "\n", 
             RowBox[{"v1", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"v", ".", "\[DoubleStruckB]"}], ")"}], 
               "\[DoubleStruckB]"}]}], ";", "\n", 
             RowBox[{"v1", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v", "-", "v1"}], ")"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"2", "t"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"Cross", "[", 
                  RowBox[{"v", ",", "\[DoubleStruckB]"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"2", "t"}], "]"}]}]}], ")"}]}]}]}], "\n", "]"}]}], 
         ";", "\n", 
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}]}]}], "\n", "]"}]}], "\n", "]"}]}],
    "\n", "]"}]}]}], "Input",
 CellLabel->"In[99]:=",ExpressionUUID->"21a89685-ea37-4133-b06e-7557b59da770"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "compileMirrorField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileMirrorField", "[", 
   RowBox[{
    RowBox[{"B0_", "?", "Positive"}], ",", 
    RowBox[{"\[Xi]_", "?", "NonNegative"}]}], "]"}], ":=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"xyz", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", "xyz"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"\[Xi]", "^", "2"}], 
            RowBox[{"x", "^", "2"}]}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "y"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "z"}]}], "}"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"RuntimeAttributes", "\[Rule]", 
     RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->
  "In[101]:=",ExpressionUUID->"898ec17c-37dd-496c-ad57-5f4824400d24"],

Cell[BoxData[
 RowBox[{"figure", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[CapitalOmega]0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Omega]b0", "=", 
       RowBox[{".05", "*", "2", "Pi"}]}], ",", 
      RowBox[{"x0", "=", "0"}], ",", 
      RowBox[{"v0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Alpha]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"60", "Degree"}], "]"}]}], ",", 
      RowBox[{"\[Phi]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CapitalOmega]0", "=", "1"}], ",", 
         RowBox[{"\[Omega]b0", "=", ".05"}], ",", 
         RowBox[{"x0", "=", "0"}], ",", 
         RowBox[{"v0", "=", "1"}], ",", 
         RowBox[{"\[Alpha]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"60", "Degree"}], "]"}]}], ",", 
         RowBox[{"\[Phi]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ","}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Xi]", ",", "mirrorField", ",", "boris", ",", "\[CapitalDelta]t", 
        ",", "nt", ",", "vv", ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Xi]", "=", 
        RowBox[{"\[Omega]b0", "/", "v0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mirrorField", "=", 
        RowBox[{"compileMirrorField", "[", 
         RowBox[{"\[CapitalOmega]0", ",", "\[Xi]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boris", "=", 
        RowBox[{"compileBorisC", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], "//", "N"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]t", "=", 
        RowBox[{"2.", 
         RowBox[{
          RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", "100"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nt", "=", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"2.", 
            RowBox[{
             RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", 
             "\[CapitalDelta]t"}]}], ",", 
           RowBox[{"1", 
            RowBox[{"\[CapitalOmega]0", "/", "\[Omega]b0"}]}]}], "]"}], "//", 
         "Ceiling"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vv", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"Cos", "[", "\[Alpha]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Cos", "[", "\[Phi]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Sin", "[", "\[Phi]0", "]"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", "=", "x0"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "vv"}], "}"}], "=", 
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"xx", "=", 
                  RowBox[{"xx", "-", 
                   RowBox[{"Divide", "[", 
                    RowBox[{
                    RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"mirrorField", "[", "xx", "]"}], "]"}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"xx", "-", 
                 RowBox[{"Divide", "[", 
                  RowBox[{
                   RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                   RowBox[{"\[CapitalOmega]0", 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Xi]", "^", "2"}], 
                    RowBox[{"x", "^", "2"}]}]}], ")"}]}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"boris", "[", 
                 RowBox[{"vv", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"mirrorField", "[", "xx", "]"}], ",", 
                  "\[CapitalDelta]t"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "vv"}], "}"}]}]}], "\[IndentingNewLine]", 
             "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "vv"}], "}"}], ",", "nt"}], "]"}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{"x", ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[103]:=",ExpressionUUID->"843a3ab4-2427-4c6e-a36f-2d3295b20ace"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"77479489-57c3-411d-a796-89cc9f3cd780"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[104]:=",ExpressionUUID->"78499b30-58a8-4394-9ba3-14544c9f41cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particles", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"importParticle", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time\>\"", ",", "\"\<q1\>\"", ",", "\"\<v1\>\"", ",", 
               "\"\<v2\>\"", ",", "\"\<v3\>\""}], "}"}]}], "]"}], "&"}], "/@",
           "files"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", 
              RowBox[{"Merge", "[", 
               RowBox[{"assoc", ",", "Identity"}], "]"}]}], "]"}]}], "}"}], 
          ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[105]:=",ExpressionUUID->"60473539-f4ae-485c-82c4-a63c43115042"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particles"}]], "Input",
 CellLabel->
  "In[106]:=",ExpressionUUID->"76a586ff-0b00-4e18-91ad-a49e13a60650"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"particles", "=", "particles"}], ",", 
     RowBox[{"figure", "=", "figure"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"particles", "[", "\"\<xi\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<q1\>\"", "]"}]}], "]"}], "/", 
        RowBox[{"particles", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v1\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v2\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v3\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"xx", ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[107]:=",ExpressionUUID->"e922013d-5dfb-4b1a-bb9f-17534118c62f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["03_equilibrium_distribution", "Subsection",ExpressionUUID->"7270a18e-9d09-4173-9c94-c7023b4426df"],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"a4bad336-c986-4671-8f1a-642b1a0fc66b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[130]:=",ExpressionUUID->"d56a4676-29a3-4169-a87d-7db5ec9e4a99"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[140]:=",ExpressionUUID->"ca32bc79-5f84-46f6-b9e6-2f1012c6f94f"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[141]:=",ExpressionUUID->"38e77e00-166b-4648-8d69-b55862f02b97"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->
  "In[142]:=",ExpressionUUID->"ccb72ce7-18c2-4b89-9582-004bddd33454"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"T2OT1eq", "=", "2.111"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "mom0", ",", "P1", ",", "P2", ",", "P3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{"T2OT1eq", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "T2OT1eq"}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "\[Eta]s"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"\[Eta]s", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{
                RowBox[{"\[Eta]s", "^", "2"}], " ", "\[Beta]1", " ", 
                RowBox[{"T2OT1eq", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[143]:=",ExpressionUUID->"7f40b302-12a1-4f2f-825e-f9048367d0a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[144]:=",ExpressionUUID->"ca100811-a3ae-4851-8b0d-d3368eae3e7b"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[145]:=",ExpressionUUID->"b2a077ae-e21c-430c-9ced-70b7df07377f"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->
  "In[146]:=",ExpressionUUID->"cd3d02dc-55f2-435a-a46c-345c652cd625"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"\[Theta]2O\[Theta]1eq", "=", 
      SqrtBox["2.111"]}], ",", 
     RowBox[{"\[Beta]eq", "=", ".8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "\[Eta]\[Beta]s", ",", "ns", ",", "mom0", ",", "P1", ",", "P2", ",", 
       "P3"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]\[Beta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Beta]eq", " ", 
           RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Beta]eq", " ", 
              RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]s", "-", 
          RowBox[{"\[Beta]eq", " ", "\[Eta]\[Beta]s"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "-", "\[Beta]eq"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "\[Eta]s", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]s", "/", "\[Eta]s"}]}]}], ")"}]}]}], 
              "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[147]:=",ExpressionUUID->"4a602d75-3fa8-4b7e-8dd0-cbba599afc68"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "3"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[148]:=",ExpressionUUID->"931c1cde-0829-41c0-ac42-28ebe7297eea"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[149]:=",ExpressionUUID->"2995d156-6fd1-4b2c-b813-442b7bbf7204"],

Cell[BoxData[
 RowBox[{"Extract", "[", 
  RowBox[{
   RowBox[{"particle", "[", "\"\<w\>\"", "]"}], ",", 
   RowBox[{"List", "/@", 
    RowBox[{"RandomInteger", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"particle", "[", "\"\<w\>\"", "]"}], "]"}]}], "}"}], ",", 
      "100"}], "]"}]}]}], "]"}]], "Input",
 CellLabel->
  "In[150]:=",ExpressionUUID->"ddac8818-fcbf-4b44-91c5-fc12a45442ad"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]", "=", "1.1"}], ",", 
     RowBox[{"\[Zeta]", "=", "5"}], ",", 
     RowBox[{"vs", "=", "1.8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", "ns",
        ",", "\[Theta]", ",", "b", ",", "Ab", ",", "Bz", ",", "T", ",", 
       "mom0", ",", "P1", ",", "P2", ",", "P3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Power", "[", 
        RowBox[{
         RowBox[{"Cos", "[", 
          RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], ",", 
         "\[Zeta]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", "\[Eta]s"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", "=", 
       SqrtBox["\[Beta]"]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b", "=", 
       RowBox[{"vs", "/", "\[Theta]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Ab", "=", 
       RowBox[{".5", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", " ", 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{".5", "+", 
             RowBox[{"b", "^", "2"}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bz", "=", 
       RowBox[{
        SqrtBox["\[Pi]"], 
        RowBox[{
         RowBox[{"Gamma", "[", 
          RowBox[{"1", "+", 
           RowBox[{".5", "\[Zeta]"}]}], "]"}], "/", 
         RowBox[{"Gamma", "[", 
          RowBox[{"1.5", "+", 
           RowBox[{".5", "\[Zeta]"}]}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T", "=", 
       RowBox[{".5", 
        RowBox[{"\[Beta]", "/", "Ab"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"b", 
           RowBox[{"(", 
            RowBox[{"2.5", "+", 
             RowBox[{"b", "^", "2"}]}], ")"}], 
           RowBox[{"Exp", "[", 
            RowBox[{"-", 
             RowBox[{"b", "^", "2"}]}], "]"}]}], "+", 
          RowBox[{
           SqrtBox["\[Pi]"], 
           RowBox[{"(", 
            RowBox[{".75", "+", 
             RowBox[{
              RowBox[{"b", "^", "2"}], 
              RowBox[{"(", 
               RowBox[{"3", "+", 
                RowBox[{"b", "^", "2"}]}], ")"}]}]}], ")"}], 
           RowBox[{"Erfc", "[", 
            RowBox[{"-", "b"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", 
                RowBox[{"T", "/", 
                 RowBox[{"(", 
                  RowBox[{"3", "+", "\[Zeta]"}], ")"}]}]}]}], "}"}], "]"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", "T", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"1", "+", 
                   RowBox[{".5", "\[Zeta]"}]}], ")"}], "/", 
                 RowBox[{"(", 
                  RowBox[{"3", "+", "\[Zeta]"}], ")"}]}]}]}], "}"}], "]"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[151]:=",ExpressionUUID->"80ef8233-42a0-489b-9051-37d528ca52b7"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["04_emic_anisotropy_instability", "Subsection",ExpressionUUID->"e2b2c825-8ce4-45b4-9314-46fb2223eae8"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"d78dc227-3cda-4ee8-937c-be368b12bd86"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[1027]:=",ExpressionUUID->"746fd40a-b287-47a9-be75-bc1e7c1a3148"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[1028]:=",ExpressionUUID->"4431c90f-814d-4f3b-9508-ad75ec7efc93"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[1029]:=",ExpressionUUID->"30c29f21-00c4-41e2-9dbe-21f41f2cf21a"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[1030]:=",ExpressionUUID->"dda18a96-737c-4a7d-b65b-62f980bb3d85"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1031]:=",ExpressionUUID->"9a032e1d-a722-4b8e-9f22-00ea6ec308e1"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1032]:=",ExpressionUUID->"eb211263-c78d-49ec-a522-7227477fceb2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"8b7d6a0a-7929-42c5-8dd7-7723e10e8073"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1016]:=",ExpressionUUID->"1ed1c161-c8ba-49b4-9f74-086824791775"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", "assoc"}], "}"}], ",", "Last"}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",ExpressionUUID->"d33f4080-2a72-48b3-8342-aae506e9385e"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[1018]:=",ExpressionUUID->"c8f0ab77-2393-4d98-9c8c-8011c246d788"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"partspec", "=", 
      RowBox[{"{", 
       RowBox[{"100", ",", "25"}], "}"}]}], ",", 
     RowBox[{"sampleLocs", "=", 
      RowBox[{"{", 
       RowBox[{"0", ",", "150", ",", "300", ",", "450"}], "}"}]}], ",", 
     RowBox[{"\[Omega]max", "=", "1.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "fullgrid", ",", "dB3", ",", "dB2", ",", "dB", 
       ",", "\[Omega]t", ",", "pos\[Omega]", ",", "w", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"partspec", "[", 
          RowBox[{"[", "1", "]"}], "]"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"$_Real", "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"fullgrid", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"fullgrid", ",", 
            RowBox[{
             RowBox[{"post", "[", 
              RowBox[{"field", "[", "\"\<dB2\>\"", "]"}], "]"}], 
             "\[Transpose]"}]}], "}"}], "]"}], "]"}], "[", "sampleLocs", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"Interpolation", "[", 
         RowBox[{"Thread", "[", 
          RowBox[{"{", 
           RowBox[{"fullgrid", ",", 
            RowBox[{
             RowBox[{"post", "[", 
              RowBox[{"field", "[", "\"\<dB3\>\"", "]"}], "]"}], 
             "\[Transpose]"}]}], "}"}], "]"}], "]"}], "[", "sampleLocs", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{"dB2", "-", 
        RowBox[{"I", " ", "dB3"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"partspec", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", 
          RowBox[{"partspec", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"pos\[Omega]", "@", 
            RowBox[{"Power", "[", 
             RowBox[{
              RowBox[{"Abs", "@", 
               RowBox[{"Fourier", "[", 
                RowBox[{"w", "*", "#"}], "]"}]}], ",", "2"}], "]"}]}], "&"}], 
          ",", 
          RowBox[{
           RowBox[{
            RowBox[{"Partition", "[", 
             RowBox[{"#", ",", 
              RowBox[{"Sequence", "@@", "partspec"}]}], "]"}], "&"}], "/@", 
           "dB"}], ",", 
          RowBox[{"{", "2", "}"}]}], "]"}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"Mean", "/@", 
        RowBox[{"Partition", "[", 
         RowBox[{"t", ",", 
          RowBox[{"Sequence", "@@", "partspec"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "dB", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"Dashed", ",", "\[IndentingNewLine]", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", "1"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "1"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", ".25"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}], ",", 
              RowBox[{"InfiniteLine", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", ".25"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"1", ",", "0"}], "}"}]}], "]"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"Map", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ArrayPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Transpose", "[", "#", "]"}], "//", "Reverse"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"DataRange", "->", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
                RowBox[{"\[Omega]t", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",",
              "\[IndentingNewLine]", 
             RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}]}], 
            "\[IndentingNewLine]", "]"}], "&"}], ",", "\[IndentingNewLine]", 
          "dB"}], "\[IndentingNewLine]", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Grid", "[", 
         RowBox[{"plots", "~", "Partition", "~", "2"}], "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",ExpressionUUID->"cc1528bf-494e-464f-\
a45f-bdf6f6e448ec"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1020]:=",ExpressionUUID->"e502cfdb-9dee-45f2-a2c5-35515bf9fe5e"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1021]:=",ExpressionUUID->"985713c2-86fc-491f-b0a1-0361a5a20acc"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"7a7d1ff2-2b4e-472e-ae71-25f9c847023f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1022]:=",ExpressionUUID->"0353f5ea-a3dd-47bc-a400-14d328cd24b7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"13a89a9b-\
58a9-4e61-a44f-5ebf6688177e"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[1024]:=",ExpressionUUID->"b5ab4de3-2b73-43c4-98b8-9e31f0fbdc1f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[1025]:=",ExpressionUUID->"2f16da8c-9af0-4553-b5fc-d1db29f2a472"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "q1", ",", "posx", ",", "P1", ",", "P2", ",", 
       "P3", ",", "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Position", "[", 
          RowBox[{"t", ",", 
           RowBox[{"$_Real", "/;", 
            RowBox[{"IntervalMemberQ", "[", 
             RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{"-", "1"}], ";;", "1", ";;", 
           RowBox[{"-", "5"}]}], "]"}], "]"}], "//", "Reverse"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"field", "[", "\"\<half_grid_domain_extent\>\"", "]"}]}], 
         "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"q1", ",", 
         RowBox[{"_Real", "?", "NonNegative"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"posx", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "posx", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of q1lim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"posx", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1", "=", 
       RowBox[{"q1", "//", "posx"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nv1v1\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nv2v2\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{
        RowBox[{"posx", "/@", 
         RowBox[{"post", "[", 
          RowBox[{
           RowBox[{"field", "[", "\"\<nv3v3\>\"", "]"}], "-", 
           RowBox[{
            RowBox[{
             RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
            RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], "2"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"P1", ",", "P2", ",", "P3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P1", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P2", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"P3", "-", "max"}], ")"}], "/", "max"}], "+", "1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"1", "/", "2"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", "2"}], "}"}]}], "]"}], "]"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"P1", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\!\(\*SuperscriptBox[\(q\), \(1\)]\)\\)\>\"", ",", 
               "\"\<\\!\\(t \!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<\!\(\*SubscriptBox[\(P\), \
\(\[DoubleVerticalBar]\)]\)\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".03", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"P2", "\[Transpose]"}], "//", "Reverse"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"q1", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\!\(\*SuperscriptBox[\(q\), \(1\)]\)\\)\>\"", ",", 
               "\"\<\\!\\(t \!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\""}], "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<\!\(\*SubscriptBox[\(P\), \(\(\[UpTee]\)\(1\)\)]\)\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".03", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Column", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1026]:=",ExpressionUUID->"06dd9c49-cb58-4bdc-a838-f6d5efaf5a53"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[961]:=",ExpressionUUID->"c25ce90b-a7af-4b86-ab00-e2559eadff54"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "4"}], ",", 
     RowBox[{"\[Omega]max", "=", "2.5"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[962]:=",ExpressionUUID->"f268abdc-d7a5-42e6-a563-88f3ac542153"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"5a42a692-1e9d-4df9-b132-83ccf250d5f7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[999]:=",ExpressionUUID->"5bb60ae7-acb9-4b8d-ac2a-660040d6458b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"736b1544-\
fa09-4a52-8b03-aac96116e1f9"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[1001]:=",ExpressionUUID->"3efc3525-9b2d-4fa4-9589-b23a2f95ae1e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", "*", 
      SqrtBox["10"], 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[1002]:=",ExpressionUUID->"5c52800a-c22b-4688-9fd1-49bba6b88a34"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{".01", "*", "10"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1004]:=",ExpressionUUID->"35872045-456c-4f4c-bf31-f5ecb5033a09"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"251c7d17-d111-4891-8139-e35caff7a1b0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[1005]:=",ExpressionUUID->"9ec8b438-9416-4f84-a2e1-8601c4779509"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",ExpressionUUID->"67ae2675-\
ae2a-4260-9bcc-d0ae7b715ae3"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[1007]:=",ExpressionUUID->"078b2077-525d-4f99-bfc6-b89f5c6b4c12"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", 
      RowBox[{".01", "/", "10"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[1008]:=",ExpressionUUID->"97b29667-4af8-42ba-bfa0-aeb77a34fd1a"]
}, Open  ]]
}, Closed]]
}, Closed]]
},
WindowSize->{1688, 1073},
WindowMargins->{{32, Automatic}, {Automatic, 27}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"13c7468d-72b3-4754-a7ae-58931f6d390a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 276, 6, 52, "Input",ExpressionUUID->"35414358-9cce-404a-b33a-abdb7a6986c5"],
Cell[837, 28, 335, 9, 30, "Input",ExpressionUUID->"98642d0f-5832-45f9-b8ed-04467496a470"],
Cell[1175, 39, 255, 7, 30, "Input",ExpressionUUID->"2a987feb-7c03-4ce2-aad6-c20c5afee12a"],
Cell[CellGroupData[{
Cell[1455, 50, 80, 0, 67, "Section",ExpressionUUID->"9b762f27-4219-427f-9e79-ed8f4cdb4c7f"],
Cell[CellGroupData[{
Cell[1560, 54, 99, 0, 54, "Subsection",ExpressionUUID->"7a848a5a-aba4-4b48-a057-e00fb269e622"],
Cell[CellGroupData[{
Cell[1684, 58, 86, 0, 45, "Subsubsection",ExpressionUUID->"c6776fc6-170e-4c85-8be8-fb0455cd75f4"],
Cell[1773, 60, 3607, 88, 304, "Input",ExpressionUUID->"0a3b8942-02d9-4e97-b7a4-fde7759b5922"],
Cell[5383, 150, 143, 2, 30, "Input",ExpressionUUID->"7cb0b11d-5057-4184-96b5-71e03da3d996"],
Cell[5529, 154, 5534, 133, 451, "Input",ExpressionUUID->"b09a43c0-ee69-41ea-9af1-337d08b98870"],
Cell[11066, 289, 4948, 121, 493, "Input",ExpressionUUID->"d91caf77-0cde-4350-bdc1-36afcbcbc488"],
Cell[16017, 412, 5411, 137, 493, "Input",ExpressionUUID->"61d0a445-f7fd-40bd-a08d-4749f3a3b19a"],
Cell[21431, 551, 5064, 130, 409, "Input",ExpressionUUID->"55deacc0-898f-4621-8934-8d58830930c0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26532, 686, 85, 0, 45, "Subsubsection",ExpressionUUID->"fe45854c-eb52-4c34-804d-e0fa09830067"],
Cell[26620, 688, 2528, 66, 241, "Input",ExpressionUUID->"6a0638a8-aaee-4965-be25-1670ff82ffc2"],
Cell[29151, 756, 1493, 40, 157, "Input",ExpressionUUID->"50a9efda-d764-4a41-82a5-3c129608138d"],
Cell[30647, 798, 142, 2, 30, "Input",ExpressionUUID->"eebd8508-0302-44e4-af48-83820ff9683f"],
Cell[30792, 802, 13564, 338, 1067, "Input",ExpressionUUID->"d92d7554-db5f-46aa-852f-7cf228ebb7c6"],
Cell[44359, 1142, 16133, 400, 1264, "Input",ExpressionUUID->"16b8b2f9-aaad-4475-989d-1bd4692e16ce"]
}, Open  ]],
Cell[CellGroupData[{
Cell[60529, 1547, 86, 0, 45, "Subsubsection",ExpressionUUID->"d23e26ea-413a-4d7d-a17f-d7078d878b09"],
Cell[60618, 1549, 2530, 66, 241, "Input",ExpressionUUID->"fc6b6562-aa0c-4781-95a6-ed21fe4d8940"],
Cell[63151, 1617, 1653, 43, 157, "Input",ExpressionUUID->"c264884a-1e5f-4535-8ae2-8d0f087025ef"],
Cell[64807, 1662, 143, 2, 30, "Input",ExpressionUUID->"09442f77-de8b-4de7-840e-c972682d3590"],
Cell[64953, 1666, 300, 8, 30, "Input",ExpressionUUID->"3f35607c-0b71-4b14-b0f7-42e245994ba0"],
Cell[65256, 1676, 9875, 252, 786, "Input",ExpressionUUID->"ee0dc67b-1e6b-40e0-bb53-9e34106fa2ef"],
Cell[75134, 1930, 16555, 411, 1264, "Input",ExpressionUUID->"f87b0d0a-1294-4226-874c-71f40e5b80a7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[91726, 2346, 88, 0, 45, "Subsubsection",ExpressionUUID->"f930aad0-3d2f-4c25-be79-99f24e19ae52"],
Cell[91817, 2348, 2548, 66, 241, "Input",ExpressionUUID->"5e1a0dcd-43e9-42f1-a326-c312f75028d0"],
Cell[94368, 2416, 1594, 42, 157, "Input",ExpressionUUID->"2a16fd78-b5a6-4541-90fb-a4c692ea3424"],
Cell[95965, 2460, 145, 2, 30, "Input",ExpressionUUID->"67cbd786-f700-4c50-b56e-b0ae355c4c92"],
Cell[96113, 2464, 443, 12, 52, "Input",ExpressionUUID->"4f76be3a-5844-407a-9dee-966685d6f2c1"],
Cell[96559, 2478, 6478, 138, 1206, "Input",ExpressionUUID->"61b094eb-e36e-4616-baa5-ffa29ccc27ef"]
}, Open  ]],
Cell[CellGroupData[{
Cell[103074, 2621, 85, 0, 45, "Subsubsection",ExpressionUUID->"9e31b8e6-9d24-40eb-8f28-e4b857c4fb31"],
Cell[103162, 2623, 2546, 66, 241, "Input",ExpressionUUID->"9b3ea0d2-447c-4220-bfa7-2aab7846efae"],
Cell[105711, 2691, 1593, 42, 157, "Input",ExpressionUUID->"cd506471-4841-4afd-be44-513875af4e36"],
Cell[107307, 2735, 142, 2, 30, "Input",ExpressionUUID->"88615e18-c871-4c47-a251-720bcf61486f"],
Cell[107452, 2739, 7851, 173, 1248, "Input",ExpressionUUID->"83075589-4a05-4595-b05d-f1b5d38dc115"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[115352, 2918, 93, 0, 38, "Subsection",ExpressionUUID->"12ff51a1-f2a2-4258-a9e0-30b1754a91dd"],
Cell[CellGroupData[{
Cell[115470, 2922, 85, 0, 45, "Subsubsection",ExpressionUUID->"ad406739-b333-4148-b0bf-19f0911d6e7a"],
Cell[115558, 2924, 3688, 98, 430, "Input",ExpressionUUID->"1114d31a-7b88-451c-93cf-353ef1b2240a"],
Cell[119249, 3024, 1512, 41, 199, "Input",ExpressionUUID->"7cb87010-c713-486e-b15e-b7878b4e3067"],
Cell[120764, 3067, 8690, 211, 619, "Input",ExpressionUUID->"cc12956e-a916-45dd-b0b6-3ca21bbe03a6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[129491, 3283, 88, 0, 45, "Subsubsection",ExpressionUUID->"0f2fe521-d50b-4664-bd75-9161ecf7cade"],
Cell[129582, 3285, 2548, 66, 241, "Input",ExpressionUUID->"6e4dccb9-c148-4c83-bfc1-71b49b7c7a17"],
Cell[132133, 3353, 1574, 40, 136, "Input",ExpressionUUID->"50b21277-8b1a-4283-8497-706b1807f865"],
Cell[133710, 3395, 146, 2, 30, "Input",ExpressionUUID->"3abf6406-9d86-4bb0-952c-855ed67b8069"],
Cell[133859, 3399, 5050, 110, 577, "Input",ExpressionUUID->"f628baa5-467e-4b60-80b8-8ebbdff606d3"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[138958, 3515, 104, 0, 38, "Subsection",ExpressionUUID->"248cf7f7-060d-49b2-a43c-a6f21b548731"],
Cell[CellGroupData[{
Cell[139087, 3519, 88, 0, 45, "Subsubsection",ExpressionUUID->"59c51e44-867f-41f8-8066-ba8064fc41aa"],
Cell[139178, 3521, 2548, 66, 241, "Input",ExpressionUUID->"d5761db1-3e45-4022-b3e8-3467bb2f9466"],
Cell[141729, 3589, 1174, 31, 136, "Input",ExpressionUUID->"90c1b668-6319-463f-b2d4-9c305aff5f03"],
Cell[142906, 3622, 145, 2, 30, "Input",ExpressionUUID->"820bc3e5-ae74-46bb-a9d9-12f06423fe43"],
Cell[143054, 3626, 455, 12, 30, "Input",ExpressionUUID->"b54cfed9-213d-4bbf-9080-b631f1ac11aa"],
Cell[143512, 3640, 6562, 158, 661, "Input",ExpressionUUID->"88b7a3e5-0f6e-4e13-8a67-4e97dc72534c"],
Cell[150077, 3800, 1174, 31, 136, "Input",ExpressionUUID->"ed495d52-317f-4333-9c46-918e8314cd61"],
Cell[151254, 3833, 145, 2, 30, "Input",ExpressionUUID->"85176739-00db-418c-b80d-f35a2246377c"],
Cell[151402, 3837, 455, 12, 30, "Input",ExpressionUUID->"eca78e2d-0140-4b23-b259-bfb1dfc46a05"],
Cell[151860, 3851, 7923, 192, 717, "Input",ExpressionUUID->"6aebea96-f446-48e0-a65c-a2c94c842a59"],
Cell[159786, 4045, 1174, 31, 136, "Input",ExpressionUUID->"0e502284-8c90-40ee-9d2c-f2f775a156ad"],
Cell[160963, 4078, 145, 2, 30, "Input",ExpressionUUID->"806fd733-6a12-48a7-b7d8-4af70947331e"],
Cell[161111, 4082, 455, 12, 30, "Input",ExpressionUUID->"755d9e82-3aa6-4d8c-8d6a-ba8dd4d6aef9"],
Cell[161569, 4096, 8641, 219, 831, "Input",ExpressionUUID->"2b0c24c7-6ab8-46d5-a4cf-42f65ab7ed4c"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[170259, 4321, 111, 0, 38, "Subsection",ExpressionUUID->"955fbcbb-48d3-4368-8872-f36084005a11"],
Cell[CellGroupData[{
Cell[170395, 4325, 86, 0, 45, "Subsubsection",ExpressionUUID->"5640419b-9a82-493a-8d96-a2d1db72643b"],
Cell[170484, 4327, 3611, 89, 304, "Input",ExpressionUUID->"12637b7e-e12c-4bf0-acd8-41638ea1e41b"],
Cell[174098, 4418, 147, 3, 30, "Input",ExpressionUUID->"8a93c410-5263-4a24-8541-9d32bf379ad9"],
Cell[174248, 4423, 5538, 134, 451, "Input",ExpressionUUID->"f984cbe1-ad2a-476e-b620-aa87cabf7cec"],
Cell[179789, 4559, 4952, 122, 493, "Input",ExpressionUUID->"188d3419-2be7-49d4-9bb3-5958dde61bb7"],
Cell[184744, 4683, 5415, 138, 493, "Input",ExpressionUUID->"d424de56-a667-443c-954f-a5fc3e9f96b8"],
Cell[190162, 4823, 5068, 131, 409, "Input",ExpressionUUID->"682be251-c085-4aee-8504-689ae093cd2f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[195267, 4959, 85, 0, 45, "Subsubsection",ExpressionUUID->"23e6502a-800d-42cf-8ca8-b08a5f40718b"],
Cell[195355, 4961, 2532, 67, 241, "Input",ExpressionUUID->"0d699bc1-c4d0-4660-bd73-3427e4cf0fa4"],
Cell[197890, 5030, 1035, 28, 136, "Input",ExpressionUUID->"5a64f3ab-9a51-4646-90fa-0e49edf304fa"],
Cell[198928, 5060, 146, 3, 30, "Input",ExpressionUUID->"66ec21cd-6578-43a2-9181-f9d3dbfba81c"],
Cell[199077, 5065, 11032, 284, 871, "Input",ExpressionUUID->"903fd496-7496-46ac-ab37-e7ccfdab71a7"],
Cell[210112, 5351, 13568, 339, 1067, "Input",ExpressionUUID->"e0ef405b-4ed3-412e-bae4-868dbc8abff6"],
Cell[223683, 5692, 16137, 401, 1264, "Input",ExpressionUUID->"1ee23c6d-40aa-44f9-a989-44066e393b5c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[239857, 6098, 86, 0, 45, "Subsubsection",ExpressionUUID->"d05201f4-17f4-41a5-a674-9c71b2a3a94f"],
Cell[239946, 6100, 2534, 67, 241, "Input",ExpressionUUID->"280ee7ad-8f60-4372-8f53-149a87f6a148"],
Cell[242483, 6169, 1211, 32, 136, "Input",ExpressionUUID->"6bcca795-4a19-48fd-af95-74ce699bdbf4"],
Cell[243697, 6203, 147, 3, 30, "Input",ExpressionUUID->"79873bb0-41eb-4523-a46b-9209e405ddc2"],
Cell[243847, 6208, 304, 9, 30, "Input",ExpressionUUID->"dd84f8c4-f914-448e-9a2f-deeb0f848c11"],
Cell[244154, 6219, 10178, 257, 916, "Input",ExpressionUUID->"b0f67790-64fc-4a40-acb7-ee42cc9fe71f"],
Cell[254335, 6478, 9879, 253, 786, "Input",ExpressionUUID->"7f2f7c20-0847-401a-9f3e-d04dcc4d2cfe"],
Cell[264217, 6733, 16559, 412, 1264, "Input",ExpressionUUID->"bfc11b4e-073a-4ee0-9101-f64acc8a8f9f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[280813, 7150, 88, 0, 45, "Subsubsection",ExpressionUUID->"ffde4ce8-cb71-4a16-83ef-b75f6bd17a4c"],
Cell[280904, 7152, 2552, 67, 241, "Input",ExpressionUUID->"c252d70d-bdfb-4258-afad-5992cc455b92"],
Cell[283459, 7221, 1152, 31, 136, "Input",ExpressionUUID->"772be807-8d69-41b5-8b01-dd79a2fe26d6"],
Cell[284614, 7254, 149, 3, 30, "Input",ExpressionUUID->"e9cd32b8-e19b-4cf0-8a4c-18e674a314bd"],
Cell[284766, 7259, 448, 13, 52, "Input",ExpressionUUID->"7af93b55-dfc6-468d-aa94-ffbfff2e7923"],
Cell[285217, 7274, 6481, 139, 1206, "Input",ExpressionUUID->"845efa36-916e-4653-8549-8139f3cef155"]
}, Open  ]],
Cell[CellGroupData[{
Cell[291735, 7418, 85, 0, 45, "Subsubsection",ExpressionUUID->"1dd12eef-ba26-416a-82bb-6436906c4e69"],
Cell[291823, 7420, 2550, 67, 241, "Input",ExpressionUUID->"1a1c4cf9-29b8-4ef7-b3d1-6196dbc07f60"],
Cell[294376, 7489, 1151, 31, 136, "Input",ExpressionUUID->"60ccddad-f998-4bf9-8641-1e49d66102b7"],
Cell[295530, 7522, 146, 3, 30, "Input",ExpressionUUID->"50bed9eb-d3fe-402d-a16a-78c79aa4faf3"],
Cell[295679, 7527, 7942, 176, 1248, "Input",ExpressionUUID->"f3a925a6-b4b3-4ca0-a177-724ccdff4f87"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[303670, 7709, 111, 0, 38, "Subsection",ExpressionUUID->"11ac30f6-f7b3-408e-8e98-764df1779594"],
Cell[303784, 7711, 9864, 295, 572, "Text",ExpressionUUID->"b6e89462-517a-4272-b1c8-9d3cff229ac2"],
Cell[CellGroupData[{
Cell[313673, 8010, 86, 0, 45, "Subsubsection",ExpressionUUID->"83033dc3-03fe-494c-83f8-09a7cea38e20"],
Cell[313762, 8012, 2762, 68, 241, "Input",ExpressionUUID->"2e8b766d-de28-4724-a82e-57ce13041cc0"],
Cell[316527, 8082, 143, 2, 30, "Input",ExpressionUUID->"df84e1b8-9996-4549-9865-d8ca561e7844"],
Cell[316673, 8086, 3666, 90, 388, "Input",ExpressionUUID->"2c1cc811-5c56-4e7d-b239-a909122267ca"]
}, Open  ]],
Cell[CellGroupData[{
Cell[320376, 8181, 85, 0, 45, "Subsubsection",ExpressionUUID->"e536acb6-4a1e-4aa4-95ad-c153a3c8e5d2"],
Cell[320464, 8183, 2528, 66, 241, "Input",ExpressionUUID->"639fc146-ee71-401b-b564-530a8d923343"],
Cell[322995, 8251, 1059, 29, 136, "Input",ExpressionUUID->"ec8856e0-822a-4821-9d37-d89f71c03e42"],
Cell[324057, 8282, 142, 2, 30, "Input",ExpressionUUID->"b29509a6-b8fd-4608-b022-c7e0bca85e64"],
Cell[324202, 8286, 4223, 100, 640, "Input",ExpressionUUID->"2b8505e6-36c9-40bf-89b6-9b84b4ac0b31"],
Cell[328428, 8388, 8347, 207, 871, "Input",ExpressionUUID->"d9fc689b-c383-4cc9-8df1-736bde95232d"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[336836, 8602, 84, 0, 53, "Section",ExpressionUUID->"163ba665-8fd0-405d-9580-3a36d2aa6564"],
Cell[CellGroupData[{
Cell[336945, 8606, 99, 0, 54, "Subsection",ExpressionUUID->"0da3b5f0-b6f0-4c4c-8d28-cd56d6451203"],
Cell[CellGroupData[{
Cell[337069, 8610, 86, 0, 45, "Subsubsection",ExpressionUUID->"0d1a11ea-b118-44af-ac1f-533e02602631"],
Cell[337158, 8612, 3867, 95, 304, "Input",ExpressionUUID->"8807c4e3-ec8d-496b-9639-11286153d68d"],
Cell[341028, 8709, 147, 3, 30, "Input",ExpressionUUID->"3aecea53-b05d-49c4-9ec0-e3372b3169fa"],
Cell[341178, 8714, 7429, 179, 514, "Input",ExpressionUUID->"fd926f80-4ec6-41c0-af51-2d89552b2dc3"],
Cell[348610, 8895, 4952, 122, 493, "Input",ExpressionUUID->"b9d89e3d-c23a-4872-ab1d-d54f05e0260a"],
Cell[353565, 9019, 5415, 138, 493, "Input",ExpressionUUID->"1645c18c-99fb-4bdc-b9b5-1e39bd48ed84"],
Cell[358983, 9159, 5068, 131, 409, "Input",ExpressionUUID->"9149625c-b2c0-4d94-81b2-316193133685"]
}, Open  ]],
Cell[CellGroupData[{
Cell[364088, 9295, 85, 0, 45, "Subsubsection",ExpressionUUID->"9d9a9dd3-2db6-4688-8aaf-7f6670fe20bf"],
Cell[364176, 9297, 2532, 67, 241, "Input",ExpressionUUID->"7147733f-960f-4fb6-bed6-867e0a542b88"],
Cell[366711, 9366, 1497, 41, 157, "Input",ExpressionUUID->"338b1c37-8c81-413b-99ad-14c9e76a4ca2"],
Cell[368211, 9409, 146, 3, 30, "Input",ExpressionUUID->"69847ad8-f216-425c-a972-e228e75f5c75"],
Cell[368360, 9414, 13568, 339, 1067, "Input",ExpressionUUID->"69300999-d15e-451f-b681-bd1f0845c765"],
Cell[381931, 9755, 16137, 401, 1264, "Input",ExpressionUUID->"22e97311-975a-4a17-ad36-521ef11dd714"]
}, Open  ]],
Cell[CellGroupData[{
Cell[398105, 10161, 86, 0, 45, "Subsubsection",ExpressionUUID->"91571c8e-def2-4c33-85cb-150cadd3b274"],
Cell[398194, 10163, 2534, 67, 241, "Input",ExpressionUUID->"cf8d80ec-6943-4058-8466-6c887c362b2c"],
Cell[400731, 10232, 1669, 44, 157, "Input",ExpressionUUID->"bfc2b61e-66d8-4145-bd3f-b202fa3bcce8"],
Cell[402403, 10278, 147, 3, 30, "Input",ExpressionUUID->"039fc0d3-7707-4cfa-87ac-046b662f0765"],
Cell[402553, 10283, 304, 9, 30, "Input",ExpressionUUID->"7861b5a9-720e-4095-9170-0b78abbfe05b"],
Cell[402860, 10294, 9879, 253, 786, "Input",ExpressionUUID->"e463224c-a3e7-4bf7-8b01-b03a3e674d32"],
Cell[412742, 10549, 16559, 412, 1264, "Input",ExpressionUUID->"bd9b575a-38d2-468a-8bf9-00babf562648"],
Cell[429304, 10963, 10196, 261, 786, "Input",ExpressionUUID->"b5778f75-0ad5-4cc6-9ac2-a7a9a42cf765"],
Cell[439503, 11226, 16818, 415, 1362, "Input",ExpressionUUID->"711d5ef3-7dd2-453a-800d-5a85fc5ec2d9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[456358, 11646, 88, 0, 45, "Subsubsection",ExpressionUUID->"ffe42cc3-6ba8-4ec4-8498-21d8edeae960"],
Cell[456449, 11648, 2552, 67, 241, "Input",ExpressionUUID->"b8295a59-82b4-4bda-b891-af8ad09fc534"],
Cell[459004, 11717, 1610, 43, 157, "Input",ExpressionUUID->"bd1d3b2c-1931-4a6f-8aac-9a908d9457d6"],
Cell[460617, 11762, 149, 3, 30, "Input",ExpressionUUID->"b45f13e5-b21b-4995-be2a-e1d67885a3d1"],
Cell[460769, 11767, 447, 13, 52, "Input",ExpressionUUID->"22228e5a-54ce-4d1d-88bc-ac0c99d84e96"],
Cell[461219, 11782, 6482, 139, 1206, "Input",ExpressionUUID->"bd0111ba-1892-4715-88c9-8c008983096f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[467738, 11926, 85, 0, 45, "Subsubsection",ExpressionUUID->"1c183399-e840-48c5-87bf-b3c0af7e4f2d"],
Cell[467826, 11928, 2550, 67, 241, "Input",ExpressionUUID->"d4a5a1e2-853e-49b2-86d1-d212dacf8094"],
Cell[470379, 11997, 1597, 43, 157, "Input",ExpressionUUID->"928687ae-b547-43b3-8022-d43e9b39efd9"],
Cell[471979, 12042, 146, 3, 30, "Input",ExpressionUUID->"0e16ba5b-12e6-47fc-a972-bfa6821bef98"],
Cell[472128, 12047, 7855, 174, 1248, "Input",ExpressionUUID->"263ffaaf-ed62-470d-b8b9-6fe9c380897d"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[480032, 12227, 93, 0, 38, "Subsection",ExpressionUUID->"dee97a49-9f34-42fe-a754-eb12502f33ac"],
Cell[CellGroupData[{
Cell[480150, 12231, 85, 0, 45, "Subsubsection",ExpressionUUID->"09e4d96b-96f9-4161-a973-0e4a57e332ae"],
Cell[480238, 12233, 4157, 108, 451, "Input",ExpressionUUID->"93076d1c-9425-4bcd-bc17-d5c02a48a42d"],
Cell[484398, 12343, 1516, 42, 199, "Input",ExpressionUUID->"791b97e8-8417-4daf-987a-f003df120cd8"],
Cell[485917, 12387, 9742, 238, 716, "Input",ExpressionUUID->"e7dee2aa-b573-4f5d-8407-8302133eb552"]
}, Open  ]],
Cell[CellGroupData[{
Cell[495696, 12630, 88, 0, 45, "Subsubsection",ExpressionUUID->"47a45929-8cb2-4784-96e4-3fed653a158f"],
Cell[495787, 12632, 2552, 67, 241, "Input",ExpressionUUID->"bdaddcf9-af69-4c36-9938-f161f8f23ee4"],
Cell[498342, 12701, 1590, 41, 136, "Input",ExpressionUUID->"6ba9fcdc-0ae5-48ef-aa65-efb13191da8a"],
Cell[499935, 12744, 150, 3, 30, "Input",ExpressionUUID->"3aa96428-bbca-41b4-8f90-772f9d722c6c"],
Cell[500088, 12749, 4013, 87, 493, "Input",ExpressionUUID->"76cd5ce3-c68b-4cc8-968c-014dcd0674e8"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[504150, 12842, 104, 0, 38, "Subsection",ExpressionUUID->"0b4cc019-c60e-4c2a-b7a8-841371401aac"],
Cell[CellGroupData[{
Cell[504279, 12846, 88, 0, 45, "Subsubsection",ExpressionUUID->"8a6b4402-b769-44bd-a5e4-9e4d3c10b9ee"],
Cell[504370, 12848, 2552, 67, 241, "Input",ExpressionUUID->"4cb53ca9-4784-406b-a128-6cfc28587dd4"],
Cell[506925, 12917, 1190, 32, 136, "Input",ExpressionUUID->"1e15b98e-888d-47a2-89b7-7104a6476ca5"],
Cell[508118, 12951, 149, 3, 30, "Input",ExpressionUUID->"70ebb9eb-c69d-4954-8e32-5641f585c7fb"],
Cell[508270, 12956, 433, 12, 30, "Input",ExpressionUUID->"414bc519-26e4-492b-bbc9-31fb745c8216"],
Cell[508706, 12970, 11005, 272, 766, "Input",ExpressionUUID->"1d0ef20e-c74f-4116-9f6e-d6f785dc620d"],
Cell[519714, 13244, 1190, 32, 136, "Input",ExpressionUUID->"c65b7fef-a4af-4cb6-87e8-282ce58ea2ab"],
Cell[520907, 13278, 149, 3, 30, "Input",ExpressionUUID->"9c02a2c2-5fb9-49dc-873e-09fcf8d67e18"],
Cell[521059, 13283, 433, 12, 30, "Input",ExpressionUUID->"ff04b8af-20cc-4974-8e51-6ae6a7a9e77c"],
Cell[521495, 13297, 14300, 345, 1011, "Input",ExpressionUUID->"226eafcb-3860-4f1b-85d8-314673996fc8"],
Cell[535798, 13644, 1190, 32, 136, "Input",ExpressionUUID->"dcf6b43a-ce40-4c49-8f31-be1ae1a74fbd"],
Cell[536991, 13678, 149, 3, 30, "Input",ExpressionUUID->"3404d0fe-412a-4129-964c-f54e5a195ea3"],
Cell[537143, 13683, 433, 12, 30, "Input",ExpressionUUID->"c9cd9156-d50c-41a8-9063-a8caa6e09315"],
Cell[537579, 13697, 14580, 381, 929, "Input",ExpressionUUID->"1f7dc602-0dad-4b5d-ac06-b3bb706db840"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[552208, 14084, 111, 0, 38, "Subsection",ExpressionUUID->"4ad95c69-10c4-47aa-a789-da3a98d39e2b"],
Cell[CellGroupData[{
Cell[552344, 14088, 86, 0, 45, "Subsubsection",ExpressionUUID->"18065d79-877e-4249-ad95-bce7ce9617f9"],
Cell[552433, 14090, 3839, 93, 304, "Input",ExpressionUUID->"aae450eb-f661-481f-8d2e-a7e05d0d1991"],
Cell[556275, 14185, 148, 3, 30, "Input",ExpressionUUID->"8f74d52a-4b51-4dda-ac83-000318535b86"],
Cell[556426, 14190, 7430, 179, 514, "Input",ExpressionUUID->"d9451187-42ba-47b2-a771-40a84b4483bc"],
Cell[563859, 14371, 4953, 122, 493, "Input",ExpressionUUID->"81c52bb0-256e-4a0d-88ca-663f729fc290"],
Cell[568815, 14495, 5416, 138, 493, "Input",ExpressionUUID->"c732b4f2-95af-4cf0-8138-cf5443681c1e"],
Cell[574234, 14635, 5069, 131, 409, "Input",ExpressionUUID->"43f5c49f-11f0-4949-af5e-516d6133403b"]
}, Open  ]],
Cell[CellGroupData[{
Cell[579340, 14771, 85, 0, 45, "Subsubsection",ExpressionUUID->"538fbbce-3733-450f-ba7a-81f0da6e611d"],
Cell[579428, 14773, 2533, 67, 241, "Input",ExpressionUUID->"5bc624e6-c8ca-428f-8a0c-871d8e606011"],
Cell[581964, 14842, 1064, 30, 136, "Input",ExpressionUUID->"d3a04fac-aa9b-40d1-90a8-556e992301c7"],
Cell[583031, 14874, 147, 3, 30, "Input",ExpressionUUID->"4902d5dd-95a2-42b0-9d57-0c1f9995f885"],
Cell[583181, 14879, 11033, 284, 871, "Input",ExpressionUUID->"de2e79d2-8362-47b8-9a48-572f9c6f0c5b"],
Cell[594217, 15165, 5780, 146, 598, "Input",ExpressionUUID->"d06e55a7-47fc-4074-8b3d-ee49ba7ba881"],
Cell[600000, 15313, 13569, 339, 1067, "Input",ExpressionUUID->"d60791df-bb46-4db1-8e1f-5b31e8767587"],
Cell[613572, 15654, 16138, 401, 1264, "Input",ExpressionUUID->"4585bc0e-c822-473c-8d68-6c18072a0673"]
}, Open  ]],
Cell[CellGroupData[{
Cell[629747, 16060, 86, 0, 45, "Subsubsection",ExpressionUUID->"71a44c54-da91-4f1d-b73f-e991ce3c55f9"],
Cell[629836, 16062, 2535, 67, 241, "Input",ExpressionUUID->"6338a44a-b53e-47bc-870a-2a9768a5aa34"],
Cell[632374, 16131, 1250, 33, 136, "Input",ExpressionUUID->"33b9d70c-0d95-4f6d-a2fd-843c5cf3d55f"],
Cell[633627, 16166, 148, 3, 30, "Input",ExpressionUUID->"24ce44d7-b0fa-49ea-a6c2-2e5675708e35"],
Cell[633778, 16171, 305, 9, 30, "Input",ExpressionUUID->"8406d3c9-b58a-4608-b90f-f17ea633e582"],
Cell[634086, 16182, 10152, 256, 916, "Input",ExpressionUUID->"23c416c1-a235-41f3-9f33-1100723a23f4"],
Cell[644241, 16440, 9875, 252, 786, "Input",ExpressionUUID->"dbad6ebf-cae8-44a3-ba9d-85b8fd476850"],
Cell[654119, 16694, 16555, 411, 1264, "Input",ExpressionUUID->"469972d6-6a52-4b6f-bc4c-be8a59475cab"],
Cell[670677, 17107, 10192, 260, 786, "Input",ExpressionUUID->"2d2efebb-7a61-4031-a39c-2172bd3a0d92"],
Cell[680872, 17369, 16814, 414, 1362, "Input",ExpressionUUID->"15eef123-05a1-4819-993b-fc92f58646a1"]
}, Open  ]],
Cell[CellGroupData[{
Cell[697723, 17788, 88, 0, 45, "Subsubsection",ExpressionUUID->"18553aef-e916-4318-84fe-a4e5303727f2"],
Cell[697814, 17790, 2553, 67, 241, "Input",ExpressionUUID->"863af7e7-8a9a-4df8-95b9-bd7958891789"],
Cell[700370, 17859, 1191, 32, 136, "Input",ExpressionUUID->"ace63c7b-17aa-4525-a086-3fe071ee9ef6"],
Cell[701564, 17893, 150, 3, 30, "Input",ExpressionUUID->"bfe565af-8ead-4546-9c6e-be34718254bd"],
Cell[701717, 17898, 498, 15, 59, "Input",ExpressionUUID->"1321023b-ecaa-410f-8aed-34bceed8d4b1"],
Cell[702218, 17915, 6511, 140, 1206, "Input",ExpressionUUID->"df675d0c-e8ab-4244-ba34-20bfe4d5f91f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[708766, 18060, 85, 0, 45, "Subsubsection",ExpressionUUID->"e086e0bd-3862-45fc-ae43-78ab7bc76fa9"],
Cell[708854, 18062, 2551, 67, 241, "Input",ExpressionUUID->"32bfb2ce-3a85-4565-9a2a-bb1ec0af27bf"],
Cell[711408, 18131, 1178, 32, 136, "Input",ExpressionUUID->"2506b01e-dae8-44ed-bd4c-0c5b345422ac"],
Cell[712589, 18165, 147, 3, 30, "Input",ExpressionUUID->"3ee9d24c-490d-4003-9deb-80cda4b628b5"],
Cell[712739, 18170, 7909, 175, 1248, "Input",ExpressionUUID->"4f341d95-67b6-49bc-ba14-b3d5fafbf6e4"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[720697, 18351, 111, 0, 38, "Subsection",ExpressionUUID->"ddabeeff-7684-42c0-bbf9-77b4809e5baf"],
Cell[720811, 18353, 9489, 282, 572, "Text",ExpressionUUID->"bb5180d1-a280-4659-9537-98dc69b1eb2c"],
Cell[CellGroupData[{
Cell[730325, 18639, 86, 0, 45, "Subsubsection",ExpressionUUID->"127ad174-1734-4278-8bee-a4a000c61256"],
Cell[730414, 18641, 2766, 69, 241, "Input",ExpressionUUID->"7050a40e-2fff-4674-a7e0-7a310949f3e6"],
Cell[733183, 18712, 147, 3, 30, "Input",ExpressionUUID->"acb96b8b-d0d3-4db1-8deb-8f36685ead59"],
Cell[733333, 18717, 3670, 91, 388, "Input",ExpressionUUID->"d2f80a14-a4c3-4c0c-bc12-0fc336710f85"]
}, Open  ]],
Cell[CellGroupData[{
Cell[737040, 18813, 85, 0, 45, "Subsubsection",ExpressionUUID->"88e29246-a6cd-44ee-b639-c9009853426b"],
Cell[737128, 18815, 2532, 67, 241, "Input",ExpressionUUID->"ae0d0f3b-a917-4f60-a99c-42042683646d"],
Cell[739663, 18884, 1063, 30, 136, "Input",ExpressionUUID->"ba7c203b-cc14-4a00-ad93-b771b491d964"],
Cell[740729, 18916, 146, 3, 30, "Input",ExpressionUUID->"bef0aa91-291f-4952-98a1-840d61ac57b2"],
Cell[740878, 18921, 4227, 101, 640, "Input",ExpressionUUID->"98a9290e-a163-48c8-a696-d2d061d6cefc"],
Cell[745108, 19024, 8351, 208, 871, "Input",ExpressionUUID->"37176db6-86ab-4527-b996-df6e95337db6"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[753520, 19239, 83, 0, 67, "Section",ExpressionUUID->"9ef99579-bb41-40c5-b013-d697ac8909e0"],
Cell[CellGroupData[{
Cell[753628, 19243, 95, 0, 54, "Subsection",ExpressionUUID->"e1347178-35eb-4a94-a91c-ba6dc557560a"],
Cell[CellGroupData[{
Cell[753748, 19247, 86, 0, 45, "Subsubsection",ExpressionUUID->"381cfa11-8200-4d99-a9aa-a7dc86dd28de"],
Cell[753837, 19249, 3611, 89, 304, "Input",ExpressionUUID->"3fe88431-1279-4c54-9695-9e823972b42e"],
Cell[757451, 19340, 147, 3, 30, "Input",ExpressionUUID->"c2393e1f-1ffc-40da-b0fc-c2f02b55061c"],
Cell[757601, 19345, 5538, 134, 451, "Input",ExpressionUUID->"b84b5ef3-991c-467a-9196-d465d0550ded"],
Cell[763142, 19481, 4952, 122, 493, "Input",ExpressionUUID->"d5660d51-7188-4f75-a5fb-c33d46180fcd"],
Cell[768097, 19605, 5415, 138, 493, "Input",ExpressionUUID->"1c034072-b703-4954-9367-18792528649b"],
Cell[773515, 19745, 5068, 131, 409, "Input",ExpressionUUID->"e1508f6b-345c-4d05-b906-9702b467099c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[778620, 19881, 85, 0, 45, "Subsubsection",ExpressionUUID->"13b7c2f1-d652-46ec-b800-4707f9079059"],
Cell[778708, 19883, 2532, 67, 241, "Input",ExpressionUUID->"7b88ca36-cad5-4c59-9ffe-5bf1d18c9435"],
Cell[781243, 19952, 1497, 41, 157, "Input",ExpressionUUID->"f051950d-a748-4f9e-8301-fb92033b78bd"],
Cell[782743, 19995, 146, 3, 30, "Input",ExpressionUUID->"80043343-ceed-43d7-a203-b7297d3acb4b"],
Cell[782892, 20000, 13088, 328, 1046, "Input",ExpressionUUID->"92ac6757-246f-42dd-8e2c-ea33a7a35dcb"],
Cell[795983, 20330, 15657, 390, 1243, "Input",ExpressionUUID->"8d354012-f55b-4173-aaf8-5e60bbac78df"]
}, Open  ]],
Cell[CellGroupData[{
Cell[811677, 20725, 86, 0, 45, "Subsubsection",ExpressionUUID->"9d98fa21-0fcb-426d-b646-77bcb2295aa0"],
Cell[811766, 20727, 2534, 67, 241, "Input",ExpressionUUID->"8b0feb06-83c6-41bc-880a-6acf24156d1d"],
Cell[814303, 20796, 1657, 44, 157, "Input",ExpressionUUID->"4495ff96-619a-4f61-ac2b-5b8fa7247acb"],
Cell[815963, 20842, 147, 3, 30, "Input",ExpressionUUID->"bc404668-761a-4a4e-ae81-b907de328c24"],
Cell[816113, 20847, 304, 9, 30, "Input",ExpressionUUID->"54d4e6df-3241-4f61-942c-1c917a166c84"],
Cell[816420, 20858, 9879, 253, 786, "Input",ExpressionUUID->"e928620d-5b81-428a-980e-9315ffe6068c"],
Cell[826302, 21113, 16079, 401, 1243, "Input",ExpressionUUID->"ff1a082d-e175-4941-a9a0-364fadbb392e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[842418, 21519, 88, 0, 45, "Subsubsection",ExpressionUUID->"becc40bf-9554-4f7b-9000-f72558511078"],
Cell[842509, 21521, 2552, 67, 241, "Input",ExpressionUUID->"5c673f6c-afba-4a1a-9b56-74150bff6a17"],
Cell[845064, 21590, 1598, 43, 157, "Input",ExpressionUUID->"b4e29b4f-0412-4dfe-83e0-34e98f96a098"],
Cell[846665, 21635, 149, 3, 30, "Input",ExpressionUUID->"411be4a3-adf2-49e7-9428-a7a94e20d8fc"],
Cell[846817, 21640, 447, 13, 52, "Input",ExpressionUUID->"7d51a2c9-d5fe-41bc-a618-406359832f72"],
Cell[847267, 21655, 6482, 139, 1206, "Input",ExpressionUUID->"40d518d3-4f42-4596-a887-7c7b5714118c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[853786, 21799, 85, 0, 45, "Subsubsection",ExpressionUUID->"f02d28e0-f013-4d3e-bed2-47fbca4889d1"],
Cell[853874, 21801, 2550, 67, 241, "Input",ExpressionUUID->"96aa12a8-87d5-473b-91ff-e2d931b5be77"],
Cell[856427, 21870, 1597, 43, 157, "Input",ExpressionUUID->"603d23bd-7bfe-4c11-b10d-8c30ef07b498"],
Cell[858027, 21915, 146, 3, 30, "Input",ExpressionUUID->"01485372-63bc-4c2d-8018-e9cd2859beab"],
Cell[858176, 21920, 7855, 174, 1248, "Input",ExpressionUUID->"26e08bfc-4bde-4e02-ab0d-e660ad4f7534"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[866080, 22100, 93, 0, 38, "Subsection",ExpressionUUID->"7599dd85-c9a7-4644-8521-4c1e121c10d3"],
Cell[CellGroupData[{
Cell[866198, 22104, 85, 0, 45, "Subsubsection",ExpressionUUID->"eab06cc8-b6b8-48a7-8bf1-c14815d6124d"],
Cell[866286, 22106, 3688, 98, 430, "Input",ExpressionUUID->"21a89685-ea37-4133-b06e-7557b59da770"],
Cell[869977, 22206, 1516, 42, 199, "Input",ExpressionUUID->"898ec17c-37dd-496c-ad57-5f4824400d24"],
Cell[871496, 22250, 8694, 212, 619, "Input",ExpressionUUID->"843a3ab4-2427-4c6e-a36f-2d3295b20ace"]
}, Open  ]],
Cell[CellGroupData[{
Cell[880227, 22467, 88, 0, 45, "Subsubsection",ExpressionUUID->"77479489-57c3-411d-a796-89cc9f3cd780"],
Cell[880318, 22469, 2552, 67, 241, "Input",ExpressionUUID->"78499b30-58a8-4394-9ba3-14544c9f41cf"],
Cell[882873, 22538, 1578, 41, 136, "Input",ExpressionUUID->"60473539-f4ae-485c-82c4-a63c43115042"],
Cell[884454, 22581, 150, 3, 30, "Input",ExpressionUUID->"76a586ff-0b00-4e18-91ad-a49e13a60650"],
Cell[884607, 22586, 4013, 87, 493, "Input",ExpressionUUID->"e922013d-5dfb-4b1a-bb9f-17534118c62f"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[888669, 22679, 104, 0, 38, "Subsection",ExpressionUUID->"7270a18e-9d09-4173-9c94-c7023b4426df"],
Cell[CellGroupData[{
Cell[888798, 22683, 88, 0, 45, "Subsubsection",ExpressionUUID->"a4bad336-c986-4671-8f1a-642b1a0fc66b"],
Cell[888889, 22685, 2552, 67, 241, "Input",ExpressionUUID->"d56a4676-29a3-4169-a87d-7db5ec9e4a99"],
Cell[891444, 22754, 1178, 32, 136, "Input",ExpressionUUID->"ca32bc79-5f84-46f6-b9e6-2f1012c6f94f"],
Cell[892625, 22788, 149, 3, 30, "Input",ExpressionUUID->"38e77e00-166b-4648-8d69-b55862f02b97"],
Cell[892777, 22793, 459, 13, 30, "Input",ExpressionUUID->"ccb72ce7-18c2-4b89-9582-004bddd33454"],
Cell[893239, 22808, 6566, 159, 661, "Input",ExpressionUUID->"7f40b302-12a1-4f2f-825e-f9048367d0a2"],
Cell[899808, 22969, 1178, 32, 136, "Input",ExpressionUUID->"ca100811-a3ae-4851-8b0d-d3368eae3e7b"],
Cell[900989, 23003, 149, 3, 30, "Input",ExpressionUUID->"b2a077ae-e21c-430c-9ced-70b7df07377f"],
Cell[901141, 23008, 459, 13, 30, "Input",ExpressionUUID->"cd3d02dc-55f2-435a-a46c-345c652cd625"],
Cell[901603, 23023, 7927, 193, 717, "Input",ExpressionUUID->"4a602d75-3fa8-4b7e-8dd0-cbba599afc68"],
Cell[909533, 23218, 1178, 32, 136, "Input",ExpressionUUID->"931c1cde-0829-41c0-ac42-28ebe7297eea"],
Cell[910714, 23252, 149, 3, 30, "Input",ExpressionUUID->"2995d156-6fd1-4b2c-b813-442b7bbf7204"],
Cell[910866, 23257, 459, 13, 30, "Input",ExpressionUUID->"ddac8818-fcbf-4b44-91c5-fc12a45442ad"],
Cell[911328, 23272, 8645, 220, 831, "Input",ExpressionUUID->"80ef8233-42a0-489b-9051-37d528ca52b7"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[920022, 23498, 107, 0, 54, "Subsection",ExpressionUUID->"e2b2c825-8ce4-45b4-9314-46fb2223eae8"],
Cell[CellGroupData[{
Cell[920154, 23502, 86, 0, 45, "Subsubsection",ExpressionUUID->"d78dc227-3cda-4ee8-937c-be368b12bd86"],
Cell[920243, 23504, 3612, 89, 304, "Input",ExpressionUUID->"746fd40a-b287-47a9-be75-bc1e7c1a3148"],
Cell[923858, 23595, 148, 3, 30, "Input",ExpressionUUID->"4431c90f-814d-4f3b-9508-ad75ec7efc93"],
Cell[924009, 23600, 5539, 134, 451, "Input",ExpressionUUID->"30c29f21-00c4-41e2-9dbe-21f41f2cf21a"],
Cell[929551, 23736, 4953, 122, 493, "Input",ExpressionUUID->"dda18a96-737c-4a7d-b65b-62f980bb3d85"],
Cell[934507, 23860, 5416, 138, 493, "Input",ExpressionUUID->"9a032e1d-a722-4b8e-9f22-00ea6ec308e1"],
Cell[939926, 24000, 5069, 131, 409, "Input",ExpressionUUID->"eb211263-c78d-49ec-a522-7227477fceb2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[945032, 24136, 85, 0, 45, "Subsubsection",ExpressionUUID->"8b7d6a0a-7929-42c5-8dd7-7723e10e8073"],
Cell[945120, 24138, 2533, 67, 241, "Input",ExpressionUUID->"1ed1c161-c8ba-49b4-9f74-086824791775"],
Cell[947656, 24207, 1035, 28, 136, "Input",ExpressionUUID->"d33f4080-2a72-48b3-8342-aae506e9385e"],
Cell[948694, 24237, 147, 3, 30, "Input",ExpressionUUID->"c8f0ab77-2393-4d98-9c8c-8011c246d788"],
Cell[948844, 24242, 11008, 283, 871, "Input",ExpressionUUID->"cc1528bf-494e-464f-a45f-bdf6f6e448ec"],
Cell[959855, 24527, 13089, 328, 1046, "Input",ExpressionUUID->"e502cfdb-9dee-45f2-a2c5-35515bf9fe5e"],
Cell[972947, 24857, 15658, 390, 1243, "Input",ExpressionUUID->"985713c2-86fc-491f-b0a1-0361a5a20acc"]
}, Open  ]],
Cell[CellGroupData[{
Cell[988642, 25252, 86, 0, 45, "Subsubsection",ExpressionUUID->"7a7d1ff2-2b4e-472e-ae71-25f9c847023f"],
Cell[988731, 25254, 2535, 67, 241, "Input",ExpressionUUID->"0353f5ea-a3dd-47bc-a400-14d328cd24b7"],
Cell[991269, 25323, 1211, 32, 136, "Input",ExpressionUUID->"13a89a9b-58a9-4e61-a44f-5ebf6688177e"],
Cell[992483, 25357, 148, 3, 30, "Input",ExpressionUUID->"b5ab4de3-2b73-43c4-98b8-9e31f0fbdc1f"],
Cell[992634, 25362, 305, 9, 30, "Input",ExpressionUUID->"2f16da8c-9af0-4553-b5fc-d1db29f2a472"],
Cell[992942, 25373, 10179, 257, 916, "Input",ExpressionUUID->"06dd9c49-cb58-4bdc-a838-f6d5efaf5a53"],
Cell[1003124, 25632, 9879, 253, 786, "Input",ExpressionUUID->"c25ce90b-a7af-4b86-ab00-e2559eadff54"],
Cell[1013006, 25887, 16079, 401, 1243, "Input",ExpressionUUID->"f268abdc-d7a5-42e6-a563-88f3ac542153"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1029122, 26293, 88, 0, 45, "Subsubsection",ExpressionUUID->"5a42a692-1e9d-4df9-b132-83ccf250d5f7"],
Cell[1029213, 26295, 2552, 67, 241, "Input",ExpressionUUID->"5bb60ae7-acb9-4b8d-ac2a-660040d6458b"],
Cell[1031768, 26364, 1152, 31, 136, "Input",ExpressionUUID->"736b1544-fa09-4a52-8b03-aac96116e1f9"],
Cell[1032923, 26397, 150, 3, 30, "Input",ExpressionUUID->"3efc3525-9b2d-4fa4-9589-b23a2f95ae1e"],
Cell[1033076, 26402, 475, 14, 59, "Input",ExpressionUUID->"5c52800a-c22b-4688-9fd1-49bba6b88a34"],
Cell[1033554, 26418, 6570, 141, 1206, "Input",ExpressionUUID->"35872045-456c-4f4c-bf31-f5ecb5033a09"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1040161, 26564, 85, 0, 45, "Subsubsection",ExpressionUUID->"251c7d17-d111-4891-8139-e35caff7a1b0"],
Cell[1040249, 26566, 2551, 67, 241, "Input",ExpressionUUID->"9ec8b438-9416-4f84-a2e1-8601c4779509"],
Cell[1042803, 26635, 1151, 31, 136, "Input",ExpressionUUID->"67ae2675-ae2a-4260-9bcc-d0ae7b715ae3"],
Cell[1043957, 26668, 147, 3, 30, "Input",ExpressionUUID->"078b2077-525d-4f99-bfc6-b89f5c6b4c12"],
Cell[1044107, 26673, 7943, 176, 1248, "Input",ExpressionUUID->"97b29667-4af8-42ba-bfa0-aeb77a34fd1a"]
}, Open  ]]
}, Closed]]
}, Closed]]
}
]
*)

