(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    583960,      14622]
NotebookOptionsPosition[    565178,      14361]
NotebookOutlinePosition[    565571,      14377]
CellTagsIndexPosition[    565528,      14374]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Clear", "[", "\"\<`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]}], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"35414358-9cce-404a-b33a-abdb7a6986c5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\<~/Downloads\>\"", ",", "\"\<test\>\"", ",", "\"\<data2\>\""}], 
     "}"}], "]"}]}], ";"}]], "Input",
 CellLabel->"In[3]:=",ExpressionUUID->"98642d0f-5832-45f9-b8ed-04467496a470"],

Cell[CellGroupData[{

Cell["Import", "Section",ExpressionUUID->"534b6d35-6912-417c-b998-6d2218fa41c7"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importField", "[", 
   RowBox[{
    RowBox[{"file", ":", 
     RowBox[{"_String", "?", "FileExistsQ"}]}], ",", 
    RowBox[{"xspan", ":", "_Span", ":", ";;"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", "1"}], "]"}], "]"}]}], ","}], "*)"}], 
     
     RowBox[{
      RowBox[{"group", "=", "\"\</field\>\""}], ",", 
      RowBox[{"names", "=", 
       RowBox[{"{", 
        RowBox[{"\"\<B\>\"", ",", "\"\<E\>\""}], "}"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"attr", ",", "time", ",", "dsets"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"group", ",", 
               RowBox[{"First", "[", "names", "]"}]}], "}"}], "]"}]}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"attr", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dsets", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{"group", ",", "#"}], "}"}], "]"}], "&"}], "/@", 
             "names"}]}], "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Association", "[", 
        RowBox[{"Append", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{
             RowBox[{"StringJoin", "/@", 
              RowBox[{"Tuples", "[", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", "\"\<d\>\"", "}"}], ",", "names", ",", 
                 RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
               "]"}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Part", "[", 
                RowBox[{"#", ",", "xspan"}], "]"}], "&"}], "/@", 
              RowBox[{"Apply", "[", 
               RowBox[{"Join", ",", 
                RowBox[{"Transpose", "/@", "dsets"}]}], "]"}]}]}], "]"}], 
           "]"}], ",", 
          RowBox[{"\"\<time\>\"", "->", "time"}]}], "]"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellLabel->"In[4]:=",ExpressionUUID->"e037445c-cce0-46fb-840d-31d0a79372be"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importMoment", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importMoment", "[", 
   RowBox[{"file_String", "?", "FileExistsQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
    "Print", "[", "\"\<importMoment requires the second argument.\>\"", "]"}],
     ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importMoment", "[", 
   RowBox[{
    RowBox[{"file", ":", 
     RowBox[{"_String", "?", "FileExistsQ"}]}], ",", 
    RowBox[{"spid", ":", 
     RowBox[{"_Integer", "?", "Positive"}]}], ",", 
    RowBox[{"xspan", ":", "_Span", ":", ";;"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}], ",", 
       RowBox[{"xspan", "=", ";;"}], ","}], "*)"}], 
     RowBox[{"group", "=", "\"\</moment\>\""}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "attr", ",", "time", ",", "parent", ",", "n", ",", "nV", ",", "nvv"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "group"}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"attr", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parent", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"group", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"spid", "-", "1"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"attr", "=", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "parent"}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Keys", "[", "attr", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"n", "=", 
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{"parent", ",", "\"\<n\>\""}], "}"}], "]"}]}], "}"}]}],
            "]"}], ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nV", "=", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{"parent", ",", "\"\<nV\>\""}], "}"}], "]"}]}], 
              "}"}]}], "]"}], ",", "xspan"}], "]"}], "//", "Transpose"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"nvv", "=", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{"parent", ",", "\"\<nvv\>\""}], "}"}], "]"}]}], 
              "}"}]}], "]"}], ",", "xspan"}], "]"}], "//", "Transpose"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"attr", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<time\>\"", "->", "time"}], ",", 
             RowBox[{"\"\<n\>\"", "->", "n"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nV\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nV"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nv\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}], ",", 
                  "\"\<v\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nvv"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
          "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->"In[6]:=",ExpressionUUID->"8ff2e987-9b54-4b45-94b6-377ee232408e"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importStressEnergyTensor", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importStressEnergyTensor", "[", 
   RowBox[{"file_String", "?", "FileExistsQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
    "Print", "[", 
     "\"\<importStressEnergyTensor requires the second argument.\>\"", "]"}], 
    ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importStressEnergyTensor", "[", 
   RowBox[{
    RowBox[{"file", ":", 
     RowBox[{"_String", "?", "FileExistsQ"}]}], ",", 
    RowBox[{"spid", ":", 
     RowBox[{"_Integer", "?", "Positive"}]}], ",", 
    RowBox[{"xspan", ":", "_Span", ":", ";;"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}], ",", 
       RowBox[{"xspan", "=", ";;"}], ","}], "*)"}], 
     RowBox[{"group", "=", "\"\</moment\>\""}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "attr", ",", "c", ",", "time", ",", "parent", ",", "n", ",", "nV", ",",
         "Mij", ",", "M00", ",", "Mi0", ",", "nvv"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "group"}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c", "=", 
        RowBox[{"attr", "[", "\"\<c\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"attr", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parent", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"group", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"spid", "-", "1"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"attr", "=", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "parent"}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Keys", "[", "attr", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"n", "=", 
        RowBox[{"Part", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
              RowBox[{"FileNameJoin", "[", 
               RowBox[{"{", 
                RowBox[{"parent", ",", "\"\<n\>\""}], "}"}], "]"}]}], "}"}]}],
            "]"}], ",", "xspan"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nV", "=", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{"parent", ",", "\"\<nV\>\""}], "}"}], "]"}]}], 
              "}"}]}], "]"}], ",", "xspan"}], "]"}], "//", "Transpose"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Mij", "=", 
        RowBox[{
         RowBox[{"Part", "[", 
          RowBox[{
           RowBox[{"Import", "[", 
            RowBox[{"file", ",", 
             RowBox[{"{", 
              RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
               RowBox[{"FileNameJoin", "[", 
                RowBox[{"{", 
                 RowBox[{"parent", ",", "\"\<Mij\>\""}], "}"}], "]"}]}], 
              "}"}]}], "]"}], ",", "xspan"}], "]"}], "//", "Transpose"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"M00", "=", 
        RowBox[{"Mij", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Mi0", "=", 
        RowBox[{"Mij", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", "4"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nvv", "=", 
        RowBox[{"Mij", "[", 
         RowBox[{"[", 
          RowBox[{"5", ";;", "7"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"attr", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<time\>\"", "->", "time"}], ",", 
             RowBox[{"\"\<n\>\"", "->", "n"}], ",", 
             RowBox[{"\"\<n\[Gamma]c2\>\"", "->", "M00"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nV\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nV"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nU\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", 
              RowBox[{"Mi0", "/", "c"}]}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nu\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}], ",", 
                  "\"\<v\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nvv"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
          "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->"In[9]:=",ExpressionUUID->"97f279cc-518f-488e-a547-313b090a443e"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importParticle", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importParticle", "[", 
   RowBox[{"file_String", "?", "FileExistsQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
    "Print", "[", "\"\<importParticle requires the second argument.\>\"", 
     "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importParticle", "[", 
   RowBox[{
    RowBox[{"file", ":", 
     RowBox[{"_String", "?", "FileExistsQ"}]}], ",", 
    RowBox[{"spid", ":", 
     RowBox[{"_Integer", "?", "Positive"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}], ","}], "*)"}], 
     RowBox[{"group", "=", "\"\</particle\>\""}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "attr", ",", "time", ",", "parent", ",", "n", ",", "nV", ",", "nvv", 
        ",", "id", ",", "x", ",", "v", ",", "psd"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "group"}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"attr", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parent", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"group", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"spid", "-", "1"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"attr", "=", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "parent"}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Keys", "[", "attr", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"n", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<n\>\""}], "}"}], "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nV", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<nV\>\""}], "}"}], "]"}]}], "}"}]}],
           "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nvv", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<nvv\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"id", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<id\>\""}], "}"}], "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"x", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<pos\>\""}], "}"}], "]"}]}], "}"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<vel\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"psd", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<psd\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"attr", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<time\>\"", "->", "time"}], ",", 
             RowBox[{"\"\<n\>\"", "->", "n"}], ",", 
             RowBox[{"\"\<id\>\"", "->", "id"}], ",", 
             RowBox[{"\"\<q1\>\"", "->", "x"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nV\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nV"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nv\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}], ",", 
                  "\"\<v\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nvv"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<v\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "v"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<w\>\"", ",", "\"\<f\>\"", ",", "\"\<g\>\""}], 
               "}"}], ",", "psd"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
          "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->"In[12]:=",ExpressionUUID->"6a5f21eb-7e23-4293-a464-e1e44674ab06"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importRelativisticParticle", 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importRelativisticParticle", "[", 
   RowBox[{"file_String", "?", "FileExistsQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
    "Print", "[", 
     "\"\<importRelativisticParticle requires the second argument.\>\"", 
     "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importRelativisticParticle", "[", 
   RowBox[{
    RowBox[{"file", ":", 
     RowBox[{"_String", "?", "FileExistsQ"}]}], ",", 
    RowBox[{"spid", ":", 
     RowBox[{"_Integer", "?", "Positive"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}], ","}], "*)"}], 
     RowBox[{"group", "=", "\"\</particle\>\""}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "attr", ",", "c", ",", "time", ",", "parent", ",", "n", ",", "nV", ",",
         "Mij", ",", "M00", ",", "Mi0", ",", "nvv", ",", "id", ",", "x", ",", 
        "v", ",", "psd"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "group"}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"c", "=", 
        RowBox[{"attr", "[", "\"\<c\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"attr", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parent", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"group", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"spid", "-", "1"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"attr", "=", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "parent"}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Keys", "[", "attr", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"n", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<n\>\""}], "}"}], "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nV", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<nV\>\""}], "}"}], "]"}]}], "}"}]}],
           "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Mij", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<Mij\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"M00", "=", 
        RowBox[{"Mij", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Mi0", "=", 
        RowBox[{"Mij", "[", 
         RowBox[{"[", 
          RowBox[{"2", ";;", "4"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nvv", "=", 
        RowBox[{"Mij", "[", 
         RowBox[{"[", 
          RowBox[{"5", ";;", "7"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"id", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<id\>\""}], "}"}], "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"x", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<pos\>\""}], "}"}], "]"}]}], "}"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<vel\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"psd", "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<psd\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"attr", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<time\>\"", "->", "time"}], ",", 
             RowBox[{"\"\<n\>\"", "->", "n"}], ",", 
             RowBox[{"\"\<id\>\"", "->", "id"}], ",", 
             RowBox[{"\"\<q1\>\"", "->", "x"}], ",", 
             RowBox[{"\"\<n\[Gamma]c2\>\"", "->", "M00"}]}], "}"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nV\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nV"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nU\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", 
              RowBox[{"Mi0", "/", "c"}]}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<nu\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}], ",", 
                  "\"\<v\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "nvv"}], "]"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"StringJoin", "/@", 
               RowBox[{"Thread", "[", 
                RowBox[{"{", 
                 RowBox[{"\"\<v\>\"", ",", 
                  RowBox[{"Characters", "[", "\"\<123\>\"", "]"}]}], "}"}], 
                "]"}]}], ",", "v"}], "]"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Thread", "[", 
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"\"\<w\>\"", ",", "\"\<f\>\"", ",", "\"\<g\>\""}], 
               "}"}], ",", "psd"}], "]"}], "]"}]}], "\[IndentingNewLine]", 
          "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->"In[15]:=",ExpressionUUID->"16469b4e-7f49-48e4-ad7c-57284b692d8a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "calHist", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"calHist", "[", 
   RowBox[{"ptl_Association", ",", "vlim_Interval", ",", 
    RowBox[{"Nv_Integer", "?", "Positive"}]}], "]"}], ":=", 
  RowBox[{"(*", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ptl", "=", "particle"}], ",", 
       RowBox[{"vlim", "=", 
        RowBox[{".4", 
         RowBox[{"Interval", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}]}], ",", 
       RowBox[{"Nv", "=", "150"}]}], "}"}], ","}]}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"v1spec", "=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"MinMax", "[", "vlim", "]"}], ",", 
         RowBox[{"Divide", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"Subtract", "@@", 
             RowBox[{"MinMax", "[", "vlim", "]"}]}]}], ",", "Nv"}], "]"}]}], 
        "]"}]}], ",", 
      RowBox[{"v2spec", "=", 
       RowBox[{"{", 
        RowBox[{"0.", ",", 
         RowBox[{"Max", "[", "vlim", "]"}], ",", 
         RowBox[{"Divide", "[", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"Subtract", "@@", 
             RowBox[{"MinMax", "[", "vlim", "]"}]}]}], ",", "Nv"}], "]"}]}], 
        "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "extent", ",", "interpV1", ",", "interpV2", ",", "interpV3", ",", "q1",
         ",", "v1", ",", "v2", ",", "v3", ",", "w", ",", "binning", ",", 
        "bins", ",", "f", ",", "df", ",", "f1", ",", "df1", ",", "f2", ",", 
        "df2"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"extent", "=", 
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"ptl", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"ptl", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"interpV1", "=", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"extent", ",", 
              RowBox[{"Append", "[", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", "#", "]"}]}], "]"}]}], "}"}], "]"}], 
           "]"}], "]"}], "[", 
         RowBox[{
          RowBox[{"ptl", "[", "\"\<nV1\>\"", "]"}], "/", 
          RowBox[{"ptl", "[", "\"\<n\>\"", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"interpV2", "=", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"extent", ",", 
              RowBox[{"Append", "[", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", "#", "]"}]}], "]"}]}], "}"}], "]"}], 
           "]"}], "]"}], "[", 
         RowBox[{
          RowBox[{"ptl", "[", "\"\<nV2\>\"", "]"}], "/", 
          RowBox[{"ptl", "[", "\"\<n\>\"", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"interpV3", "=", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{"Interpolation", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"extent", ",", 
              RowBox[{"Append", "[", 
               RowBox[{"#", ",", 
                RowBox[{"First", "[", "#", "]"}]}], "]"}]}], "}"}], "]"}], 
           "]"}], "]"}], "[", 
         RowBox[{
          RowBox[{"ptl", "[", "\"\<nV3\>\"", "]"}], "/", 
          RowBox[{"ptl", "[", "\"\<n\>\"", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"w", "=", 
        RowBox[{"ptl", "[", "\"\<w\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"q1", "=", 
        RowBox[{"ptl", "[", "\"\<q1\>\"", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{
         RowBox[{"ptl", "[", "\"\<v1\>\"", "]"}], "-", 
         RowBox[{"interpV1", "[", "q1", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{
         RowBox[{"ptl", "[", "\"\<v2\>\"", "]"}], "-", 
         RowBox[{"interpV2", "[", "q1", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v3", "=", 
        RowBox[{
         RowBox[{"ptl", "[", "\"\<v3\>\"", "]"}], "-", 
         RowBox[{"interpV3", "[", "q1", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{"v2", "^", "2"}], "+", 
          RowBox[{"v3", "^", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v3", "=."}], ";", "\[IndentingNewLine]", 
       RowBox[{"binning", "=", 
        RowBox[{"Compile", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"v1", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"v2", ",", "_Real"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"w", ",", "_Real"}], "}"}]}], "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Module", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"i1", "=", "0"}], ",", 
              RowBox[{"i2", "=", "0"}]}], "}"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"i1", "=", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v1", "-", 
                   RowBox[{"v1spec", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
                 RowBox[{"Last", "[", "v1spec", "]"}]}], "]"}], "+", "1"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"i2", "=", 
              RowBox[{
               RowBox[{"Floor", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v2", "-", 
                   RowBox[{"v2spec", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", 
                 RowBox[{"Last", "[", "v2spec", "]"}]}], "]"}], "+", "1"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i1", ",", "w", ",", "i2"}], "}"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"RuntimeAttributes", "\[Rule]", 
           RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", "]"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"bins", "=", 
        RowBox[{"binning", "[", 
         RowBox[{"v1", ",", "v2", ",", "w"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{"N", "@", 
         RowBox[{"MovingAverage", "[", 
          RowBox[{
           RowBox[{"Range", "@@", "v2spec"}], ",", "2"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{"N", "@", 
         RowBox[{"MovingAverage", "[", 
          RowBox[{
           RowBox[{"Range", "@@", "v1spec"}], ",", "2"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"Cases", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Rule", "[", 
             RowBox[{
              RowBox[{"Round", "[", 
               RowBox[{"Most", "@", 
                RowBox[{"Part", "[", 
                 RowBox[{"#", ",", "1"}], "]"}]}], "]"}], ",", 
              RowBox[{"Through", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Length", ",", "Total"}], "}"}], "[", 
                RowBox[{"Last", "/@", "#"}], "]"}], "]"}]}], "]"}], "&"}], "/@", 
           RowBox[{"SplitBy", "[", 
            RowBox[{
             RowBox[{"SortBy", "[", 
              RowBox[{"(*", 
               RowBox[{"{", 
                RowBox[{"i2", ",", "i1", ",", "w"}], "}"}], "*)"}], 
              RowBox[{
               RowBox[{"RotateRight", "/@", "bins"}], ",", "Most"}], "]"}], 
             ",", "Most"}], "]"}]}], ",", "\[IndentingNewLine]", 
          RowBox[{"HoldPattern", "[", 
           RowBox[{"Rule", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"$2_Integer", "?", "Positive"}], "/;", 
                RowBox[{"$2", "\[LessEqual]", 
                 RowBox[{"Length", "[", "v2", "]"}]}]}], ",", 
               RowBox[{
                RowBox[{"$1_Integer", "?", "Positive"}], "/;", 
                RowBox[{"$1", "\[LessEqual]", 
                 RowBox[{"Length", "[", "v1", "]"}]}]}]}], "}"}], ",", 
             "_List"}], "]"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "=", 
        RowBox[{"ReplacePart", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0"}], "}"}], ",", 
            RowBox[{"{", "v2", "}"}], ",", 
            RowBox[{"{", "v1", "}"}]}], "]"}], ",", "f"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f1", ",", "df1"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Total", "[", "f", "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f2", ",", "df2"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Map", "[", 
          RowBox[{"Total", ",", "f"}], "]"}], "\[Transpose]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"f", ",", "df"}], "}"}], "=", 
        RowBox[{"Flatten", "[", 
         RowBox[{"f", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", "3", "}"}], ",", 
            RowBox[{"{", "1", "}"}], ",", 
            RowBox[{"{", "2", "}"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f1", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"df1", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"f2", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"df2", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"f", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"df", "/=", 
        RowBox[{
         RowBox[{"Length", "[", "w", "]"}], 
         RowBox[{"Last", "[", "v1spec", "]"}], 
         RowBox[{"Last", "[", "v2spec", "]"}], 
         RowBox[{"(", 
          RowBox[{"2", "Pi", " ", "v2"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", "return", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Association", "[", 
        RowBox[{
         RowBox[{"\"\<v1\>\"", "\[Rule]", "v1"}], ",", 
         RowBox[{"\"\<v2\>\"", "\[Rule]", "v2"}], ",", 
         RowBox[{"\"\<f\>\"", "\[Rule]", "f"}], ",", 
         RowBox[{"\"\<df\>\"", "\[Rule]", "df"}], ",", 
         RowBox[{"\"\<f1\>\"", "\[Rule]", "f1"}], ",", 
         RowBox[{"\"\<df1\>\"", "\[Rule]", "df1"}], ",", 
         RowBox[{"\"\<f2\>\"", "\[Rule]", "f2"}], ",", 
         RowBox[{"\"\<df2\>\"", "\[Rule]", "df2"}], ",", 
         RowBox[{"\"\<time\>\"", "\[Rule]", 
          RowBox[{"ptl", "[", "\"\<time\>\"", "]"}]}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]}], "Input",\

 CellLabel->"In[18]:=",ExpressionUUID->"bb891ac4-cda3-48bf-8afe-95f3d84914f7"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "importVHistogram", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importVHistogram", "[", 
   RowBox[{"file_String", "?", "FileExistsQ"}], "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
    "Print", "[", "\"\<importVHistogram requires the second argument.\>\"", 
     "]"}], ";", 
    RowBox[{"Abort", "[", "]"}]}], ")"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"importVHistogram", "[", 
   RowBox[{
    RowBox[{"file", ":", 
     RowBox[{"_String", "?", "FileExistsQ"}]}], ",", 
    RowBox[{"spid", ":", 
     RowBox[{"_Integer", "?", "Positive"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", "1"}], "]"}], "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}], ","}], "*)"}], 
     RowBox[{"group", "=", "\"\</vhist2d\>\""}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "attr", ",", "time", ",", "parent", ",", "idx", ",", "vhist", ",", 
        "whist", ",", "v1", ",", "v2", ",", "dV", ",", "vpsd", ",", "wpsd"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"attr", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "group"}], 
           "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"attr", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"parent", "=", 
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{"group", ",", 
           RowBox[{"ToString", "[", 
            RowBox[{"spid", "-", "1"}], "]"}]}], "}"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"attr", "=", 
        RowBox[{"KeyDrop", "[", 
         RowBox[{
          RowBox[{"Import", "[", 
           RowBox[{"file", ",", 
            RowBox[{"{", 
             RowBox[{
             "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", "parent"}], 
             "}"}]}], "]"}], ",", 
          RowBox[{"Keys", "[", "attr", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"idx", "=", 
        RowBox[{"Import", "[", 
         RowBox[{"file", ",", 
          RowBox[{"{", 
           RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
            RowBox[{"FileNameJoin", "[", 
             RowBox[{"{", 
              RowBox[{"parent", ",", "\"\<idx\>\""}], "}"}], "]"}]}], "}"}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"vhist", ",", "whist"}], "}"}], "=", 
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"file", ",", 
           RowBox[{"{", 
            RowBox[{"\"\<HDF5\>\"", ",", "\"\<Datasets\>\"", ",", 
             RowBox[{"FileNameJoin", "[", 
              RowBox[{"{", 
               RowBox[{"parent", ",", "\"\<psd\>\""}], "}"}], "]"}]}], 
            "}"}]}], "]"}], "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vhist", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"idx", "\[Rule]", "vhist"}], ",", 
           RowBox[{"attr", "[", "\"\<vdims\>\"", "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"whist", "=", 
        RowBox[{"Normal", "@", 
         RowBox[{"SparseArray", "[", 
          RowBox[{
           RowBox[{"idx", "\[Rule]", "whist"}], ",", 
           RowBox[{"attr", "[", "\"\<vdims\>\"", "]"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"v1", "=", 
        RowBox[{
         RowBox[{"Array", "[", 
          RowBox[{"N", ",", 
           RowBox[{
            RowBox[{"attr", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}], "+", "1"}], 
           ",", 
           RowBox[{"attr", "[", "\"\<v1lim\>\"", "]"}]}], "]"}], "~", 
         "MovingAverage", "~", "2"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"v2", "=", 
        RowBox[{
         RowBox[{"Array", "[", 
          RowBox[{"N", ",", 
           RowBox[{
            RowBox[{"attr", "[", 
             RowBox[{"[", 
              RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}], "+", "1"}], 
           ",", 
           RowBox[{"attr", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "~", 
         "MovingAverage", "~", "2"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dV", "=", 
        RowBox[{"2", "\[Pi]", " ", "v2", 
         RowBox[{"(", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"v1", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}], ")"}], 
         RowBox[{"(", 
          RowBox[{"Subtract", "@@", 
           RowBox[{"v2", "[", 
            RowBox[{"[", 
             RowBox[{"{", 
              RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"vpsd", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Divide", "[", 
           RowBox[{"#", ",", "dV"}], "]"}], "&"}], "/@", "vhist"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"wpsd", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Divide", "[", 
           RowBox[{"#", ",", "dV"}], "]"}], "&"}], "/@", "whist"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Merge", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"attr", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"\"\<time\>\"", "->", "time"}], ",", 
             RowBox[{"\"\<v1\>\"", "->", "v1"}], ",", 
             RowBox[{"\"\<v2\>\"", "->", "v2"}], ",", 
             RowBox[{"\"\<vhist\>\"", "->", "vhist"}], ",", 
             RowBox[{"\"\<whist\>\"", "->", "whist"}], ",", 
             RowBox[{"\"\<vpsd\>\"", "->", "vpsd"}], ",", 
             RowBox[{"\"\<wpsd\>\"", "->", "wpsd"}]}], "}"}]}], "}"}], ",", 
         "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellLabel->"In[20]:=",ExpressionUUID->"f289cb05-abbb-45a2-8a0e-01710b4c3770"]
}, Closed]],

Cell[CellGroupData[{

Cell["PIC_1D", "Section",ExpressionUUID->"9b762f27-4219-427f-9e79-ed8f4cdb4c7f"],

Cell[CellGroupData[{

Cell["01_whistler_dispersion", "Subsection",ExpressionUUID->"7a848a5a-aba4-4b48-a057-e00fb269e622"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"c6776fc6-170e-4c85-8be8-fb0455cd75f4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[242]:=",ExpressionUUID->"0a3b8942-02d9-4e97-b7a4-fde7759b5922"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[243]:=",ExpressionUUID->"7cb0b11d-5057-4184-96b5-71e03da3d996"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[244]:=",ExpressionUUID->"b09a43c0-ee69-41ea-9af1-337d08b98870"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[245]:=",ExpressionUUID->"d91caf77-0cde-4350-bdc1-36afcbcbc488"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[246]:=",ExpressionUUID->"61d0a445-f7fd-40bd-a08d-4749f3a3b19a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[247]:=",ExpressionUUID->"55deacc0-898f-4621-8934-8d58830930c0"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"fe45854c-eb52-4c34-804d-e0fa09830067"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[248]:=",ExpressionUUID->"6a0638a8-aaee-4965-be25-1670ff82ffc2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[249]:=",ExpressionUUID->"50a9efda-d764-4a41-82a5-3c129608138d"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[250]:=",ExpressionUUID->"eebd8508-0302-44e4-af48-83820ff9683f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[251]:=",ExpressionUUID->"d92d7554-db5f-46aa-852f-7cf228ebb7c6"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[252]:=",ExpressionUUID->"16b8b2f9-aaad-4475-989d-1bd4692e16ce"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"d23e26ea-413a-4d7d-a17f-d7078d878b09"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[253]:=",ExpressionUUID->"fc6b6562-aa0c-4781-95a6-ed21fe4d8940"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[254]:=",ExpressionUUID->"c264884a-1e5f-4535-8ae2-8d0f087025ef"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[255]:=",ExpressionUUID->"09442f77-de8b-4de7-840e-c972682d3590"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[256]:=",ExpressionUUID->"3f35607c-0b71-4b14-b0f7-42e245994ba0"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[257]:=",ExpressionUUID->"ee0dc67b-1e6b-40e0-bb53-9e34106fa2ef"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[258]:=",ExpressionUUID->"f87b0d0a-1294-4226-874c-71f40e5b80a7"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"f930aad0-3d2f-4c25-be79-99f24e19ae52"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[259]:=",ExpressionUUID->"5e1a0dcd-43e9-42f1-a326-c312f75028d0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[260]:=",ExpressionUUID->"2a16fd78-b5a6-4541-90fb-a4c692ea3424"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[261]:=",ExpressionUUID->"67cbd786-f700-4c50-b56e-b0ae355c4c92"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[262]:=",ExpressionUUID->"4f76be3a-5844-407a-9dee-966685d6f2c1"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[264]:=",ExpressionUUID->"61b094eb-e36e-4616-baa5-ffa29ccc27ef"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"9e31b8e6-9d24-40eb-8f28-e4b857c4fb31"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[265]:=",ExpressionUUID->"9b3ea0d2-447c-4220-bfa7-2aab7846efae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[266]:=",ExpressionUUID->"cd506471-4841-4afd-be44-513875af4e36"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[267]:=",ExpressionUUID->"88615e18-c871-4c47-a251-720bcf61486f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[268]:=",ExpressionUUID->"83075589-4a05-4595-b05d-f1b5d38dc115"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["02_mirror_motion", "Subsection",ExpressionUUID->"12ff51a1-f2a2-4258-a9e0-30b1754a91dd"],

Cell[CellGroupData[{

Cell["Setup", "Subsubsection",ExpressionUUID->"ad406739-b333-4148-b0bf-19f0911d6e7a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileBorisC", "]"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"non", "-", "relativistic"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compileBorisC", "[", 
   RowBox[{
    RowBox[{"B0", ":", 
     RowBox[{"{", "__Real", "}"}]}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "B0", "]"}], "==", "3"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", "=", "1.*^-5"}], "}"}], ",", "\n", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cE", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dB", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dt", ",", "_Real"}], "}"}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v0", ",", "cE", ",", "dB", ",", "dt"}], "}"}], ","}]}], 
       "*)"}], "\n", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[DoubleStruckT]", "=", 
           RowBox[{".5", "dt", " ", 
            RowBox[{"(", 
             RowBox[{"B0", "+", "dB"}], ")"}]}]}], ",", 
          RowBox[{"v", "=", "v0"}], ",", "t", ",", "\[DoubleStruckB]", ",", 
          "v1"}], "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}], ";", "\n", 
         RowBox[{"v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"\[DoubleStruckT]", ".", "\[DoubleStruckT]"}], 
                "]"}]}], ")"}], "<", "\[Epsilon]"}], ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"small", " ", "angle", " ", "expantion"}], "*)"}], "\n", 
            
            RowBox[{
             RowBox[{"Times", "[", 
              RowBox[{"2", ",", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{"v", ",", "\[DoubleStruckT]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"v", ".", "\[DoubleStruckT]"}], " ", 
                 "\[DoubleStruckT]"}], "-", 
                RowBox[{
                 RowBox[{"t", "^", "2"}], "v"}]}]}], "]"}], "+", "v"}], "\n", 
            ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"exact", " ", "solution"}], "*)"}], "\n", 
            RowBox[{
             RowBox[{"\[DoubleStruckB]", "=", 
              RowBox[{"\[DoubleStruckT]", "/", "t"}]}], ";", "\n", 
             RowBox[{"v1", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"v", ".", "\[DoubleStruckB]"}], ")"}], 
               "\[DoubleStruckB]"}]}], ";", "\n", 
             RowBox[{"v1", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v", "-", "v1"}], ")"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"2", "t"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"Cross", "[", 
                  RowBox[{"v", ",", "\[DoubleStruckB]"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"2", "t"}], "]"}]}]}], ")"}]}]}]}], "\n", "]"}]}], 
         ";", "\n", 
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}]}]}], "\n", "]"}]}], "\n", "]"}]}],
    "\n", "]"}]}]}], "Input",
 CellLabel->
  "In[387]:=",ExpressionUUID->"1114d31a-7b88-451c-93cf-353ef1b2240a"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "compileMirrorField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileMirrorField", "[", 
   RowBox[{
    RowBox[{"B0_", "?", "Positive"}], ",", 
    RowBox[{"\[Xi]_", "?", "NonNegative"}]}], "]"}], ":=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"xyz", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", "xyz"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"\[Xi]", "^", "2"}], 
            RowBox[{"x", "^", "2"}]}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "y"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "z"}]}], "}"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"RuntimeAttributes", "\[Rule]", 
     RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->
  "In[389]:=",ExpressionUUID->"7cb87010-c713-486e-b15e-b7878b4e3067"],

Cell[BoxData[
 RowBox[{"figure", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[CapitalOmega]0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Omega]b0", "=", 
       RowBox[{".05", "*", "2", "Pi"}]}], ",", 
      RowBox[{"x0", "=", "0"}], ",", 
      RowBox[{"v0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Alpha]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"60", "Degree"}], "]"}]}], ",", 
      RowBox[{"\[Phi]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CapitalOmega]0", "=", "1"}], ",", 
         RowBox[{"\[Omega]b0", "=", ".05"}], ",", 
         RowBox[{"x0", "=", "0"}], ",", 
         RowBox[{"v0", "=", "1"}], ",", 
         RowBox[{"\[Alpha]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"60", "Degree"}], "]"}]}], ",", 
         RowBox[{"\[Phi]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ","}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Xi]", ",", "mirrorField", ",", "boris", ",", "\[CapitalDelta]t", 
        ",", "nt", ",", "vv", ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Xi]", "=", 
        RowBox[{"\[Omega]b0", "/", "v0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mirrorField", "=", 
        RowBox[{"compileMirrorField", "[", 
         RowBox[{"\[CapitalOmega]0", ",", "\[Xi]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boris", "=", 
        RowBox[{"compileBorisC", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], "//", "N"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]t", "=", 
        RowBox[{"2.", 
         RowBox[{
          RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", "100"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nt", "=", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"2.", 
            RowBox[{
             RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", 
             "\[CapitalDelta]t"}]}], ",", 
           RowBox[{"1", 
            RowBox[{"\[CapitalOmega]0", "/", "\[Omega]b0"}]}]}], "]"}], "//", 
         "Ceiling"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vv", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"Cos", "[", "\[Alpha]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Cos", "[", "\[Phi]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Sin", "[", "\[Phi]0", "]"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", "=", "x0"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "vv"}], "}"}], "=", 
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"xx", "=", 
                  RowBox[{"xx", "-", 
                   RowBox[{"Divide", "[", 
                    RowBox[{
                    RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"mirrorField", "[", "xx", "]"}], "]"}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"xx", "-", 
                 RowBox[{"Divide", "[", 
                  RowBox[{
                   RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                   RowBox[{"\[CapitalOmega]0", 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Xi]", "^", "2"}], 
                    RowBox[{"x", "^", "2"}]}]}], ")"}]}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"boris", "[", 
                 RowBox[{"vv", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"mirrorField", "[", "xx", "]"}], ",", 
                  "\[CapitalDelta]t"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "vv"}], "}"}]}]}], "\[IndentingNewLine]", 
             "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "vv"}], "}"}], ",", "nt"}], "]"}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{"x", ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[403]:=",ExpressionUUID->"cc12956e-a916-45dd-b0b6-3ca21bbe03a6"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"0f2fe521-d50b-4664-bd75-9161ecf7cade"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"wd", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/pic_1d/02_\
mirror_motion\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}], ";"}], 
  "*)"}]], "Input",
 CellLabel->
  "In[363]:=",ExpressionUUID->"0ffc083a-43b9-46ea-a536-8ae170ed07d6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[364]:=",ExpressionUUID->"6e4dccb9-c148-4c83-bfc1-71b49b7c7a17"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particles", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"importParticle", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time\>\"", ",", "\"\<q1\>\"", ",", "\"\<v1\>\"", ",", 
               "\"\<v2\>\"", ",", "\"\<v3\>\""}], "}"}]}], "]"}], "&"}], "/@",
           "files"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", 
              RowBox[{"Merge", "[", 
               RowBox[{"assoc", ",", "Identity"}], "]"}]}], "]"}]}], "}"}], 
          ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[405]:=",ExpressionUUID->"50b21277-8b1a-4283-8497-706b1807f865"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particles"}]], "Input",
 CellLabel->
  "In[406]:=",ExpressionUUID->"3abf6406-9d86-4bb0-952c-855ed67b8069"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"particles", "=", "particles"}], ",", 
     RowBox[{"figure", "=", "figure"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"particles", "[", "\"\<xi\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<q1\>\"", "]"}]}], "]"}], "/", 
        RowBox[{"particles", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v1\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v2\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v3\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"xx", ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[407]:=",ExpressionUUID->"f628baa5-467e-4b60-80b8-8ebbdff606d3"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["03_equilibrium_distribution", "Subsection",ExpressionUUID->"248cf7f7-060d-49b2-a43c-a6f21b548731"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/pic_1d/03_\
equilibrium_distribution\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[410]:=",ExpressionUUID->"698698b4-3e92-495d-8c4b-6c8a53fa232a"],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"59c51e44-867f-41f8-8066-ba8064fc41aa"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[461]:=",ExpressionUUID->"d5761db1-3e45-4022-b3e8-3467bb2f9466"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{"Most", "@", 
          RowBox[{"Array", "[", 
           RowBox[{"N", ",", 
            RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], ",", 
            RowBox[{"attr", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[463]:=",ExpressionUUID->"90c1b668-6319-463f-b2d4-9c305aff5f03"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[464]:=",ExpressionUUID->"820bc3e5-ae74-46bb-a9d9-12f06423fe43"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"T2OT1eq", "=", "2.111"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "mom0", ",", "P1", ",", "P2", ",", "P3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{"T2OT1eq", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "T2OT1eq"}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "\[Eta]s"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"\[Eta]s", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{
                RowBox[{"\[Eta]s", "^", "2"}], " ", "\[Beta]1", " ", 
                RowBox[{"T2OT1eq", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[465]:=",ExpressionUUID->"88b7a3e5-0f6e-4e13-8a67-4e97dc72534c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{"Most", "@", 
          RowBox[{"Array", "[", 
           RowBox[{"N", ",", 
            RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], ",", 
            RowBox[{"attr", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[466]:=",ExpressionUUID->"ed495d52-317f-4333-9c46-918e8314cd61"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[467]:=",ExpressionUUID->"85176739-00db-418c-b80d-f35a2246377c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"\[Theta]2O\[Theta]1eq", "=", 
      SqrtBox["2.111"]}], ",", 
     RowBox[{"\[Beta]eq", "=", ".8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "\[Eta]\[Beta]s", ",", "ns", ",", "mom0", ",", "P1", ",", "P2", ",", 
       "P3"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]\[Beta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Beta]eq", " ", 
           RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Beta]eq", " ", 
              RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]s", "-", 
          RowBox[{"\[Beta]eq", " ", "\[Eta]\[Beta]s"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "-", "\[Beta]eq"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "\[Eta]s", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]s", "/", "\[Eta]s"}]}]}], ")"}]}]}], 
              "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[469]:=",ExpressionUUID->"6aebea96-f446-48e0-a65c-a2c94c842a59"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["REL_PIC_1D", "Section",ExpressionUUID->"163ba665-8fd0-405d-9580-3a36d2aa6564"],

Cell[CellGroupData[{

Cell["01_whistler_dispersion", "Subsection",ExpressionUUID->"0da3b5f0-b6f0-4c4c-8d28-cd56d6451203"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"0d1a11ea-b118-44af-ac1f-533e02602631"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "7"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", "mU2O2", 
         ",", "relKE"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"First", "[", "#", "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{
                RowBox[{"Rest", "[", "#", "]"}], ",", "3"}], "]"}], "]"}], 
             ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{
                RowBox[{"Rest", "[", "#", "]"}], ",", "3"}], "]"}], "]"}]}], 
            "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"relKE", ",", "mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}], ",", 
          RowBox[{"\"\<relKE\>\"", "->", "relKE"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[492]:=",ExpressionUUID->"8807c4e3-ec8d-496b-9639-11286153d68d"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[493]:=",ExpressionUUID->"3aecea53-b05d-49c4-9ec0-e3372b3169fa"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
        "relKE"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"relKE", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<relKE\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{"relKE", ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<(\[Gamma]-1)mc^2\>\""}], 
             ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", "relKE"}], 
               "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[494]:=",ExpressionUUID->"fd926f80-4ec6-41c0-af51-2d89552b2dc3"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[495]:=",ExpressionUUID->"b9d89e3d-c23a-4872-ab1d-d54f05e0260a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[496]:=",ExpressionUUID->"1645c18c-99fb-4bdc-b9b5-1e39bd48ed84"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[497]:=",ExpressionUUID->"9149625c-b2c0-4d94-81b2-316193133685"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"9d9a9dd3-2db6-4688-8aaf-7f6670fe20bf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[498]:=",ExpressionUUID->"7147733f-960f-4fb6-bed6-867e0a542b88"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[499]:=",ExpressionUUID->"338b1c37-8c81-413b-99ad-14c9e76a4ca2"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[500]:=",ExpressionUUID->"69847ad8-f216-425c-a972-e228e75f5c75"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[501]:=",ExpressionUUID->"69300999-d15e-451f-b681-bd1f0845c765"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[502]:=",ExpressionUUID->"22e97311-975a-4a17-ad36-521ef11dd714"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"91571c8e-def2-4c33-85cb-150cadd3b274"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[503]:=",ExpressionUUID->"cf8d80ec-6943-4058-8466-6c887c362b2c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importStressEnergyTensor", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[504]:=",ExpressionUUID->"bfc2b61e-66d8-4145-bd3f-b202fa3bcce8"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[505]:=",ExpressionUUID->"039fc0d3-7707-4cfa-87ac-046b662f0765"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[506]:=",ExpressionUUID->"7861b5a9-720e-4095-9170-0b78abbfe05b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[507]:=",ExpressionUUID->"e463224c-a3e7-4bf7-8b01-b03a3e674d32"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[508]:=",ExpressionUUID->"bd9b575a-38d2-468a-8bf9-00babf562648"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"field", "[", "\"\<n\[Gamma]c2\>\"", "]"}], "/", 
                   RowBox[{
                    RowBox[{"moment", "[", "\"\<c\>\"", "]"}], "^", "2"}]}], 
                  "-", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]\[Gamma]\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[509]:=",ExpressionUUID->"b5778f75-0ad5-4cc6-9ac2-a7a9a42cf765"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nU1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[DoubleVerticalBar]\
\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\(\[UpTee]\)\(\
\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[510]:=",ExpressionUUID->"711d5ef3-7dd2-453a-800d-5a85fc5ec2d9"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"ffe42cc3-6ba8-4ec4-8498-21d8edeae960"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[524]:=",ExpressionUUID->"b8295a59-82b4-4bda-b891-af8ad09fc534"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[525]:=",ExpressionUUID->"bd1d3b2c-1931-4a6f-8aac-9a908d9457d6"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[526]:=",ExpressionUUID->"b45f13e5-b21b-4995-be2a-e1d67885a3d1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",ExpressionUUID->"22228e5a-\
54ce-4d1d-88bc-ac0c99d84e96"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",ExpressionUUID->"bd0111ba-\
1892-4715-88c9-8c008983096f"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"1c183399-e840-48c5-87bf-b3c0af7e4f2d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[521]:=",ExpressionUUID->"d4a5a1e2-853e-49b2-86d1-d212dacf8094"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[522]:=",ExpressionUUID->"928687ae-b547-43b3-8022-d43e9b39efd9"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[523]:=",ExpressionUUID->"0e16ba5b-12e6-47fc-a972-bfa6821bef98"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[520]:=",ExpressionUUID->"263ffaaf-ed62-470d-b8b9-6fe9c380897d"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["02_mirror_motion", "Subsection",ExpressionUUID->"dee97a49-9f34-42fe-a754-eb12502f33ac"],

Cell[CellGroupData[{

Cell["Setup", "Subsubsection",ExpressionUUID->"09e4d96b-96f9-4161-a973-0e4a57e332ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileBorisC", "]"}], "\n", 
  RowBox[{"(*", "relativistic", "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compileBorisC", "[", 
   RowBox[{
    RowBox[{"c_Real", "?", "Positive"}], ",", 
    RowBox[{
     RowBox[{"B0", ":", 
      RowBox[{"{", "__Real", "}"}]}], "/;", 
     RowBox[{
      RowBox[{"Length", "[", "B0", "]"}], "==", "3"}]}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", "=", "1.*^-5"}], "}"}], ",", "\n", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"\[Gamma]v0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cE", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dB", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dt", ",", "_Real"}], "}"}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\[Gamma]v0", ",", "cE", ",", "dB", ",", "dt"}], "}"}], 
         ","}]}], "*)"}], "\n", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[DoubleStruckT]", "=", 
           RowBox[{".5", "dt", " ", 
            RowBox[{"(", 
             RowBox[{"B0", "+", "dB"}], ")"}]}]}], ",", 
          RowBox[{"\[Gamma]v", "=", "\[Gamma]v0"}], ",", "t", ",", 
          "\[DoubleStruckB]", ",", "v1", ",", "v"}], "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"\[Gamma]v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}], ";", "\n", 
         RowBox[{"\[DoubleStruckT]", "/=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"1", "+", 
            RowBox[{"Total", "[", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"\[Gamma]v", "/", "c"}], ")"}], "^", "2"}], "]"}]}], 
           "]"}]}], ";", "\n", 
         RowBox[{"\[Gamma]v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"\[DoubleStruckT]", ".", "\[DoubleStruckT]"}], 
                "]"}]}], ")"}], "<", "\[Epsilon]"}], ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"small", " ", "angle", " ", "expantion"}], "*)"}], "\n", 
            
            RowBox[{
             RowBox[{"Times", "[", 
              RowBox[{"2", ",", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{"\[Gamma]v", ",", "\[DoubleStruckT]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"\[Gamma]v", ".", "\[DoubleStruckT]"}], " ", 
                 "\[DoubleStruckT]"}], "-", 
                RowBox[{
                 RowBox[{"t", "^", "2"}], "\[Gamma]v"}]}]}], "]"}], "+", 
             "\[Gamma]v"}], "\n", ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"exact", " ", "solution"}], "*)"}], "\n", 
            RowBox[{
             RowBox[{"\[DoubleStruckB]", "=", 
              RowBox[{"\[DoubleStruckT]", "/", "t"}]}], ";", "\n", 
             RowBox[{"v1", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"\[Gamma]v", ".", "\[DoubleStruckB]"}], ")"}], 
               "\[DoubleStruckB]"}]}], ";", "\n", 
             RowBox[{"v1", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"\[Gamma]v", "-", "v1"}], ")"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"2", "t"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"Cross", "[", 
                  RowBox[{"\[Gamma]v", ",", "\[DoubleStruckB]"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"2", "t"}], "]"}]}]}], ")"}]}]}]}], "\n", "]"}]}], 
         ";", "\n", 
         RowBox[{"\[Gamma]v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}]}]}], "\n", "]"}]}], "\n", "]"}]}],
    "\n", "]"}]}]}], "Input",
 CellLabel->
  "In[566]:=",ExpressionUUID->"93076d1c-9425-4bcd-bc17-d5c02a48a42d"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "compileMirrorField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileMirrorField", "[", 
   RowBox[{
    RowBox[{"B0_", "?", "Positive"}], ",", 
    RowBox[{"\[Xi]_", "?", "NonNegative"}]}], "]"}], ":=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"xyz", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", "xyz"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"\[Xi]", "^", "2"}], 
            RowBox[{"x", "^", "2"}]}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "y"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "z"}]}], "}"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"RuntimeAttributes", "\[Rule]", 
     RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->
  "In[564]:=",ExpressionUUID->"791b97e8-8417-4daf-987a-f003df120cd8"],

Cell[BoxData[
 RowBox[{"figure", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"c", "=", "4."}], ",", 
      RowBox[{"\[CapitalOmega]0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Omega]b0", "=", 
       RowBox[{".05", "*", "2", "Pi"}]}], ",", 
      RowBox[{"x0", "=", "0"}], ",", 
      RowBox[{"v0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Alpha]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"60", "Degree"}], "]"}]}], ",", 
      RowBox[{"\[Phi]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CapitalOmega]0", "=", "1"}], ",", 
         RowBox[{"\[Omega]b0", "=", ".05"}], ",", 
         RowBox[{"x0", "=", "0"}], ",", 
         RowBox[{"v0", "=", "1"}], ",", 
         RowBox[{"\[Alpha]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"60", "Degree"}], "]"}]}], ",", 
         RowBox[{"\[Phi]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ","}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Xi]", ",", "mirrorField", ",", "boris", ",", "\[CapitalDelta]t", 
        ",", "nt", ",", "\[Gamma]v", ",", "x", ",", "vv"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Xi]", "=", 
        RowBox[{"\[Omega]b0", "/", "v0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mirrorField", "=", 
        RowBox[{"compileMirrorField", "[", 
         RowBox[{"\[CapitalOmega]0", ",", "\[Xi]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boris", "=", 
        RowBox[{"compileBorisC", "[", 
         RowBox[{"c", ",", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], "//", "N"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]t", "=", 
        RowBox[{"2.", 
         RowBox[{
          RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", "100"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nt", "=", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"2.", 
            RowBox[{
             RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", 
             "\[CapitalDelta]t"}]}], ",", 
           RowBox[{"1", 
            RowBox[{"\[CapitalOmega]0", "/", "\[Omega]b0"}]}]}], "]"}], "//", 
         "Ceiling"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Gamma]v", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"Cos", "[", "\[Alpha]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Cos", "[", "\[Phi]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Sin", "[", "\[Phi]0", "]"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", "=", "x0"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "\[Gamma]v"}], "}"}], "=", 
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"\[Gamma]v", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"\[Gamma]v", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", 
                 RowBox[{"\[CapitalDelta]t", "/", 
                  SqrtBox[
                   RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Gamma]v", ".", "\[Gamma]v"}], "/", 
                    RowBox[{"c", "^", "2"}]}]}]]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"xx", "=", 
                  RowBox[{"xx", "-", 
                   RowBox[{"Divide", "[", 
                    RowBox[{
                    RowBox[{"Cross", "[", 
                    RowBox[{"\[Gamma]v", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"mirrorField", "[", "xx", "]"}], "]"}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"xx", "-", 
                 RowBox[{"Divide", "[", 
                  RowBox[{
                   RowBox[{"Cross", "[", 
                    RowBox[{"\[Gamma]v", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                   RowBox[{"\[CapitalOmega]0", 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Xi]", "^", "2"}], 
                    RowBox[{"x", "^", "2"}]}]}], ")"}]}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"\[Gamma]v", "=", 
                RowBox[{"boris", "[", 
                 RowBox[{"\[Gamma]v", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"mirrorField", "[", "xx", "]"}], ",", 
                  "\[CapitalDelta]t"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"\[Gamma]v", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", 
                 RowBox[{"\[CapitalDelta]t", "/", 
                  SqrtBox[
                   RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Gamma]v", ".", "\[Gamma]v"}], "/", 
                    RowBox[{"c", "^", "2"}]}]}]]}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "\[Gamma]v"}], "}"}]}]}], 
             "\[IndentingNewLine]", "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "\[Gamma]v"}], "}"}], ",", "nt"}], "]"}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"vv", "=", 
           RowBox[{
            RowBox[{
             RowBox[{"#", "/", 
              SqrtBox[
               RowBox[{"1", "+", 
                RowBox[{
                 RowBox[{"#", ".", "#"}], "/", 
                 RowBox[{"c", "^", "2"}]}]}]]}], "&"}], "/@", "\[Gamma]v"}]}],
           ";", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"vv", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"\[CapitalDelta]t", 
              RowBox[{"{", 
               RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{"x", ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[570]:=",ExpressionUUID->"e7dee2aa-b573-4f5d-8407-8302133eb552"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"47a45929-8cb2-4784-96e4-3fed653a158f"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"wd", "=", 
    RowBox[{"FileNameJoin", "[", 
     RowBox[{"{", 
      RowBox[{
      "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/pic_1d/02_\
mirror_motion\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}], ";"}], 
  "*)"}]], "Input",
 CellLabel->
  "In[572]:=",ExpressionUUID->"8dc845bf-9ced-4afc-9e04-a52090e0e2e7"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[573]:=",ExpressionUUID->"bdaddcf9-af69-4c36-9938-f161f8f23ee4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particles", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"importRelativisticParticle", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time\>\"", ",", "\"\<q1\>\"", ",", "\"\<v1\>\"", ",", 
               "\"\<v2\>\"", ",", "\"\<v3\>\""}], "}"}]}], "]"}], "&"}], "/@",
           "files"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", 
              RowBox[{"Merge", "[", 
               RowBox[{"assoc", ",", "Identity"}], "]"}]}], "]"}]}], "}"}], 
          ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[574]:=",ExpressionUUID->"6ba9fcdc-0ae5-48ef-aa65-efb13191da8a"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particles"}]], "Input",
 CellLabel->
  "In[575]:=",ExpressionUUID->"3aa96428-bbca-41b4-8f90-772f9d722c6c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"particles", "=", "particles"}], ",", 
     RowBox[{"figure", "=", "figure"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"particles", "[", "\"\<xi\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<q1\>\"", "]"}]}], "]"}], "/", 
        RowBox[{"particles", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v1\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v2\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v3\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"xx", ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[576]:=",ExpressionUUID->"76cd5ce3-c68b-4cc8-968c-014dcd0674e8"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["03_equilibrium_distribution", "Subsection",ExpressionUUID->"0b4cc019-c60e-4c2a-b7a8-841371401aac"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/pic_1d/03_\
equilibrium_distribution\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[577]:=",ExpressionUUID->"8734f6b1-4193-4931-b2f0-192f135967ff"],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"8a6b4402-b769-44bd-a5e4-9e4d3c10b9ee"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[578]:=",ExpressionUUID->"4cb53ca9-4784-406b-a128-6cfc28587dd4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{"Most", "@", 
          RowBox[{"Array", "[", 
           RowBox[{"N", ",", 
            RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], ",", 
            RowBox[{"attr", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[626]:=",ExpressionUUID->"1e15b98e-888d-47a2-89b7-7104a6476ca5"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[627]:=",ExpressionUUID->"70ebb9eb-c69d-4954-8e32-5641f585c7fb"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"T2OT1eq", "=", "2.111"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "c", ",", "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", 
       ",", "mom0", ",", "P1", ",", "P2", ",", "P3", ",", "T1s", ",", "T2s"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"particle", "[", "\"\<c\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{"T2OT1eq", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "T2OT1eq"}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{"particle", "[", "\"\<nU1\>\"", "]"}], 
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "/", "mom0"}]}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{"particle", "[", "\"\<nU2\>\"", "]"}], 
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "/", "mom0"}]}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{"particle", "[", "\"\<nU3\>\"", "]"}], 
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "/", "mom0"}]}]}], 
        ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "\[Eta]", "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"u1", "^", "2"}], "/", 
               SqrtBox[
                RowBox[{"1", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                  RowBox[{"c", "^", "2"}]}]}]]}], ")"}], 
             RowBox[{"Divide", "[", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "-", 
                 RowBox[{
                  RowBox[{"u2", "^", "2"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Beta]1", " ", "T2OT1eq", " ", "\[Eta]"}], 
                   ")"}]}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], "T2OT1eq", " ", 
                "\[Eta]"}]}], "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", "\[Eta]s", "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"T2s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", "\[Eta]", "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{".5", 
               RowBox[{
                RowBox[{"u2", "^", "2"}], "/", 
                SqrtBox[
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                   RowBox[{"c", "^", "2"}]}]}]]}]}], ")"}], 
             RowBox[{"Divide", "[", 
              RowBox[{
               RowBox[{"Exp", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "-", 
                 RowBox[{
                  RowBox[{"u2", "^", "2"}], "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Beta]1", " ", "T2OT1eq", " ", "\[Eta]"}], 
                   ")"}]}]}], "]"}], ",", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], "T2OT1eq", " ", 
                "\[Eta]"}]}], "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", "\[Eta]s", "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "\[Eta]s"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"\[Eta]s", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"\[Eta]s", " ", "T1s"}]}], "}"}], "]"}]}], "}"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{
                  RowBox[{"\[Eta]s", "^", "2"}], " ", "\[Beta]1", " ", 
                  RowBox[{"T2OT1eq", "/", "2"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"\[Eta]s", " ", "T2s"}]}], "}"}], "]"}]}], "}"}], 
            ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[635]:=",ExpressionUUID->"1d0ef20e-c74f-4116-9f6e-d6f785dc620d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{"Most", "@", 
          RowBox[{"Array", "[", 
           RowBox[{"N", ",", 
            RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], ",", 
            RowBox[{"attr", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[640]:=",ExpressionUUID->"c65b7fef-a4af-4cb6-87e8-282ce58ea2ab"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[641]:=",ExpressionUUID->"9c02a2c2-5fb9-49dc-873e-09fcf8d67e18"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"\[Theta]2O\[Theta]1eq", "=", 
      SqrtBox["2.111"]}], ",", 
     RowBox[{"\[Beta]eq", "=", ".8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "c", ",", "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", 
       ",", "\[Eta]\[Beta]s", ",", "ns", ",", "mom0", ",", "P1", ",", "P2", 
       ",", "P3", ",", "T1s", ",", "T2s"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"c", "=", 
       RowBox[{"particle", "[", "\"\<c\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]\[Beta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Beta]eq", " ", 
           RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Beta]eq", " ", 
              RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]s", "-", 
          RowBox[{"\[Beta]eq", " ", "\[Eta]\[Beta]s"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "-", "\[Beta]eq"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nu3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Eta]", ",", "\[Eta]\[Beta]"}], "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"u1", "^", "2"}], "/", 
               SqrtBox[
                RowBox[{"1", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                  RowBox[{"c", "^", "2"}]}]}]]}], ")"}], 
             RowBox[{"Divide", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "]"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]"}], ")"}]}], "]"}], "-", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]\[Beta]", " ", "\[Beta]eq"}], ")"}]}], "]"}]}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], 
                RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", "\[Eta]", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]", "/", "\[Eta]"}]}]}], ")"}]}]}], 
              "\[IndentingNewLine]", "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", 
        RowBox[{"\[Eta]s", ",", "\[Eta]\[Beta]s"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2s", "=", 
       RowBox[{
        RowBox[{"Function", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"\[Eta]", ",", "\[Eta]\[Beta]"}], "}"}], ",", 
          RowBox[{"NIntegrate", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{".5", 
               RowBox[{
                RowBox[{"u2", "^", "2"}], "/", 
                SqrtBox[
                 RowBox[{"1", "+", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"u1", "^", "2"}], "+", 
                    RowBox[{"u2", "^", "2"}]}], ")"}], "/", 
                   RowBox[{"c", "^", "2"}]}]}]]}]}], ")"}], 
             RowBox[{"Divide", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"Exp", "[", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"u1", "^", "2"}]}], "/", 
                  RowBox[{"(", "\[Beta]1", ")"}]}], "]"}], 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]"}], ")"}]}], "]"}], "-", 
                  RowBox[{"Exp", "[", 
                   RowBox[{
                    RowBox[{"-", 
                    RowBox[{"u2", "^", "2"}]}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[Beta]1", " ", 
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", 
                    "\[Eta]\[Beta]", " ", "\[Beta]eq"}], ")"}]}], "]"}]}], 
                 ")"}]}], ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"Pi", "^", "1.5"}], 
                RowBox[{"\[Beta]1", "^", "1.5"}], 
                RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], " ", "\[Eta]", 
                RowBox[{"(", 
                 RowBox[{"1", "-", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]", "/", "\[Eta]"}]}]}], ")"}]}]}], 
              "\[IndentingNewLine]", "]"}], "2", "Pi", " ", "u2"}], ",", 
            RowBox[{"{", 
             RowBox[{"u1", ",", 
              RowBox[{"-", "5"}], ",", "5"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"u2", ",", "0", ",", "8"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", "Listable", "}"}]}], "]"}], "[", 
        RowBox[{"\[Eta]s", ",", "\[Eta]\[Beta]s"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", "T1s"}]}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "\[Eta]s", 
                    " ", 
                    RowBox[{"\[Beta]1", "/", "2"}]}], ")"}], 
                  RowBox[{"(", 
                   RowBox[{"1", "+", 
                    RowBox[{"\[Beta]eq", " ", 
                    RowBox[{"\[Eta]\[Beta]s", "/", "\[Eta]s"}]}]}], ")"}]}]}],
                 "}"}], "]"}], ",", "\[IndentingNewLine]", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", 
                 RowBox[{"ns", " ", "T2s"}]}], "}"}], "]"}]}], 
             "\[IndentingNewLine]", "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{"{", 
                RowBox[{"Gray", ",", "Black"}], "}"}], "]"}], "]"}]}]}], 
           "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[645]:=",ExpressionUUID->"226eafcb-3860-4f1b-85d8-314673996fc8"]
}, Open  ]]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Hybrid_1D", "Section",ExpressionUUID->"9ef99579-bb41-40c5-b013-d697ac8909e0"],

Cell[CellGroupData[{

Cell["01_emic_dispersion", "Subsection",ExpressionUUID->"e1347178-35eb-4a94-a91c-ba6dc557560a"],

Cell[CellGroupData[{

Cell["Energy", "Subsubsection",ExpressionUUID->"381cfa11-8200-4d99-a9aa-a7dc86dd28de"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"stride", "=", "6"}], ",", 
       RowBox[{"movingt", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Mean", "/@", 
            RowBox[{"Partition", "[", 
             RowBox[{
              RowBox[{"Map", "[", 
               RowBox[{"Last", ",", 
                RowBox[{"SplitBy", "[", 
                 RowBox[{
                  RowBox[{"SortBy", "[", 
                   RowBox[{
                    RowBox[{"Import", "[", 
                    RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                    ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}], 
              ",", "movingt"}], "]"}]}], "//", "Transpose"}]}], ",", "step", 
         ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "mU2O2"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "mU2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<mU2O2\>\"", "->", "mU2O2"}]}], "]"}]}]}], 
      "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[50]:=",ExpressionUUID->"3fe88431-1279-4c54-9695-9e823972b42e"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->"In[51]:=",ExpressionUUID->"c2393e1f-1ffc-40da-b0fc-c2f02b55061c"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->"In[52]:=",ExpressionUUID->"b84b5ef3-991c-467a-9196-d465d0550ded"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{
         RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->"In[53]:=",ExpressionUUID->"d5660d51-7188-4f75-a5fb-c33d46180fcd"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"mv2O2", "-", "mU2O2"}], "//", "Chop"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[54]:=",ExpressionUUID->"1c034072-b703-4954-9367-18792528649b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{"pos", ",", 
          RowBox[{
           RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}], "-", 
           RowBox[{"energy", "[", "\"\<mU2O2\>\"", "]"}]}]}], "]"}], "~", 
        "Take", "~", "All"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[55]:=",ExpressionUUID->"e1508f6b-345c-4d05-b906-9702b467099c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsubsection",ExpressionUUID->"13b7c2f1-d652-46ec-b800-4707f9079059"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[56]:=",ExpressionUUID->"7b88ca36-cad5-4c59-9ffe-5bf1d18c9435"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[57]:=",ExpressionUUID->"f051950d-a748-4f9e-8301-fb92033b78bd"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->"In[58]:=",ExpressionUUID->"80043343-ceed-43d7-a203-b7297d3acb4b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[59]:=",ExpressionUUID->"92ac6757-246f-42dd-8e2c-ea33a7a35dcb"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[60]:=",ExpressionUUID->"8d354012-f55b-4173-aaf8-5e60bbac78df"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsubsection",ExpressionUUID->"9d98fa21-0fcb-426d-b646-77bcb2295aa0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[61]:=",ExpressionUUID->"8b0feb06-83c6-41bc-880a-6acf24156d1d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[62]:=",ExpressionUUID->"4495ff96-619a-4f61-ac2b-5b8fa7247acb"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->"In[63]:=",ExpressionUUID->"bc404668-761a-4a4e-ae81-b907de328c24"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->"In[64]:=",ExpressionUUID->"54d4e6df-3241-4f61-942c-1c917a166c84"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[65]:=",ExpressionUUID->"e928620d-5b81-428a-980e-9315ffe6068c"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "15"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"DotDashed", ",", "White", ",", 
               RowBox[{"InfiniteLine", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[66]:=",ExpressionUUID->"ff1a082d-e175-4941-a9a0-364fadbb392e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"becc40bf-9554-4f7b-9000-f72558511078"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[67]:=",ExpressionUUID->"5c673f6c-afba-4a1a-9b56-74150bff6a17"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[68]:=",ExpressionUUID->"b4e29b4f-0412-4dfe-83e0-34e98f96a098"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[69]:=",ExpressionUUID->"411be4a3-adf2-49e7-9428-a7a94e20d8fc"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calHist", "[", 
    RowBox[{"particle", ",", 
     RowBox[{".4", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->"In[70]:=",ExpressionUUID->"7d51a2c9-d5fe-41bc-a618-406359832f72"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[72]:=",ExpressionUUID->"40d518d3-4f42-4596-a887-7c7b5714118c"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsubsection",ExpressionUUID->"f02d28e0-f013-4d3e-bed2-47fbca4889d1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[73]:=",ExpressionUUID->"96aa12a8-87d5-473b-91ff-e2d931b5be77"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[74]:=",ExpressionUUID->"603d23bd-7bfe-4c11-b10d-8c30ef07b498"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->"In[75]:=",ExpressionUUID->"01485372-63bc-4c2d-8018-e9cd2859beab"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[76]:=",ExpressionUUID->"26e08bfc-4bde-4e02-ab0d-e660ad4f7534"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["02_mirror_motion", "Subsection",ExpressionUUID->"7599dd85-c9a7-4644-8521-4c1e121c10d3"],

Cell[CellGroupData[{

Cell["Setup", "Subsubsection",ExpressionUUID->"eab06cc8-b6b8-48a7-8bf1-c14815d6124d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Clear", "[", "compileBorisC", "]"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"non", "-", "relativistic"}], "*)"}]}], "\n", 
 RowBox[{
  RowBox[{"compileBorisC", "[", 
   RowBox[{
    RowBox[{"B0", ":", 
     RowBox[{"{", "__Real", "}"}]}], "/;", 
    RowBox[{
     RowBox[{"Length", "[", "B0", "]"}], "==", "3"}]}], "]"}], ":=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"\[Epsilon]", "=", "1.*^-5"}], "}"}], ",", "\n", 
    RowBox[{"Compile", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"v0", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"cE", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dB", ",", "_Real", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"dt", ",", "_Real"}], "}"}]}], "}"}], ",", "\n", 
      RowBox[{"(*", 
       RowBox[{"Function", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"v0", ",", "cE", ",", "dB", ",", "dt"}], "}"}], ","}]}], 
       "*)"}], "\n", 
      RowBox[{"Module", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"\[DoubleStruckT]", "=", 
           RowBox[{".5", "dt", " ", 
            RowBox[{"(", 
             RowBox[{"B0", "+", "dB"}], ")"}]}]}], ",", 
          RowBox[{"v", "=", "v0"}], ",", "t", ",", "\[DoubleStruckB]", ",", 
          "v1"}], "}"}], ",", "\n", 
        RowBox[{
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}], ";", "\n", 
         RowBox[{"v", "=", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"t", "=", 
               RowBox[{"Sqrt", "[", 
                RowBox[{"\[DoubleStruckT]", ".", "\[DoubleStruckT]"}], 
                "]"}]}], ")"}], "<", "\[Epsilon]"}], ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"small", " ", "angle", " ", "expantion"}], "*)"}], "\n", 
            
            RowBox[{
             RowBox[{"Times", "[", 
              RowBox[{"2", ",", 
               RowBox[{
                RowBox[{"Cross", "[", 
                 RowBox[{"v", ",", "\[DoubleStruckT]"}], "]"}], "+", 
                RowBox[{
                 RowBox[{"v", ".", "\[DoubleStruckT]"}], " ", 
                 "\[DoubleStruckT]"}], "-", 
                RowBox[{
                 RowBox[{"t", "^", "2"}], "v"}]}]}], "]"}], "+", "v"}], "\n", 
            ",", "\n", 
            RowBox[{"(*", 
             RowBox[{"exact", " ", "solution"}], "*)"}], "\n", 
            RowBox[{
             RowBox[{"\[DoubleStruckB]", "=", 
              RowBox[{"\[DoubleStruckT]", "/", "t"}]}], ";", "\n", 
             RowBox[{"v1", "=", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"v", ".", "\[DoubleStruckB]"}], ")"}], 
               "\[DoubleStruckB]"}]}], ";", "\n", 
             RowBox[{"v1", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"v", "-", "v1"}], ")"}], 
                 RowBox[{"Cos", "[", 
                  RowBox[{"2", "t"}], "]"}]}], "+", 
                RowBox[{
                 RowBox[{"Cross", "[", 
                  RowBox[{"v", ",", "\[DoubleStruckB]"}], "]"}], 
                 RowBox[{"Sin", "[", 
                  RowBox[{"2", "t"}], "]"}]}]}], ")"}]}]}]}], "\n", "]"}]}], 
         ";", "\n", 
         RowBox[{"v", "+=", 
          RowBox[{".5", "dt", " ", "cE"}]}]}]}], "\n", "]"}]}], "\n", "]"}]}],
    "\n", "]"}]}]}], "Input",
 CellLabel->"In[77]:=",ExpressionUUID->"21a89685-ea37-4133-b06e-7557b59da770"],

Cell[BoxData[{
 RowBox[{"Clear", "[", "compileMirrorField", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"compileMirrorField", "[", 
   RowBox[{
    RowBox[{"B0_", "?", "Positive"}], ",", 
    RowBox[{"\[Xi]_", "?", "NonNegative"}]}], "]"}], ":=", 
  RowBox[{"Compile", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"{", 
      RowBox[{"xyz", ",", "_Real", ",", "1"}], "}"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x", ",", "y", ",", "z"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "y", ",", "z"}], "}"}], "=", "xyz"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"B0", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "+", 
           RowBox[{
            RowBox[{"\[Xi]", "^", "2"}], 
            RowBox[{"x", "^", "2"}]}]}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "y"}], ",", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Xi]", "^", "2"}]}], "x", " ", "z"}]}], "}"}]}]}]}], 
     "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
    RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"RuntimeAttributes", "\[Rule]", 
     RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
   "]"}]}]}], "Input",
 CellLabel->"In[79]:=",ExpressionUUID->"898ec17c-37dd-496c-ad57-5f4824400d24"],

Cell[BoxData[
 RowBox[{"figure", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\[CapitalOmega]0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Omega]b0", "=", 
       RowBox[{".05", "*", "2", "Pi"}]}], ",", 
      RowBox[{"x0", "=", "0"}], ",", 
      RowBox[{"v0", "=", 
       RowBox[{"2", "Pi"}]}], ",", 
      RowBox[{"\[Alpha]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"60", "Degree"}], "]"}]}], ",", 
      RowBox[{"\[Phi]0", "=", 
       RowBox[{"N", "[", 
        RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\[CapitalOmega]0", "=", "1"}], ",", 
         RowBox[{"\[Omega]b0", "=", ".05"}], ",", 
         RowBox[{"x0", "=", "0"}], ",", 
         RowBox[{"v0", "=", "1"}], ",", 
         RowBox[{"\[Alpha]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"60", "Degree"}], "]"}]}], ",", 
         RowBox[{"\[Phi]0", "=", 
          RowBox[{"N", "[", 
           RowBox[{"0", "Degree"}], "]"}]}]}], "}"}], ","}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "\[Xi]", ",", "mirrorField", ",", "boris", ",", "\[CapitalDelta]t", 
        ",", "nt", ",", "vv", ",", "x"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"\[Xi]", "=", 
        RowBox[{"\[Omega]b0", "/", "v0"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mirrorField", "=", 
        RowBox[{"compileMirrorField", "[", 
         RowBox[{"\[CapitalOmega]0", ",", "\[Xi]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"boris", "=", 
        RowBox[{"compileBorisC", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "0"}], "}"}], "//", "N"}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"\[CapitalDelta]t", "=", 
        RowBox[{"2.", 
         RowBox[{
          RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", "100"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"nt", "=", 
        RowBox[{
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{"2.", 
            RowBox[{
             RowBox[{"Pi", "/", "\[CapitalOmega]0"}], "/", 
             "\[CapitalDelta]t"}]}], ",", 
           RowBox[{"1", 
            RowBox[{"\[CapitalOmega]0", "/", "\[Omega]b0"}]}]}], "]"}], "//", 
         "Ceiling"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"vv", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"v0", " ", 
           RowBox[{"Cos", "[", "\[Alpha]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Cos", "[", "\[Phi]0", "]"}]}], ",", 
          RowBox[{"v0", " ", 
           RowBox[{"Sin", "[", "\[Alpha]0", "]"}], 
           RowBox[{"Sin", "[", "\[Phi]0", "]"}]}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"x", "=", "x0"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"x", ",", "vv"}], "}"}], "=", 
        RowBox[{
         RowBox[{"NestList", "[", 
          RowBox[{
           RowBox[{"Function", "[", 
            RowBox[{"Module", "[", 
             RowBox[{
              RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"x", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"{", 
                 RowBox[{"x", ",", "0", ",", "0"}], "}"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"xx", "=", 
                  RowBox[{"xx", "-", 
                   RowBox[{"Divide", "[", 
                    RowBox[{
                    RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                    RowBox[{"Norm", "[", 
                    RowBox[{"mirrorField", "[", "xx", "]"}], "]"}]}], 
                    "]"}]}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
               RowBox[{"xx", "=", 
                RowBox[{"xx", "-", 
                 RowBox[{"Divide", "[", 
                  RowBox[{
                   RowBox[{"Cross", "[", 
                    RowBox[{"vv", ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", 
                   RowBox[{"\[CapitalOmega]0", 
                    RowBox[{"(", 
                    RowBox[{"1", "+", 
                    RowBox[{
                    RowBox[{"\[Xi]", "^", "2"}], 
                    RowBox[{"x", "^", "2"}]}]}], ")"}]}]}], "]"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"vv", "=", 
                RowBox[{"boris", "[", 
                 RowBox[{"vv", ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"mirrorField", "[", "xx", "]"}], ",", 
                  "\[CapitalDelta]t"}], "]"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"x", "+=", 
                RowBox[{".5", 
                 RowBox[{"vv", "[", 
                  RowBox[{"[", "1", "]"}], "]"}], " ", "\[CapitalDelta]t"}]}],
                ";", "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"x", ",", "vv"}], "}"}]}]}], "\[IndentingNewLine]", 
             "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"x", ",", "vv"}], "}"}], ",", "nt"}], "]"}], 
         "\[Transpose]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"{", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{
           RowBox[{"vv", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ListPlot", "[", 
          RowBox[{"x", ",", 
           RowBox[{"DataRange", "\[Rule]", 
            RowBox[{"\[CapitalDelta]t", 
             RowBox[{"{", 
              RowBox[{"0", ",", "nt"}], "}"}]}]}], ",", 
           RowBox[{"Joined", "\[Rule]", "True"}], ",", 
           RowBox[{"ImageSize", "->", "Medium"}], ",", 
           RowBox[{"PlotStyle", "->", 
            RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}]}], 
        "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->"In[81]:=",ExpressionUUID->"843a3ab4-2427-4c6e-a36f-2d3295b20ace"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"77479489-57c3-411d-a796-89cc9f3cd780"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/hybrid_1d/\
02_mirror_motion\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}], ";"}]], "Input",\

 CellLabel->"In[82]:=",ExpressionUUID->"4e6354d8-3c56-4b58-aeb7-f03ff4afb7ec"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[83]:=",ExpressionUUID->"78499b30-58a8-4394-9ba3-14544c9f41cf"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particles", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"Part", "[", 
            RowBox[{
             RowBox[{"importParticle", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
              "\"\<time\>\"", ",", "\"\<q1\>\"", ",", "\"\<v1\>\"", ",", 
               "\"\<v2\>\"", ",", "\"\<v3\>\""}], "}"}]}], "]"}], "&"}], "/@",
           "files"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<spid\>\"", "->", "spid"}], "}"}], ",", 
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", 
              RowBox[{"Merge", "[", 
               RowBox[{"assoc", ",", "Identity"}], "]"}]}], "]"}]}], "}"}], 
          ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[84]:=",ExpressionUUID->"60473539-f4ae-485c-82c4-a63c43115042"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particles"}]], "Input",
 CellLabel->"In[85]:=",ExpressionUUID->"76a586ff-0b00-4e18-91ad-a49e13a60650"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"particles", "=", "particles"}], ",", 
     RowBox[{"figure", "=", "figure"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "xx", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"xx", "=", 
       RowBox[{
        RowBox[{"Tan", "[", 
         RowBox[{
          RowBox[{"particles", "[", "\"\<xi\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<Dx\>\"", "]"}], 
          RowBox[{"particles", "[", "\"\<q1\>\"", "]"}]}], "]"}], "/", 
        RowBox[{"particles", "[", "\"\<xi\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v1\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v2\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "3", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"particles", "[", "\"\<v3\>\"", "]"}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"figure", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{"xx", ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"MinMax", "[", 
              RowBox[{"particles", "[", "\"\<time\>\"", "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"ImageSize", "->", "Medium"}], ",", 
            RowBox[{"PlotStyle", "->", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}]}], 
         "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[86]:=",ExpressionUUID->"e922013d-5dfb-4b1a-bb9f-17534118c62f"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["03_equilibrium_distribution", "Subsection",ExpressionUUID->"7270a18e-9d09-4173-9c94-c7023b4426df"],

Cell[BoxData[
 RowBox[{
  RowBox[{"wd", "=", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
     "\"\</Users/kyungguk/Documents/git-clones/mirror-pic_1d/tests/hybrid_1d/\
03_equilibrium_distribution\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[87]:=",ExpressionUUID->"309eef2f-35e1-489c-a4e7-408026f8ce78"],

Cell[CellGroupData[{

Cell["Particle", "Subsubsection",ExpressionUUID->"a4bad336-c986-4671-8f1a-642b1a0fc66b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[88]:=",ExpressionUUID->"d56a4676-29a3-4169-a87d-7db5ec9e4a99"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{"Most", "@", 
          RowBox[{"Array", "[", 
           RowBox[{"N", ",", 
            RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], ",", 
            RowBox[{"attr", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[90]:=",ExpressionUUID->"ca32bc79-5f84-46f6-b9e6-2f1012c6f94f"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[91]:=",ExpressionUUID->"38e77e00-166b-4648-8d69-b55862f02b97"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"T2OT1eq", "=", "2.111"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "mom0", ",", "P1", ",", "P2", ",", "P3"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{"T2OT1eq", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", "T2OT1eq"}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "\[Eta]s"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"\[Eta]s", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{
                RowBox[{"\[Eta]s", "^", "2"}], " ", "\[Beta]1", " ", 
                RowBox[{"T2OT1eq", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[92]:=",ExpressionUUID->"7f40b302-12a1-4f2f-825e-f9048367d0a2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "2"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{"Most", "@", 
          RowBox[{"Array", "[", 
           RowBox[{"N", ",", 
            RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], ",", 
            RowBox[{"attr", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}], 
           "]"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->"In[93]:=",ExpressionUUID->"ca100811-a3ae-4851-8b0d-d3368eae3e7b"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->"In[94]:=",ExpressionUUID->"b2a077ae-e21c-430c-9ced-70b7df07377f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\[Beta]1", "=", "1.1"}], ",", 
     RowBox[{"\[Theta]2O\[Theta]1eq", "=", 
      SqrtBox["2.111"]}], ",", 
     RowBox[{"\[Beta]eq", "=", ".8347"}], ",", 
     RowBox[{"particle", "=", "particle"}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "\[Xi]", ",", "\[CapitalDelta]1", ",", "q1s", ",", "\[Eta]s", ",", 
       "\[Eta]\[Beta]s", ",", "ns", ",", "mom0", ",", "P1", ",", "P2", ",", 
       "P3"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"\[Xi]", "=", 
       RowBox[{"particle", "[", "\"\<xi\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"\[CapitalDelta]1", "=", 
       RowBox[{"particle", "[", "\"\<Dx\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"q1s", "=", 
       RowBox[{
        RowBox[{"Array", "[", 
         RowBox[{"N", ",", 
          RowBox[{
           RowBox[{"particle", "[", "\"\<Nx\>\"", "]"}], "+", "1"}], ",", 
          RowBox[{"particle", "[", "\"\<full_grid_domain_extent\>\"", "]"}]}],
          "]"}], "//", "Most"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Eta]\[Beta]s", "=", 
       RowBox[{"Divide", "[", 
        RowBox[{"1", ",", 
         RowBox[{
          RowBox[{"\[Beta]eq", " ", 
           RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}], "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{"1", "-", 
             RowBox[{"\[Beta]eq", " ", 
              RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}]}]}], ")"}], 
           RowBox[{
            RowBox[{"Cos", "[", 
             RowBox[{"\[Xi]", " ", "\[CapitalDelta]1", " ", "q1s"}], "]"}], 
            "^", "2"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"\[Eta]s", "-", 
          RowBox[{"\[Beta]eq", " ", "\[Eta]\[Beta]s"}]}], ")"}], "/", 
        RowBox[{"(", 
         RowBox[{"1", "-", "\[Beta]eq"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mom0", "=", 
       RowBox[{"particle", "[", "\"\<n\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"P1", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv1v1\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV1\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P2", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv2v2\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV2\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"P3", "=", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"particle", "[", "\"\<nv3v3\>\"", "]"}], "-", 
         RowBox[{
          RowBox[{
           RowBox[{"particle", "[", "\"\<nV3\>\"", "]"}], "^", "2"}], "/", 
          "mom0"}]}], ")"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "ns"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "mom0"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", " ", 
                RowBox[{"\[Beta]1", "/", "2"}]}]}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", "P1"}], "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed"}], "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", "]"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"q1s", ",", 
               RowBox[{"ns", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"\[Theta]2O\[Theta]1eq", "^", "2"}], "\[Eta]s", " ", 
                  RowBox[{"\[Beta]1", "/", "2"}]}], ")"}], 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"\[Beta]eq", " ", 
                   RowBox[{"\[Eta]\[Beta]s", "/", "\[Eta]s"}]}]}], ")"}]}]}], 
              "}"}], "]"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P2"}], "}"}], "]"}], ",", 
              RowBox[{"Thread", "[", 
               RowBox[{"{", 
                RowBox[{"q1s", ",", "P3"}], "}"}], "]"}]}], "}"}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Thread", "[", 
              RowBox[{"Directive", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"Red", ",", "Blue"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Dashed", ",", "DotDashed"}], "}"}]}], "]"}], 
              "]"}]}]}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}], ",", "\[IndentingNewLine]", 
          RowBox[{"PlotRange", "->", "All"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->"In[95]:=",ExpressionUUID->"4a602d75-3fa8-4b7e-8dd0-cbba599afc68"]
}, Open  ]]
}, Open  ]]
}, Closed]]
},
WindowSize->{1688, 1073},
WindowMargins->{{Automatic, 1}, {Automatic, 0}},
FrontEndVersion->"12.3 for Mac OS X x86 (64-bit) (June 19, 2021)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"13c7468d-72b3-4754-a7ae-58931f6d390a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 271, 5, 52, "Input",ExpressionUUID->"35414358-9cce-404a-b33a-abdb7a6986c5"],
Cell[832, 27, 300, 8, 30, "Input",ExpressionUUID->"98642d0f-5832-45f9-b8ed-04467496a470"],
Cell[CellGroupData[{
Cell[1157, 39, 80, 0, 67, "Section",ExpressionUUID->"534b6d35-6912-417c-b998-6d2218fa41c7"],
Cell[1240, 41, 2952, 78, 199, "Input",ExpressionUUID->"e037445c-cce0-46fb-840d-31d0a79372be"],
Cell[4195, 121, 5278, 135, 367, "Input",ExpressionUUID->"8ff2e987-9b54-4b45-94b6-377ee232408e"],
Cell[9476, 258, 6481, 165, 472, "Input",ExpressionUUID->"97f279cc-518f-488e-a547-313b090a443e"],
Cell[15960, 425, 7357, 182, 493, "Input",ExpressionUUID->"6a5f21eb-7e23-4293-a464-e1e44674ab06"],
Cell[23320, 609, 8554, 211, 598, "Input",ExpressionUUID->"16469b4e-7f49-48e4-ad7c-57284b692d8a"],
Cell[31877, 822, 12496, 318, 955, "Input",ExpressionUUID->"bb891ac4-cda3-48bf-8afe-95f3d84914f7"],
Cell[44376, 1142, 6313, 164, 430, "Input",ExpressionUUID->"f289cb05-abbb-45a2-8a0e-01710b4c3770"]
}, Closed]],
Cell[CellGroupData[{
Cell[50726, 1311, 80, 0, 53, "Section",ExpressionUUID->"9b762f27-4219-427f-9e79-ed8f4cdb4c7f"],
Cell[CellGroupData[{
Cell[50831, 1315, 99, 0, 54, "Subsection",ExpressionUUID->"7a848a5a-aba4-4b48-a057-e00fb269e622"],
Cell[CellGroupData[{
Cell[50955, 1319, 86, 0, 45, "Subsubsection",ExpressionUUID->"c6776fc6-170e-4c85-8be8-fb0455cd75f4"],
Cell[51044, 1321, 3611, 89, 304, "Input",ExpressionUUID->"0a3b8942-02d9-4e97-b7a4-fde7759b5922"],
Cell[54658, 1412, 147, 3, 30, "Input",ExpressionUUID->"7cb0b11d-5057-4184-96b5-71e03da3d996"],
Cell[54808, 1417, 5538, 134, 451, "Input",ExpressionUUID->"b09a43c0-ee69-41ea-9af1-337d08b98870"],
Cell[60349, 1553, 4952, 122, 493, "Input",ExpressionUUID->"d91caf77-0cde-4350-bdc1-36afcbcbc488"],
Cell[65304, 1677, 5415, 138, 493, "Input",ExpressionUUID->"61d0a445-f7fd-40bd-a08d-4749f3a3b19a"],
Cell[70722, 1817, 5068, 131, 409, "Input",ExpressionUUID->"55deacc0-898f-4621-8934-8d58830930c0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[75827, 1953, 85, 0, 45, "Subsubsection",ExpressionUUID->"fe45854c-eb52-4c34-804d-e0fa09830067"],
Cell[75915, 1955, 2532, 67, 241, "Input",ExpressionUUID->"6a0638a8-aaee-4965-be25-1670ff82ffc2"],
Cell[78450, 2024, 1497, 41, 157, "Input",ExpressionUUID->"50a9efda-d764-4a41-82a5-3c129608138d"],
Cell[79950, 2067, 146, 3, 30, "Input",ExpressionUUID->"eebd8508-0302-44e4-af48-83820ff9683f"],
Cell[80099, 2072, 13568, 339, 1067, "Input",ExpressionUUID->"d92d7554-db5f-46aa-852f-7cf228ebb7c6"],
Cell[93670, 2413, 16137, 401, 1264, "Input",ExpressionUUID->"16b8b2f9-aaad-4475-989d-1bd4692e16ce"]
}, Open  ]],
Cell[CellGroupData[{
Cell[109844, 2819, 86, 0, 45, "Subsubsection",ExpressionUUID->"d23e26ea-413a-4d7d-a17f-d7078d878b09"],
Cell[109933, 2821, 2534, 67, 241, "Input",ExpressionUUID->"fc6b6562-aa0c-4781-95a6-ed21fe4d8940"],
Cell[112470, 2890, 1657, 44, 157, "Input",ExpressionUUID->"c264884a-1e5f-4535-8ae2-8d0f087025ef"],
Cell[114130, 2936, 147, 3, 30, "Input",ExpressionUUID->"09442f77-de8b-4de7-840e-c972682d3590"],
Cell[114280, 2941, 304, 9, 30, "Input",ExpressionUUID->"3f35607c-0b71-4b14-b0f7-42e245994ba0"],
Cell[114587, 2952, 9879, 253, 786, "Input",ExpressionUUID->"ee0dc67b-1e6b-40e0-bb53-9e34106fa2ef"],
Cell[124469, 3207, 16559, 412, 1264, "Input",ExpressionUUID->"f87b0d0a-1294-4226-874c-71f40e5b80a7"]
}, Open  ]],
Cell[CellGroupData[{
Cell[141065, 3624, 88, 0, 45, "Subsubsection",ExpressionUUID->"f930aad0-3d2f-4c25-be79-99f24e19ae52"],
Cell[141156, 3626, 2552, 67, 241, "Input",ExpressionUUID->"5e1a0dcd-43e9-42f1-a326-c312f75028d0"],
Cell[143711, 3695, 1598, 43, 157, "Input",ExpressionUUID->"2a16fd78-b5a6-4541-90fb-a4c692ea3424"],
Cell[145312, 3740, 149, 3, 30, "Input",ExpressionUUID->"67cbd786-f700-4c50-b56e-b0ae355c4c92"],
Cell[145464, 3745, 447, 13, 52, "Input",ExpressionUUID->"4f76be3a-5844-407a-9dee-966685d6f2c1"],
Cell[145914, 3760, 6482, 139, 1206, "Input",ExpressionUUID->"61b094eb-e36e-4616-baa5-ffa29ccc27ef"]
}, Open  ]],
Cell[CellGroupData[{
Cell[152433, 3904, 85, 0, 45, "Subsubsection",ExpressionUUID->"9e31b8e6-9d24-40eb-8f28-e4b857c4fb31"],
Cell[152521, 3906, 2550, 67, 241, "Input",ExpressionUUID->"9b3ea0d2-447c-4220-bfa7-2aab7846efae"],
Cell[155074, 3975, 1597, 43, 157, "Input",ExpressionUUID->"cd506471-4841-4afd-be44-513875af4e36"],
Cell[156674, 4020, 146, 3, 30, "Input",ExpressionUUID->"88615e18-c871-4c47-a251-720bcf61486f"],
Cell[156823, 4025, 7855, 174, 1248, "Input",ExpressionUUID->"83075589-4a05-4595-b05d-f1b5d38dc115"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[164727, 4205, 93, 0, 38, "Subsection",ExpressionUUID->"12ff51a1-f2a2-4258-a9e0-30b1754a91dd"],
Cell[CellGroupData[{
Cell[164845, 4209, 85, 0, 45, "Subsubsection",ExpressionUUID->"ad406739-b333-4148-b0bf-19f0911d6e7a"],
Cell[164933, 4211, 3692, 99, 430, "Input",ExpressionUUID->"1114d31a-7b88-451c-93cf-353ef1b2240a"],
Cell[168628, 4312, 1516, 42, 199, "Input",ExpressionUUID->"7cb87010-c713-486e-b15e-b7878b4e3067"],
Cell[170147, 4356, 8694, 212, 619, "Input",ExpressionUUID->"cc12956e-a916-45dd-b0b6-3ca21bbe03a6"]
}, Open  ]],
Cell[CellGroupData[{
Cell[178878, 4573, 88, 0, 45, "Subsubsection",ExpressionUUID->"0f2fe521-d50b-4664-bd75-9161ecf7cade"],
Cell[178969, 4575, 381, 11, 30, "Input",ExpressionUUID->"0ffc083a-43b9-46ea-a536-8ae170ed07d6"],
Cell[179353, 4588, 2552, 67, 241, "Input",ExpressionUUID->"6e4dccb9-c148-4c83-bfc1-71b49b7c7a17"],
Cell[181908, 4657, 1578, 41, 136, "Input",ExpressionUUID->"50b21277-8b1a-4283-8497-706b1807f865"],
Cell[183489, 4700, 150, 3, 30, "Input",ExpressionUUID->"3abf6406-9d86-4bb0-952c-855ed67b8069"],
Cell[183642, 4705, 4013, 87, 493, "Input",ExpressionUUID->"f628baa5-467e-4b60-80b8-8ebbdff606d3"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[187704, 4798, 104, 0, 38, "Subsection",ExpressionUUID->"248cf7f7-060d-49b2-a43c-a6f21b548731"],
Cell[187811, 4800, 362, 10, 30, "Input",ExpressionUUID->"698698b4-3e92-495d-8c4b-6c8a53fa232a"],
Cell[CellGroupData[{
Cell[188198, 4814, 88, 0, 45, "Subsubsection",ExpressionUUID->"59c51e44-867f-41f8-8066-ba8064fc41aa"],
Cell[188289, 4816, 2552, 67, 241, "Input",ExpressionUUID->"d5761db1-3e45-4022-b3e8-3467bb2f9466"],
Cell[190844, 4885, 1608, 42, 157, "Input",ExpressionUUID->"90c1b668-6319-463f-b2d4-9c305aff5f03"],
Cell[192455, 4929, 149, 3, 30, "Input",ExpressionUUID->"820bc3e5-ae74-46bb-a9d9-12f06423fe43"],
Cell[192607, 4934, 6566, 159, 661, "Input",ExpressionUUID->"88b7a3e5-0f6e-4e13-8a67-4e97dc72534c"],
Cell[199176, 5095, 1608, 42, 157, "Input",ExpressionUUID->"ed495d52-317f-4333-9c46-918e8314cd61"],
Cell[200787, 5139, 149, 3, 30, "Input",ExpressionUUID->"85176739-00db-418c-b80d-f35a2246377c"],
Cell[200939, 5144, 7927, 193, 717, "Input",ExpressionUUID->"6aebea96-f446-48e0-a65c-a2c94c842a59"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[208927, 5344, 84, 0, 53, "Section",ExpressionUUID->"163ba665-8fd0-405d-9580-3a36d2aa6564"],
Cell[CellGroupData[{
Cell[209036, 5348, 99, 0, 54, "Subsection",ExpressionUUID->"0da3b5f0-b6f0-4c4c-8d28-cd56d6451203"],
Cell[CellGroupData[{
Cell[209160, 5352, 86, 0, 45, "Subsubsection",ExpressionUUID->"0d1a11ea-b118-44af-ac1f-533e02602631"],
Cell[209249, 5354, 3867, 95, 304, "Input",ExpressionUUID->"8807c4e3-ec8d-496b-9639-11286153d68d"],
Cell[213119, 5451, 147, 3, 30, "Input",ExpressionUUID->"3aecea53-b05d-49c4-9ec0-e3372b3169fa"],
Cell[213269, 5456, 7429, 179, 514, "Input",ExpressionUUID->"fd926f80-4ec6-41c0-af51-2d89552b2dc3"],
Cell[220701, 5637, 4952, 122, 493, "Input",ExpressionUUID->"b9d89e3d-c23a-4872-ab1d-d54f05e0260a"],
Cell[225656, 5761, 5415, 138, 493, "Input",ExpressionUUID->"1645c18c-99fb-4bdc-b9b5-1e39bd48ed84"],
Cell[231074, 5901, 5068, 131, 409, "Input",ExpressionUUID->"9149625c-b2c0-4d94-81b2-316193133685"]
}, Open  ]],
Cell[CellGroupData[{
Cell[236179, 6037, 85, 0, 45, "Subsubsection",ExpressionUUID->"9d9a9dd3-2db6-4688-8aaf-7f6670fe20bf"],
Cell[236267, 6039, 2532, 67, 241, "Input",ExpressionUUID->"7147733f-960f-4fb6-bed6-867e0a542b88"],
Cell[238802, 6108, 1497, 41, 157, "Input",ExpressionUUID->"338b1c37-8c81-413b-99ad-14c9e76a4ca2"],
Cell[240302, 6151, 146, 3, 30, "Input",ExpressionUUID->"69847ad8-f216-425c-a972-e228e75f5c75"],
Cell[240451, 6156, 13568, 339, 1067, "Input",ExpressionUUID->"69300999-d15e-451f-b681-bd1f0845c765"],
Cell[254022, 6497, 16137, 401, 1264, "Input",ExpressionUUID->"22e97311-975a-4a17-ad36-521ef11dd714"]
}, Open  ]],
Cell[CellGroupData[{
Cell[270196, 6903, 86, 0, 45, "Subsubsection",ExpressionUUID->"91571c8e-def2-4c33-85cb-150cadd3b274"],
Cell[270285, 6905, 2534, 67, 241, "Input",ExpressionUUID->"cf8d80ec-6943-4058-8466-6c887c362b2c"],
Cell[272822, 6974, 1669, 44, 157, "Input",ExpressionUUID->"bfc2b61e-66d8-4145-bd3f-b202fa3bcce8"],
Cell[274494, 7020, 147, 3, 30, "Input",ExpressionUUID->"039fc0d3-7707-4cfa-87ac-046b662f0765"],
Cell[274644, 7025, 304, 9, 30, "Input",ExpressionUUID->"7861b5a9-720e-4095-9170-0b78abbfe05b"],
Cell[274951, 7036, 9879, 253, 786, "Input",ExpressionUUID->"e463224c-a3e7-4bf7-8b01-b03a3e674d32"],
Cell[284833, 7291, 16559, 412, 1264, "Input",ExpressionUUID->"bd9b575a-38d2-468a-8bf9-00babf562648"],
Cell[301395, 7705, 10196, 261, 786, "Input",ExpressionUUID->"b5778f75-0ad5-4cc6-9ac2-a7a9a42cf765"],
Cell[311594, 7968, 16818, 415, 1362, "Input",ExpressionUUID->"711d5ef3-7dd2-453a-800d-5a85fc5ec2d9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[328449, 8388, 88, 0, 45, "Subsubsection",ExpressionUUID->"ffe42cc3-6ba8-4ec4-8498-21d8edeae960"],
Cell[328540, 8390, 2552, 67, 241, "Input",ExpressionUUID->"b8295a59-82b4-4bda-b891-af8ad09fc534"],
Cell[331095, 8459, 1610, 43, 157, "Input",ExpressionUUID->"bd1d3b2c-1931-4a6f-8aac-9a908d9457d6"],
Cell[332708, 8504, 149, 3, 30, "Input",ExpressionUUID->"b45f13e5-b21b-4995-be2a-e1d67885a3d1"],
Cell[332860, 8509, 421, 12, 52, "Input",ExpressionUUID->"22228e5a-54ce-4d1d-88bc-ac0c99d84e96"],
Cell[333284, 8523, 6456, 138, 1206, "Input",ExpressionUUID->"bd0111ba-1892-4715-88c9-8c008983096f"]
}, Open  ]],
Cell[CellGroupData[{
Cell[339777, 8666, 85, 0, 45, "Subsubsection",ExpressionUUID->"1c183399-e840-48c5-87bf-b3c0af7e4f2d"],
Cell[339865, 8668, 2550, 67, 241, "Input",ExpressionUUID->"d4a5a1e2-853e-49b2-86d1-d212dacf8094"],
Cell[342418, 8737, 1597, 43, 157, "Input",ExpressionUUID->"928687ae-b547-43b3-8022-d43e9b39efd9"],
Cell[344018, 8782, 146, 3, 30, "Input",ExpressionUUID->"0e16ba5b-12e6-47fc-a972-bfa6821bef98"],
Cell[344167, 8787, 7855, 174, 1248, "Input",ExpressionUUID->"263ffaaf-ed62-470d-b8b9-6fe9c380897d"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[352071, 8967, 93, 0, 38, "Subsection",ExpressionUUID->"dee97a49-9f34-42fe-a754-eb12502f33ac"],
Cell[CellGroupData[{
Cell[352189, 8971, 85, 0, 45, "Subsubsection",ExpressionUUID->"09e4d96b-96f9-4161-a973-0e4a57e332ae"],
Cell[352277, 8973, 4157, 108, 451, "Input",ExpressionUUID->"93076d1c-9425-4bcd-bc17-d5c02a48a42d"],
Cell[356437, 9083, 1516, 42, 199, "Input",ExpressionUUID->"791b97e8-8417-4daf-987a-f003df120cd8"],
Cell[357956, 9127, 9742, 238, 716, "Input",ExpressionUUID->"e7dee2aa-b573-4f5d-8407-8302133eb552"]
}, Open  ]],
Cell[CellGroupData[{
Cell[367735, 9370, 88, 0, 45, "Subsubsection",ExpressionUUID->"47a45929-8cb2-4784-96e4-3fed653a158f"],
Cell[367826, 9372, 381, 11, 30, "Input",ExpressionUUID->"8dc845bf-9ced-4afc-9e04-a52090e0e2e7"],
Cell[368210, 9385, 2552, 67, 241, "Input",ExpressionUUID->"bdaddcf9-af69-4c36-9938-f161f8f23ee4"],
Cell[370765, 9454, 1590, 41, 136, "Input",ExpressionUUID->"6ba9fcdc-0ae5-48ef-aa65-efb13191da8a"],
Cell[372358, 9497, 150, 3, 30, "Input",ExpressionUUID->"3aa96428-bbca-41b4-8f90-772f9d722c6c"],
Cell[372511, 9502, 4013, 87, 493, "Input",ExpressionUUID->"76cd5ce3-c68b-4cc8-968c-014dcd0674e8"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[376573, 9595, 104, 0, 38, "Subsection",ExpressionUUID->"0b4cc019-c60e-4c2a-b7a8-841371401aac"],
Cell[376680, 9597, 362, 10, 30, "Input",ExpressionUUID->"8734f6b1-4193-4931-b2f0-192f135967ff"],
Cell[CellGroupData[{
Cell[377067, 9611, 88, 0, 45, "Subsubsection",ExpressionUUID->"8a6b4402-b769-44bd-a5e4-9e4d3c10b9ee"],
Cell[377158, 9613, 2552, 67, 241, "Input",ExpressionUUID->"4cb53ca9-4784-406b-a128-6cfc28587dd4"],
Cell[379713, 9682, 1620, 42, 157, "Input",ExpressionUUID->"1e15b98e-888d-47a2-89b7-7104a6476ca5"],
Cell[381336, 9726, 149, 3, 30, "Input",ExpressionUUID->"70ebb9eb-c69d-4954-8e32-5641f585c7fb"],
Cell[381488, 9731, 11005, 272, 766, "Input",ExpressionUUID->"1d0ef20e-c74f-4116-9f6e-d6f785dc620d"],
Cell[392496, 10005, 1620, 42, 157, "Input",ExpressionUUID->"c65b7fef-a4af-4cb6-87e8-282ce58ea2ab"],
Cell[394119, 10049, 149, 3, 30, "Input",ExpressionUUID->"9c02a2c2-5fb9-49dc-873e-09fcf8d67e18"],
Cell[394271, 10054, 14300, 345, 1011, "Input",ExpressionUUID->"226eafcb-3860-4f1b-85d8-314673996fc8"]
}, Open  ]]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[408632, 10406, 83, 0, 53, "Section",ExpressionUUID->"9ef99579-bb41-40c5-b013-d697ac8909e0"],
Cell[CellGroupData[{
Cell[408740, 10410, 95, 0, 54, "Subsection",ExpressionUUID->"e1347178-35eb-4a94-a91c-ba6dc557560a"],
Cell[CellGroupData[{
Cell[408860, 10414, 86, 0, 45, "Subsubsection",ExpressionUUID->"381cfa11-8200-4d99-a9aa-a7dc86dd28de"],
Cell[408949, 10416, 3607, 88, 304, "Input",ExpressionUUID->"3fe88431-1279-4c54-9695-9e823972b42e"],
Cell[412559, 10506, 143, 2, 30, "Input",ExpressionUUID->"c2393e1f-1ffc-40da-b0fc-c2f02b55061c"],
Cell[412705, 10510, 5534, 133, 451, "Input",ExpressionUUID->"b84b5ef3-991c-467a-9196-d465d0550ded"],
Cell[418242, 10645, 4948, 121, 493, "Input",ExpressionUUID->"d5660d51-7188-4f75-a5fb-c33d46180fcd"],
Cell[423193, 10768, 5411, 137, 493, "Input",ExpressionUUID->"1c034072-b703-4954-9367-18792528649b"],
Cell[428607, 10907, 5064, 130, 409, "Input",ExpressionUUID->"e1508f6b-345c-4d05-b906-9702b467099c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[433708, 11042, 85, 0, 45, "Subsubsection",ExpressionUUID->"13b7c2f1-d652-46ec-b800-4707f9079059"],
Cell[433796, 11044, 2528, 66, 241, "Input",ExpressionUUID->"7b88ca36-cad5-4c59-9ffe-5bf1d18c9435"],
Cell[436327, 11112, 1493, 40, 157, "Input",ExpressionUUID->"f051950d-a748-4f9e-8301-fb92033b78bd"],
Cell[437823, 11154, 142, 2, 30, "Input",ExpressionUUID->"80043343-ceed-43d7-a203-b7297d3acb4b"],
Cell[437968, 11158, 13084, 327, 1046, "Input",ExpressionUUID->"92ac6757-246f-42dd-8e2c-ea33a7a35dcb"],
Cell[451055, 11487, 15653, 389, 1243, "Input",ExpressionUUID->"8d354012-f55b-4173-aaf8-5e60bbac78df"]
}, Open  ]],
Cell[CellGroupData[{
Cell[466745, 11881, 86, 0, 45, "Subsubsection",ExpressionUUID->"9d98fa21-0fcb-426d-b646-77bcb2295aa0"],
Cell[466834, 11883, 2530, 66, 241, "Input",ExpressionUUID->"8b0feb06-83c6-41bc-880a-6acf24156d1d"],
Cell[469367, 11951, 1653, 43, 157, "Input",ExpressionUUID->"4495ff96-619a-4f61-ac2b-5b8fa7247acb"],
Cell[471023, 11996, 143, 2, 30, "Input",ExpressionUUID->"bc404668-761a-4a4e-ae81-b907de328c24"],
Cell[471169, 12000, 300, 8, 30, "Input",ExpressionUUID->"54d4e6df-3241-4f61-942c-1c917a166c84"],
Cell[471472, 12010, 9875, 252, 786, "Input",ExpressionUUID->"e928620d-5b81-428a-980e-9315ffe6068c"],
Cell[481350, 12264, 16075, 400, 1243, "Input",ExpressionUUID->"ff1a082d-e175-4941-a9a0-364fadbb392e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[497462, 12669, 88, 0, 45, "Subsubsection",ExpressionUUID->"becc40bf-9554-4f7b-9000-f72558511078"],
Cell[497553, 12671, 2548, 66, 241, "Input",ExpressionUUID->"5c673f6c-afba-4a1a-9b56-74150bff6a17"],
Cell[500104, 12739, 1594, 42, 157, "Input",ExpressionUUID->"b4e29b4f-0412-4dfe-83e0-34e98f96a098"],
Cell[501701, 12783, 145, 2, 30, "Input",ExpressionUUID->"411be4a3-adf2-49e7-9428-a7a94e20d8fc"],
Cell[501849, 12787, 443, 12, 52, "Input",ExpressionUUID->"7d51a2c9-d5fe-41bc-a618-406359832f72"],
Cell[502295, 12801, 6478, 138, 1129, "Input",ExpressionUUID->"40d518d3-4f42-4596-a887-7c7b5714118c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[508810, 12944, 85, 0, 45, "Subsubsection",ExpressionUUID->"f02d28e0-f013-4d3e-bed2-47fbca4889d1"],
Cell[508898, 12946, 2546, 66, 231, "Input",ExpressionUUID->"96aa12a8-87d5-473b-91ff-e2d931b5be77"],
Cell[511447, 13014, 1593, 42, 151, "Input",ExpressionUUID->"603d23bd-7bfe-4c11-b10d-8c30ef07b498"],
Cell[513043, 13058, 142, 2, 31, "Input",ExpressionUUID->"01485372-63bc-4c2d-8018-e9cd2859beab"],
Cell[513188, 13062, 7851, 173, 1169, "Input",ExpressionUUID->"26e08bfc-4bde-4e02-ab0d-e660ad4f7534"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[521088, 13241, 93, 0, 38, "Subsection",ExpressionUUID->"7599dd85-c9a7-4644-8521-4c1e121c10d3"],
Cell[CellGroupData[{
Cell[521206, 13245, 85, 0, 45, "Subsubsection",ExpressionUUID->"eab06cc8-b6b8-48a7-8bf1-c14815d6124d"],
Cell[521294, 13247, 3688, 98, 430, "Input",ExpressionUUID->"21a89685-ea37-4133-b06e-7557b59da770"],
Cell[524985, 13347, 1512, 41, 199, "Input",ExpressionUUID->"898ec17c-37dd-496c-ad57-5f4824400d24"],
Cell[526500, 13390, 8690, 211, 619, "Input",ExpressionUUID->"843a3ab4-2427-4c6e-a36f-2d3295b20ace"]
}, Open  ]],
Cell[CellGroupData[{
Cell[535227, 13606, 88, 0, 45, "Subsubsection",ExpressionUUID->"77479489-57c3-411d-a796-89cc9f3cd780"],
Cell[535318, 13608, 349, 9, 30, "Input",ExpressionUUID->"4e6354d8-3c56-4b58-aeb7-f03ff4afb7ec"],
Cell[535670, 13619, 2548, 66, 241, "Input",ExpressionUUID->"78499b30-58a8-4394-9ba3-14544c9f41cf"],
Cell[538221, 13687, 1574, 40, 136, "Input",ExpressionUUID->"60473539-f4ae-485c-82c4-a63c43115042"],
Cell[539798, 13729, 146, 2, 30, "Input",ExpressionUUID->"76a586ff-0b00-4e18-91ad-a49e13a60650"],
Cell[539947, 13733, 4009, 86, 493, "Input",ExpressionUUID->"e922013d-5dfb-4b1a-bb9f-17534118c62f"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[544005, 13825, 104, 0, 38, "Subsection",ExpressionUUID->"7270a18e-9d09-4173-9c94-c7023b4426df"],
Cell[544112, 13827, 361, 9, 30, "Input",ExpressionUUID->"309eef2f-35e1-489c-a4e7-408026f8ce78"],
Cell[CellGroupData[{
Cell[544498, 13840, 88, 0, 45, "Subsubsection",ExpressionUUID->"a4bad336-c986-4671-8f1a-642b1a0fc66b"],
Cell[544589, 13842, 2548, 66, 241, "Input",ExpressionUUID->"d56a4676-29a3-4169-a87d-7db5ec9e4a99"],
Cell[547140, 13910, 1604, 41, 157, "Input",ExpressionUUID->"ca32bc79-5f84-46f6-b9e6-2f1012c6f94f"],
Cell[548747, 13953, 145, 2, 30, "Input",ExpressionUUID->"38e77e00-166b-4648-8d69-b55862f02b97"],
Cell[548895, 13957, 6562, 158, 661, "Input",ExpressionUUID->"7f40b302-12a1-4f2f-825e-f9048367d0a2"],
Cell[555460, 14117, 1604, 41, 157, "Input",ExpressionUUID->"ca100811-a3ae-4851-8b0d-d3368eae3e7b"],
Cell[557067, 14160, 145, 2, 30, "Input",ExpressionUUID->"b2a077ae-e21c-430c-9ced-70b7df07377f"],
Cell[557215, 14164, 7923, 192, 717, "Input",ExpressionUUID->"4a602d75-3fa8-4b7e-8dd0-cbba599afc68"]
}, Open  ]]
}, Open  ]]
}, Closed]]
}
]
*)

