(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    288219,       7179]
NotebookOptionsPosition[    280792,       7073]
NotebookOutlinePosition[    281191,       7089]
CellTagsIndexPosition[    281148,       7086]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{"Clear", "[", "\"\<`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"SetDirectory", "[", 
   RowBox[{"NotebookDirectory", "[", "]"}], "]"}], ";"}]}], "Input",
 CellLabel->
  "In[473]:=",ExpressionUUID->"35414358-9cce-404a-b33a-abdb7a6986c5"],

Cell[BoxData[
 RowBox[{"Get", "[", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<../..\>\"", ",", "\"\<imports.wl\>\""}], "}"}], "]"}], 
  "]"}]], "Input",
 CellLabel->
  "In[475]:=",ExpressionUUID->"98642d0f-5832-45f9-b8ed-04467496a470"],

Cell[BoxData[
 RowBox[{"wd", "=", 
  RowBox[{"FileNameJoin", "[", 
   RowBox[{"{", 
    RowBox[{"\"\<.\>\"", ",", "\"\<data\>\""}], "}"}], "]"}]}]], "Input",
 CellLabel->
  "In[476]:=",ExpressionUUID->"7640abcc-40a3-4b02-a665-ad3c9af5d4f1"],

Cell[CellGroupData[{

Cell["Non-relativistic", "Section",ExpressionUUID->"bd9e0fb1-f60e-440c-ae11-8afbfd84c89a"],

Cell[CellGroupData[{

Cell["Energy", "Subsection",ExpressionUUID->"9328d8c3-7478-4f1e-9afb-f4bf737dba27"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"stride", "=", "6"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "step", ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "m\[Theta]2O2", ",", "\[IndentingNewLine]", 
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Chop", "@", 
            RowBox[{"Map", "[", 
             RowBox[{"Last", ",", 
              RowBox[{"SplitBy", "[", 
               RowBox[{
                RowBox[{"SortBy", "[", 
                 RowBox[{
                  RowBox[{"Import", "[", 
                   RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                  ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}]}], "//",
            "Transpose"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "3"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "m\[Theta]2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<m\[Theta]2O2\>\"", "->", "m\[Theta]2O2"}]}], "]"}]}]}],
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[183]:=",ExpressionUUID->"da1286ec-9f7b-491b-a8bd-6f40f49e4617"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[184]:=",ExpressionUUID->"4a4d5bc8-df05-4bee-9876-65faf35a30f2"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"mv2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"Plus", "@@@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[185]:=",ExpressionUUID->"b463ea84-bb2b-4087-a343-40324ab51aba"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<m\[Theta]2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"mv2O2", "-", "m\[Theta]2O2"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{"#", "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[186]:=",ExpressionUUID->"a7040f13-bde1-4f17-84d9-7827296b064f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<m\[Theta]2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"mv2O2", "-", "m\[Theta]2O2"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"#", "-", 
                RowBox[{"#", "[", 
                 RowBox[{"[", 
                  RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[187]:=",ExpressionUUID->"9344cfc9-726a-4cc3-88d7-d0c192809383"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"pos", ",", 
         RowBox[{"energy", "[", "\"\<m\[Theta]2O2\>\"", "]"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Rest", "[", "#", "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[188]:=",ExpressionUUID->"be113b05-7cc3-4156-8f16-2519b53baf8e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsection",ExpressionUUID->"fd9a5f6e-0e35-4373-b5d5-25cd03f7d29c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[189]:=",ExpressionUUID->"ae214f32-ca01-4b97-b2b5-745ae699f687"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[190]:=",ExpressionUUID->"33d2fe09-8078-4246-91a7-81e88b6912ba"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[191]:=",ExpressionUUID->"a60b0f38-675f-4b5f-a9ea-10ea525c8aac"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"ListContourPlot", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[Omega]e", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[CapitalOmega]e", "=", "1"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"k", ",", "_Real"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\[Omega]", ",", "_Real"}], "}"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"k", ",", "\[Omega]", ",", 
                RowBox[{
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[CapitalOmega]e", "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}], 
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "\[CapitalOmega]e"}], "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}]}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"RuntimeAttributes", "\[Rule]", 
               RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
             "]"}]}], "\[IndentingNewLine]", "]"}], "@@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Tuples", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", "\[Omega]t"}], "}"}], "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{
            RowBox[{"Opacity", "[", "1", "]"}], ",", "White", ",", "Dashed", 
            ",", 
            RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Contours", "\[Rule]", 
          RowBox[{"{", "0", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{
          "#", ",", "\[IndentingNewLine]", "plots", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[192]:=",ExpressionUUID->"8695e2ae-2018-47d6-9b39-4b21c64db11e"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"ListContourPlot", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[Omega]e", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[CapitalOmega]e", "=", "1"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"k", ",", "_Real"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\[Omega]", ",", "_Real"}], "}"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"k", ",", "\[Omega]", ",", 
                RowBox[{
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[CapitalOmega]e", "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}], 
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "\[CapitalOmega]e"}], "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}]}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"RuntimeAttributes", "\[Rule]", 
               RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
             "]"}]}], "\[IndentingNewLine]", "]"}], "@@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Tuples", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", "\[Omega]t"}], "}"}], "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{
            RowBox[{"Opacity", "[", "1", "]"}], ",", "White", ",", "Dashed", 
            ",", 
            RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Contours", "\[Rule]", 
          RowBox[{"{", "0", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{
          "#", ",", "\[IndentingNewLine]", "plots", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[193]:=",ExpressionUUID->"0959faeb-2e1d-4407-9152-06ae1cece027"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsection",ExpressionUUID->"4f30b4b7-cb77-487a-bb75-6368f93240c0"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[194]:=",ExpressionUUID->"1e886e48-bed1-46ec-b0e8-f2f660cd1483"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[195]:=",ExpressionUUID->"7ae9cbf8-eafa-4a4c-8430-8df65d45cce1"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[196]:=",ExpressionUUID->"ac8acd25-61b5-406b-ab7a-4fe3c6db448f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[197]:=",ExpressionUUID->"89136b45-8d01-4d01-83cc-c39b176723d6"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",ExpressionUUID->"76f671ce-1399-4c93-\
a171-de4e0bc69396"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[199]:=",ExpressionUUID->"d2c67ddc-74c2-4aba-afe5-799468bb6108"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsection",ExpressionUUID->"c62a2b35-b85e-461b-a3cd-0bca6d485abb"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<vhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</vhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[201]:=",ExpressionUUID->"eb47d246-5c37-4620-abb5-43974ec28eed"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[202]:=",ExpressionUUID->"adc197a7-fecd-4e0e-8e35-8b304f12c1f0"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[203]:=",ExpressionUUID->"a1064c17-854d-4b30-b856-eac97f80127f"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<vdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<v2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<vdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<fpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<fpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[204]:=",ExpressionUUID->"e2a14dd3-bdb6-489b-bcb3-2f016cc53cef"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsection",ExpressionUUID->"c6414af0-f2aa-48eb-a4d5-07defec83b5e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[205]:=",ExpressionUUID->"566300fc-abb6-4a73-9f21-67e72a12c626"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[206]:=",ExpressionUUID->"f3472e2a-0268-4bb8-82ff-37827c5d7cbf"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[207]:=",ExpressionUUID->"d2f972fb-8132-4b79-8719-2bd2dc0fbd4c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calVelocityHistogram", "[", 
    RowBox[{"particle", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{".4", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{".4", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}], "]"}]}], ",", 
       RowBox[{"150", "/", "2"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[208]:=",ExpressionUUID->"e3c8210a-f163-48f6-ac28-02b2f0f712bb"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[210]:=",ExpressionUUID->"cfcbf234-37ed-445a-81c4-0c90c90f4929"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Relativistic", "Section",ExpressionUUID->"fc84090a-4548-4414-861e-25b4429b11c4"],

Cell[CellGroupData[{

Cell["Energy", "Subsection",ExpressionUUID->"92e034cd-5112-4739-b1c7-fcf2c92f83f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"energy", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"stride", "=", "8"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "step", ",", "time", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2", ",", 
         "m\[Theta]2O2", ",", "\[IndentingNewLine]", 
         RowBox[{"data", "=", 
          RowBox[{
           RowBox[{"Chop", "@", 
            RowBox[{"Map", "[", 
             RowBox[{"Last", ",", 
              RowBox[{"SplitBy", "[", 
               RowBox[{
                RowBox[{"SortBy", "[", 
                 RowBox[{
                  RowBox[{"Import", "[", 
                   RowBox[{
                    RowBox[{"FileNameJoin", "[", 
                    RowBox[{"{", 
                    RowBox[{"wd", ",", "\"\<energy.csv\>\""}], "}"}], "]"}], 
                    ",", "\"\<CSV\>\"", ",", 
                    RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", "1"}]}], "]"}], 
                  ",", "First"}], "]"}], ",", "First"}], "]"}]}], "]"}]}], "//",
            "Transpose"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"step", ",", "time"}], "}"}], "=", 
         RowBox[{"Take", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dB2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"dE2O2", "=", 
         RowBox[{"Thread", "[", 
          RowBox[{"Take", "[", 
           RowBox[{"data", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{"Drop", "[", 
          RowBox[{"data", ",", "3"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"data", "=", 
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Thread", "[", 
              RowBox[{"Take", "[", 
               RowBox[{"#", ",", "4"}], "]"}], "]"}], ",", 
             RowBox[{"Thread", "[", 
              RowBox[{"Drop", "[", 
               RowBox[{"#", ",", "4"}], "]"}], "]"}]}], "}"}], "&"}], "/@", 
          RowBox[{"Partition", "[", 
           RowBox[{"data", ",", "stride"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"mv2O2", ",", "m\[Theta]2O2"}], "}"}], "=", 
         RowBox[{"data", "//", "Transpose"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Association", "[", 
         RowBox[{
          RowBox[{"\"\<step\>\"", "\[Rule]", "step"}], ",", 
          RowBox[{"\"\<time\>\"", "\[Rule]", "time"}], ",", 
          RowBox[{"\"\<dB2O2\>\"", "->", "dB2O2"}], ",", 
          RowBox[{"\"\<dE2O2\>\"", "->", "dE2O2"}], ",", 
          RowBox[{"\"\<mv2O2\>\"", "->", "mv2O2"}], ",", 
          RowBox[{"\"\<m\[Theta]2O2\>\"", "->", "m\[Theta]2O2"}]}], "]"}]}]}],
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellLabel->
  "In[477]:=",ExpressionUUID->"a6b4b1f3-a8d9-4acf-bd1f-a174eb32a547"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "energy"}]], "Input",
 CellLabel->
  "In[478]:=",ExpressionUUID->"ddeb07b4-9a5c-42b5-b450-76d0ee1eaf21"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"time", ",", "pos", ",", "dB2O2", ",", "dE2O2", ",", "mv2O2"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dB2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dB2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"dE2O2", "=", 
        RowBox[{
         RowBox[{"energy", "[", "\"\<dE2O2\>\"", "]"}], "//", "pos"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{
         RowBox[{"pos", "/@", 
          RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}], "//", "Total"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"AspectRatio", "\[Rule]", 
             RowBox[{"1", "/", "3"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], "/@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dB2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dB^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{"dE2O2", "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<dE^2/2\>\""}]}], "]"}], 
           ",", "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Rest", "/@", "mv2O2"}], "//", "Transpose"}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<mv^2/2\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ListPlot", "[", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"{", 
                RowBox[{"#", ",", 
                 RowBox[{"#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}], ",", 
                 RowBox[{"#", "+", "#2", "-", 
                  RowBox[{"First", "[", "#2", "]"}]}]}], "}"}], "&"}], "@@", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Plus", "@@@", 
                 RowBox[{"(", 
                  RowBox[{"dB2O2", "+", "dE2O2"}], ")"}]}], ",", 
                RowBox[{"First", "/@", "mv2O2"}]}], "}"}]}], ",", 
             RowBox[{"DataRange", "\[Rule]", 
              RowBox[{"time", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
             RowBox[{"Joined", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", "\"\<Total\>\""}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellLabel->
  "In[479]:=",ExpressionUUID->"1f00daeb-249f-409c-850d-3fb5cbfd3898"],

Cell[BoxData[
 RowBox[{"dynamic", "=", 
  RowBox[{"With", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
      RowBox[{"energy", "=", "energy"}], ",", 
      RowBox[{"tlim", "=", 
       RowBox[{"Interval", "[", 
        RowBox[{"{", 
         RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
        ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"time", "=", 
        RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"Position", "[", 
         RowBox[{"time", ",", 
          RowBox[{"$_Real", "/;", 
           RowBox[{"IntervalMemberQ", "[", 
            RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pos", "=", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
            RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
          RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"time", "=", 
        RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"mv2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"m\[Theta]2O2", "=", 
        RowBox[{"pos", "/@", 
         RowBox[{"energy", "[", "\"\<m\[Theta]2O2\>\"", "]"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"mU2O2", "=", 
        RowBox[{"mv2O2", "-", "m\[Theta]2O2"}]}], ";", "\[IndentingNewLine]", 
       
       RowBox[{"plots", "=", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Show", "[", 
            RowBox[{"#", ",", "\[IndentingNewLine]", 
             RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
            "]"}], "&"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Rest", "/@", "#"}], "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mv2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Rest", "/@", "#"}], "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "m\[Theta]2O2"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"ListPlot", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Rest", "/@", "#"}], "//", "Transpose"}], ",", 
                RowBox[{"DataRange", "\[Rule]", 
                 RowBox[{"time", "[", 
                  RowBox[{"[", 
                   RowBox[{"{", 
                    RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
                RowBox[{"Joined", "\[Rule]", "True"}], ",", 
                RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@",
              "mU2O2"}]}], "\[IndentingNewLine]", "}"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"plots", "//", "Transpose"}], ",", 
          RowBox[{"Text", "/@", 
           RowBox[{"{", 
            RowBox[{
            "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
            "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], "\[IndentingNewLine]", "]"}]}]], "Input",
 CellLabel->
  "In[480]:=",ExpressionUUID->"3d3a1964-183a-4f5a-ac33-ce0c54fb3db6"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "time", ",", "pos", ",", "mv2O2", ",", "mU2O2", ",", "m\[Theta]2O2", 
       ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"mv2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<mv2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"pos", "/@", 
        RowBox[{"energy", "[", "\"\<m\[Theta]2O2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"mU2O2", "=", 
       RowBox[{"mv2O2", "-", "m\[Theta]2O2"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Show", "[", 
           RowBox[{"#", ",", "\[IndentingNewLine]", 
            RowBox[{"ImageSize", "\[Rule]", "Small"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
           "]"}], "&"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"RotateLeft", "[", 
                RowBox[{"#", "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mv2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"RotateLeft", "[", 
                RowBox[{"#", "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "m\[Theta]2O2"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
             RowBox[{"ListPlot", "[", 
              RowBox[{
               RowBox[{"RotateLeft", "[", 
                RowBox[{"#", "-", 
                 RowBox[{"#", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}], ",", 
               RowBox[{"DataRange", "\[Rule]", 
                RowBox[{"time", "[", 
                 RowBox[{"[", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
               RowBox[{"Joined", "\[Rule]", "True"}], ",", 
               RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], "&"}], "/@", 
            
            RowBox[{"Map", "[", 
             RowBox[{"Transpose", ",", "mU2O2"}], "]"}]}]}], 
          "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", "2", "}"}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Prepend", "[", 
        RowBox[{
         RowBox[{"plots", "//", "Transpose"}], ",", 
         RowBox[{"Text", "/@", 
          RowBox[{"{", 
           RowBox[{
           "\"\<Kinetic\>\"", ",", "\"\<Thermal\>\"", ",", "\"\<Bulk\>\""}], 
           "}"}]}]}], "]"}], "//", "Grid"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[481]:=",ExpressionUUID->"0e742bd4-4d23-4d68-af0c-fd0abf114a42"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"energy", "=", "energy"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}]}], "}"}], ",", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"time", ",", "pos", ",", "m\[Theta]2O2", ",", "T1", ",", "T2"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"time", "=", 
       RowBox[{"energy", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"time", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "pos", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<no time selected\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"pos", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"time", "=", 
       RowBox[{"pos", "[", "time", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{"pos", ",", 
         RowBox[{"energy", "[", "\"\<m\[Theta]2O2\>\"", "]"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"m\[Theta]2O2", "=", 
       RowBox[{"Map", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Part", "[", 
             RowBox[{"#", ",", "2"}], "]"}], ",", 
            RowBox[{".5", 
             RowBox[{"Plus", "@@", 
              RowBox[{"Part", "[", 
               RowBox[{"#", ",", 
                RowBox[{"3", ";;", "4"}]}], "]"}]}]}]}], "}"}], "&"}], ",", 
         "m\[Theta]2O2", ",", 
         RowBox[{"{", "2", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"T1", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"T2", "=", 
       RowBox[{
        RowBox[{"Chop", "[", 
         RowBox[{"m\[Theta]2O2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "All", ",", "2"}], "]"}], "]"}], "]"}], "/.", 
        RowBox[{"{", 
         RowBox[{"0", "\[Rule]", "Indeterminate"}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Frame", "\[Rule]", "True"}]}], "\[IndentingNewLine]", 
          "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T1", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \(\
\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ListPlot", "[", 
           RowBox[{
            RowBox[{"T2", "/", 
             RowBox[{"T1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ",", 
            RowBox[{"DataRange", "\[Rule]", 
             RowBox[{"time", "[", 
              RowBox[{"[", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], ",", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", 
            RowBox[{
            "FrameLabel", "\[Rule]", 
             "\"\<\\!\\(\!\(\*SubscriptBox[\(T\), \
\(\[UpTee]\)]\)(t)/\!\(\*SubscriptBox[\(T\), \
\(\[DoubleVerticalBar]\)]\)(0)\\)\>\""}], ",", 
            RowBox[{"PlotRange", "\[Rule]", "All"}]}], "]"}]}], 
         "\[IndentingNewLine]", "}"}]}], "//", "Column"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[482]:=",ExpressionUUID->"21b09f7d-d9ed-40e4-aeb5-1a3a6b502bab"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field", "Subsection",ExpressionUUID->"a436870a-14ee-4514-ab23-d7158049409a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<field-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</field\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[483]:=",ExpressionUUID->"e14adafb-0dbe-4b2d-9a5d-ee22232145ca"],

Cell[BoxData[
 RowBox[{
  RowBox[{"field", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importField", "[", "#", "]"}], "&"}], "/@", "files"}], 
           ",", "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<grid\>\"", "->", "grid"}], "}"}], ",", "assoc"}], 
           "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[484]:=",ExpressionUUID->"7a826de1-5d75-4a3f-bae3-cd8388bf118e"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "field"}]], "Input",
 CellLabel->
  "In[485]:=",ExpressionUUID->"2eca83dc-c884-4dbc-a139-9e0b6a41880a"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "max", ",", 
       "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dB2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB2", ",", "dB3"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"ListContourPlot", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[Omega]e", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[CapitalOmega]e", "=", "1"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"k", ",", "_Real"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\[Omega]", ",", "_Real"}], "}"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"k", ",", "\[Omega]", ",", 
                RowBox[{
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[CapitalOmega]e", "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}], 
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "\[CapitalOmega]e"}], "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}]}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"RuntimeAttributes", "\[Rule]", 
               RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
             "]"}]}], "\[IndentingNewLine]", "]"}], "@@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Tuples", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", "\[Omega]t"}], "}"}], "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{
            RowBox[{"Opacity", "[", "1", "]"}], ",", "White", ",", "Dashed", 
            ",", 
            RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Contours", "\[Rule]", 
          RowBox[{"{", "0", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{
          "#", ",", "\[IndentingNewLine]", "plots", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dB\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[486]:=",ExpressionUUID->"df329ad2-349a-41bb-8cce-56855dba723b"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "field"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "12"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE3\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE2\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<dE1\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{"ListContourPlot", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"c", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[Omega]e", "=", 
               RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ",", 
              RowBox[{"\[CapitalOmega]e", "=", "1"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Compile", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"k", ",", "_Real"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"\[Omega]", ",", "_Real"}], "}"}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"k", ",", "\[Omega]", ",", 
                RowBox[{
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{"\[CapitalOmega]e", "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}], 
                 RowBox[{"Subtract", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"c", "^", "2"}], 
                    RowBox[{"k", "^", "2"}]}], ",", 
                   RowBox[{
                    RowBox[{"\[Omega]", "^", "2"}], "+", 
                    RowBox[{"\[Omega]", " ", 
                    RowBox[{
                    RowBox[{"\[Omega]e", "^", "2"}], "/", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"-", "\[CapitalOmega]e"}], "-", "\[Omega]"}], 
                    ")"}]}]}]}]}], "]"}]}]}], "}"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"Parallelization", "\[Rule]", "True"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"RuntimeAttributes", "\[Rule]", 
               RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", 
             "]"}]}], "\[IndentingNewLine]", "]"}], "@@", 
          RowBox[{"Transpose", "[", 
           RowBox[{"Tuples", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", "\[Omega]t"}], "}"}], "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourStyle", "\[Rule]", 
          RowBox[{"Directive", "[", 
           RowBox[{
            RowBox[{"Opacity", "[", "1", "]"}], ",", "White", ",", "Dashed", 
            ",", 
            RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"ContourShading", "\[Rule]", "None"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"Contours", "\[Rule]", 
          RowBox[{"{", "0", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{
          "#", ",", "\[IndentingNewLine]", "plots", ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \(\[UpTee]\), \(2\)]\)/\
\!\(\*SubsuperscriptBox[\(B\), \(0\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(dE\), \
\(\(\[UpTee]\)\(\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(B\), \(0\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[487]:=",ExpressionUUID->"2d0720fb-d1fe-4d62-8067-4597b28fa084"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Moment", "Subsection",ExpressionUUID->"25b4cdaa-5b71-4205-98b3-f92453496c7c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<moment-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "attrs", 
       ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</moment\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[488]:=",ExpressionUUID->"a14ff901-38cc-40ec-886d-03e0b85495ab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"moment", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"metadata", "[", "\"\<files\>\"", "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"Merge", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"importRelativisticMoment", "[", 
              RowBox[{"#", ",", "spid"}], "]"}], "&"}], "/@", "files"}], ",", 
           "Identity"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[489]:=",ExpressionUUID->"b6f1eb1a-5592-45f6-89d6-7b1be172e2f8"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "moment"}]], "Input",
 CellLabel->
  "In[490]:=",ExpressionUUID->"a942df48-763b-4704-9bc4-d775d6ecfe6c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Union", "[", 
   RowBox[{"Chop", "[", 
    RowBox[{"1", "-", 
     RowBox[{"Mean", "/@", 
      RowBox[{"moment", "[", "\"\<n\>\"", "]"}]}]}], "]"}], "]"}], "//", 
  "Short"}]], "Input",
 CellLabel->
  "In[491]:=",ExpressionUUID->"cc8f180e-d58c-453b-831a-8f55e4858d2e"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"field", "[", "\"\<n\>\"", "]"}]}]}], "]"}]}], ",", 
            "2"}], "]"}]}]}], "//", "Log10"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]1\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[492]:=",ExpressionUUID->"6de8c975-c532-4053-a69c-51e694b4577d"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV3\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV2\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<nV1\>\"", "]"}], "/", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \
\(\[DoubleVerticalBar]\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \
\(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\!\(\*SubsuperscriptBox[\(V\), \(\(\[UpTee]\)\(\[UpTee]\
\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[493]:=",ExpressionUUID->"33979527-b4ce-4bda-8215-08bbb5bb6403"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "11"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "n", ",", "max", ",", "plots"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"field", "[", "\"\<n\[Gamma]cc\>\"", "]"}], "/", 
                   RowBox[{
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}], "^", "2"}]}], 
                  "-", 
                  RowBox[{"field", "[", "\"\<n\>\"", "]"}]}], ")"}]}]}], 
              "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", "n", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"n", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"n", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{"ArrayPlot", "[", 
          RowBox[{
           RowBox[{"n", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
           RowBox[{"DataRange", "->", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"kx", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
              RowBox[{"\[Omega]t", "[", 
               RowBox[{"[", 
                RowBox[{"{", 
                 RowBox[{"1", ",", 
                  RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameLabel", "->", 
            RowBox[{"{", 
             RowBox[{
             "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \
\(p\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
             "}"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"Epilog", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"White", ",", 
              RowBox[{"Text", "[", 
               RowBox[{
               "\"\<\[LeftAngleBracket]\[Gamma]\!\(\*SuperscriptBox[\(\
\[RightAngleBracket]\), \(2\)]\)\>\"", ",", 
                RowBox[{"Scaled", "[", 
                 RowBox[{"{", 
                  RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], "}"}]}]}],
           "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[494]:=",ExpressionUUID->"694282ac-8b50-468d-bac9-fc573422def2"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"field", "=", "moment"}], ",", 
     RowBox[{"tlim", "=", 
      RowBox[{"Interval", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Infinity"}], "}"}], "]"}]}], ",", 
     RowBox[{"kmax", "=", "10"}], ",", 
     RowBox[{"\[Omega]max", "=", "16"}], ",", 
     RowBox[{"decade", "=", "10"}], ",", "\[IndentingNewLine]", 
     RowBox[{"f", "=", 
      RowBox[{"Function", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Nx", ",", "Dx"}], "}"}], ",", 
        RowBox[{"N", "@", 
         RowBox[{"Times", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Range", "[", "Nx", "]"}], "-", "1"}], "/.", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"$_Integer", "/;", 
               RowBox[{"$", "\[GreaterEqual]", 
                RowBox[{"Nx", "/", "2"}]}]}], "\[RuleDelayed]", 
              RowBox[{"$", "-", "Nx"}]}], "}"}]}], ",", 
           RowBox[{"2", 
            RowBox[{"Pi", "/", 
             RowBox[{"(", 
              RowBox[{"Nx", " ", "Dx"}], ")"}]}]}]}], "]"}]}]}], "]"}]}]}], 
    "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "t", ",", "post", ",", "kx", ",", "posk", ",", "\[Omega]t", ",", 
       "pos\[Omega]", ",", "w", ",", "dB3", ",", "dB2", ",", "dB1", ",", 
       "max", ",", "plots"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t", "=", 
       RowBox[{"field", "[", "\"\<time\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"Position", "[", 
        RowBox[{"t", ",", 
         RowBox[{"$_Real", "/;", 
          RowBox[{"IntervalMemberQ", "[", 
           RowBox[{"tlim", ",", "$"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"post", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "post", "]"}], "\[LessEqual]", "1"}], ",", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Print", "[", "\"\<out of tlim\>\"", "]"}], ";", 
           RowBox[{"Abort", "[", "]"}]}], ")"}], ",", 
         RowBox[{"post", "//", "Extract"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"t", "=", 
       RowBox[{"t", "//", "post"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"kx", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"field", "[", "\"\<Nx\>\"", "]"}], ",", 
         RowBox[{"field", "[", "\"\<Dx\>\"", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"kx", ",", "posk"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"kx", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "kx", "]"}], "]"}]}], "}"}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", "kmax"}]}], ",",
             "_Integer"}], "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"posk", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "posk"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Omega]t", "=", 
       RowBox[{"f", "[", 
        RowBox[{
         RowBox[{"t", "//", "Length"}], ",", 
         RowBox[{"Subtract", "@@", 
          RowBox[{"t", "[", 
           RowBox[{"[", 
            RowBox[{"{", 
             RowBox[{"2", ",", "1"}], "}"}], "]"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[Omega]t", ",", "pos\[Omega]"}], "}"}], "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"Cases", "[", 
         RowBox[{
          RowBox[{"Sort", "[", 
           RowBox[{"Thread", "[", 
            RowBox[{"{", 
             RowBox[{"\[Omega]t", ",", 
              RowBox[{"Range", "[", 
               RowBox[{"Length", "[", "\[Omega]t", "]"}], "]"}]}], "}"}], 
            "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"$_Real", "?", "Positive"}], "/;", 
             RowBox[{
              RowBox[{"Abs", "[", "$", "]"}], "\[LessEqual]", 
              "\[Omega]max"}]}], ",", "_Integer"}], "}"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos\[Omega]", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"List", "/@", "pos\[Omega]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"w", "=", 
       RowBox[{"HannWindow", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"Length", "[", "t", "]"}], "]"}], "/", 
          RowBox[{"Length", "[", "t", "]"}]}], "-", ".5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<n\[Gamma]v3c\>\"", "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"field", "[", "\"\<n\>\"", "]"}], 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ")"}]}], 
                 ")"}]}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<n\[Gamma]v2c\>\"", "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"field", "[", "\"\<n\>\"", "]"}], 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ")"}]}], 
                 ")"}]}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{"posk", "/@", 
         RowBox[{"pos\[Omega]", "@", 
          RowBox[{"Power", "[", 
           RowBox[{
            RowBox[{"Abs", "@", 
             RowBox[{"Fourier", "[", 
              RowBox[{"w", "*", 
               RowBox[{"post", "@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"field", "[", "\"\<n\[Gamma]v1c\>\"", "]"}], "/", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"field", "[", "\"\<n\>\"", "]"}], 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], ")"}]}], 
                 ")"}]}]}], "]"}]}], ",", "2"}], "]"}]}]}], "//", "Log10"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"max", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"dB1", ",", "dB2", ",", "dB3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dB3", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB3", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB2", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB2", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"dB1", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"dB1", "-", "max"}], ")"}], "/", "decade"}], "+", "1"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"plots", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Show", "[", 
          RowBox[{"#", ",", "\[IndentingNewLine]", 
           RowBox[{"Graphics", "[", 
            RowBox[{"{", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"Dashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", 
                    RowBox[{"field", "[", "\"\<c\>\"", "]"}]}], "}"}]}], 
                 "]"}]}], "}"}], ",", "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"DotDashed", ",", "White", ",", 
                RowBox[{"InfiniteLine", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"1", ",", "1"}], "}"}]}], "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "}"}], "]"}], ",", "\[IndentingNewLine]", 
           
           RowBox[{"BaseStyle", "\[Rule]", "13"}], ",", "\[IndentingNewLine]", 
           RowBox[{"ImageSize", "\[Rule]", "400"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"FrameTicks", "\[Rule]", "Automatic"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"AspectRatio", "\[Rule]", 
            RowBox[{"\[Omega]max", "/", "kmax"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"PlotRangePadding", "\[Rule]", 
            RowBox[{"Thread", "[", 
             RowBox[{"Scaled", "[", 
              RowBox[{".01", 
               RowBox[{"{", 
                RowBox[{"1", ",", 
                 RowBox[{"1", "/", 
                  RowBox[{"(", 
                   RowBox[{"\[Omega]max", "/", "kmax"}], ")"}]}]}], "}"}]}], 
              "]"}], "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"PlotRange", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "kmax"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Omega]max"}], "}"}]}], "}"}]}]}], 
          "\[IndentingNewLine]", "]"}], "&"}], "/@", 
        RowBox[{"{", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB1", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[DoubleVerticalBar]\
\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB2", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\[UpTee]\), \
\(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"ArrayPlot", "[", 
           RowBox[{
            RowBox[{"dB3", "//", "Reverse"}], ",", "\[IndentingNewLine]", 
            RowBox[{"DataRange", "->", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"kx", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}], ",", 
               RowBox[{"\[Omega]t", "[", 
                RowBox[{"[", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", 
                   RowBox[{"-", "1"}]}], "}"}], "]"}], "]"}]}], "}"}]}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunction", "\[Rule]", "\"\<Rainbow\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"ColorFunctionScaling", "\[Rule]", "False"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"FrameLabel", "->", 
             RowBox[{"{", 
              RowBox[{
              "\"\<\\!\\(\[Omega]/\!\(\*SubscriptBox[\(\[CapitalOmega]\), \(p\
\)]\)\\)\>\"", ",", "\"\<\\!\\(k\[VeryThinSpace]c/\[Omega]\\_p\\)\>\""}], 
              "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"Epilog", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"White", ",", 
               RowBox[{"Text", "[", 
                RowBox[{
                "\"\<|\[LeftAngleBracket]\!\(\*FractionBox[\(\[Gamma]v\), \(n\
\)]\)\!\(\*SubsuperscriptBox[\(\[RightAngleBracket]\), \(\(\[UpTee]\)\(\
\[UpTee]\)\), \(2\)]\)/\!\(\*SubsuperscriptBox[\(v\), \(A\), \(2\)]\)|\>\"", 
                 ",", 
                 RowBox[{"Scaled", "[", 
                  RowBox[{"{", 
                   RowBox[{".05", ",", ".95"}], "}"}], "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"-", "1"}], ",", "1"}], "}"}]}], "]"}]}], 
              "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
         "\[IndentingNewLine]", "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Legended", "[", 
       RowBox[{
        RowBox[{"Row", "[", "plots", "]"}], ",", 
        RowBox[{"Placed", "[", 
         RowBox[{
          RowBox[{"BarLegend", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"\"\<Rainbow\>\"", ",", 
              RowBox[{"max", "+", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "decade"}], ",", "0"}], "}"}]}]}], "}"}], ",", 
            RowBox[{"LegendMarkerSize", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{"180", ",", "10"}], "}"}]}], ",", 
            RowBox[{"LegendMargins", "\[Rule]", "0"}], ",", 
            RowBox[{"LegendLayout", "\[Rule]", "\"\<Row\>\""}]}], "]"}], ",", 
          "Above"}], "]"}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[495]:=",ExpressionUUID->"c3279fd6-7a89-4667-b1ea-7135457e04a2"]
}, Open  ]],

Cell[CellGroupData[{

Cell["VHist", "Subsection",ExpressionUUID->"cae9e62b-dbf6-4d84-baa5-23c4f578ba9e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<gvhist2d-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</gvhist2d\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[496]:=",ExpressionUUID->"e45ed864-7a95-4173-a3f9-3db148e32dab"],

Cell[BoxData[
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticVHistogram", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[497]:=",ExpressionUUID->"99046abf-c62d-4b1e-bed5-9d55557cbe68"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "vhist"}]], "Input",
 CellLabel->
  "In[498]:=",ExpressionUUID->"116e5ab8-eae2-4052-8b99-c1b26817a349"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"dv1", ",", "dv2", ",", "x1", ",", "x2"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dv1", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<gv1lim\>\"", "]"}]}], "]"}]}], "/", 
        RowBox[{"vhist", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<gvdims\>\"", ",", "1"}], "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"dv2", "=", 
       RowBox[{
        RowBox[{"-", "2"}], "\[Pi]", " ", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Subtract", ",", 
           RowBox[{"vhist", "[", "\"\<gv2lim\>\"", "]"}]}], "]"}], "/", 
         RowBox[{"vhist", "[", 
          RowBox[{"[", 
           RowBox[{"\"\<gvdims\>\"", ",", "2"}], "]"}], "]"}]}], 
        RowBox[{"vhist", "[", "\"\<\[Gamma]v2\>\"", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<\[Gamma]v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<\[Gamma]v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Total", "[", 
                    RowBox[{"dv2", "#"}], "]"}], "&"}], "/@", 
                  RowBox[{"vhist", "[", "\"\<fpsd\>\"", "]"}]}], ")"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<vpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<wpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{"dv1", " ", 
                RowBox[{"Total", "[", 
                 RowBox[{"vhist", "[", "\"\<fpsd\>\"", "]"}], "]"}], 
                "\[Beta]"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[499]:=",ExpressionUUID->"45608c94-8031-4053-ae21-cae84a9750ac"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Particle", "Subsection",ExpressionUUID->"3dba5668-cca4-4768-8aba-8fa9ceb4b607"],

Cell[BoxData[
 RowBox[{
  RowBox[{"metadata", "=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"files", "=", 
        RowBox[{"FileNames", "[", 
         RowBox[{"\"\<particle-*.h5\>\"", ",", "wd"}], "]"}]}], ",", "names", 
       ",", "attrs", ",", "steps", ",", "times", ",", "pos"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"attrs", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"Import", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
            "\"\<HDF5\>\"", ",", "\"\<Attributes\>\"", ",", 
             "\"\</particle\>\""}], "}"}]}], "]"}], "&"}], "/@", "files"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<step\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{
        RowBox[{"Lookup", "[", "\"\<time\>\"", "]"}], "/@", "attrs"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"List", "/@", 
        RowBox[{"Range", "[", 
         RowBox[{"Length", "[", "times", "]"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"pos", "=", 
       RowBox[{"First", "/@", 
        RowBox[{"SortBy", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{"{", 
            RowBox[{"pos", ",", "times"}], "}"}], "]"}], ",", "Last"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"steps", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"steps", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"times", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"times", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"files", "=", 
       RowBox[{"Extract", "[", 
        RowBox[{"files", ",", "pos"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Association", "[", 
       RowBox[{
        RowBox[{"\"\<attr\>\"", "->", 
         RowBox[{"KeyDrop", "[", 
          RowBox[{
           RowBox[{"First", "[", "attrs", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"\"\<step\>\"", ",", "\"\<time\>\""}], "}"}]}], "]"}]}], 
        ",", 
        RowBox[{"\"\<step\>\"", "->", "steps"}], ",", 
        RowBox[{"\"\<time\>\"", "->", "times"}], ",", 
        RowBox[{"\"\<files\>\"", "->", "files"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[500]:=",ExpressionUUID->"7aa37f5c-401f-4f55-beb7-9478ca483a5e"],

Cell[BoxData[
 RowBox[{
  RowBox[{"particle", "=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"file", "=", 
        RowBox[{"metadata", "[", 
         RowBox[{"[", 
          RowBox[{"\"\<files\>\"", ",", 
           RowBox[{"-", "1"}]}], "]"}], "]"}]}], ",", 
       RowBox[{"attr", "=", 
        RowBox[{"metadata", "[", "\"\<attr\>\"", "]"}]}], ",", 
       RowBox[{"spid", "=", "1"}]}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"assoc", ",", "grid"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"assoc", "=", 
         RowBox[{"importRelativisticParticle", "[", 
          RowBox[{"file", ",", "spid"}], "]"}]}], ";", "\[IndentingNewLine]", 
        
        RowBox[{"grid", "=", 
         RowBox[{
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", 
            RowBox[{
             RowBox[{"attr", "[", "\"\<Nx\>\"", "]"}], "-", "1"}]}], "]"}], 
          RowBox[{"attr", "[", "\"\<Dx\>\"", "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Merge", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"attr", ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"\"\<grid\>\"", "->", "grid"}], ",", 
              RowBox[{"\"\<spid\>\"", "->", "spid"}]}], "}"}], ",", "assoc"}],
            "}"}], ",", "Last"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellLabel->
  "In[501]:=",ExpressionUUID->"d6cd92c3-a5a5-430c-8b65-25912837f824"],

Cell[BoxData[
 RowBox[{"Dimensions", "/@", "particle"}]], "Input",
 CellLabel->
  "In[502]:=",ExpressionUUID->"50094081-223d-4222-a6eb-c4036f0a3cc4"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"vhist", "=", 
   RowBox[{"calMomentumHistogram", "[", 
    RowBox[{"particle", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{".4", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "1"}], ",", "1"}], "}"}], "]"}]}], ",", "150"}], 
      "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{".4", 
        RowBox[{"Interval", "[", 
         RowBox[{"{", 
          RowBox[{"0", ",", "1"}], "}"}], "]"}]}], ",", 
       RowBox[{"150", "/", "2"}]}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "/@", "vhist"}]}], "Input",
 CellLabel->
  "In[503]:=",ExpressionUUID->"6d7ffbe1-5532-4be6-8bba-3b71dffcc6e9"],

Cell[BoxData[
 RowBox[{"With", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{"vhist", "=", "vhist"}], ",", 
     RowBox[{"\[Beta]", "=", ".01"}]}], "}"}], ",", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"x1", ",", "x2"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"x1", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<\[Gamma]v1\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x2", "=", 
       RowBox[{
        RowBox[{"vhist", "[", "\"\<\[Gamma]v2\>\"", "]"}], "/", 
        RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", 
             SqrtBox["\[Pi]"]}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x1", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x1", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df1\>\"", "]"}], 
                RowBox[{"Sqrt", "[", "\[Beta]", "]"}]}]}], "}"}], "]"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<f2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Plot", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Exp", "[", 
              RowBox[{"-", 
               RowBox[{"x", "^", "2"}]}], "]"}], "/", "\[Pi]"}], ",", 
            RowBox[{"{", 
             RowBox[{"x", ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", 
              RowBox[{"x2", "[", 
               RowBox[{"[", 
                RowBox[{"-", "1"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", 
              RowBox[{"Red", ",", "Dashed", ",", 
               RowBox[{"Thickness", "[", "Medium", "]"}]}], "]"}]}]}], "]"}], 
          ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Thread", "[", 
             RowBox[{"{", 
              RowBox[{"x2", ",", 
               RowBox[{
                RowBox[{"vhist", "[", "\"\<df2\>\"", "]"}], "\[Beta]"}]}], 
              "}"}], "]"}], ",", "\[IndentingNewLine]", 
            RowBox[{"Joined", "\[Rule]", "True"}], ",", "\[IndentingNewLine]", 
            RowBox[{"PlotStyle", "\[Rule]", 
             RowBox[{"Directive", "[", "Black", "]"}]}]}], 
           "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"BaseStyle", "->", "13"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Axes", "->", "False"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Frame", "->", "True"}], ",", "\[IndentingNewLine]", 
          RowBox[{"ImageSize", "->", "Medium"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "]"}]], "Input",
 CellLabel->
  "In[505]:=",ExpressionUUID->"a0fa3665-c9bb-4343-9eec-1428c9a9f953"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1468, 1047},
WindowMargins->{{Automatic, 534}, {Automatic, 14}},
FrontEndVersion->"13.0 for Mac OS X x86 (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"13c7468d-72b3-4754-a7ae-58931f6d390a"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 276, 6, 52, "Input",ExpressionUUID->"35414358-9cce-404a-b33a-abdb7a6986c5"],
Cell[837, 28, 259, 7, 30, "Input",ExpressionUUID->"98642d0f-5832-45f9-b8ed-04467496a470"],
Cell[1099, 37, 240, 6, 30, "Input",ExpressionUUID->"7640abcc-40a3-4b02-a665-ad3c9af5d4f1"],
Cell[CellGroupData[{
Cell[1364, 47, 90, 0, 67, "Section",ExpressionUUID->"bd9e0fb1-f60e-440c-ae11-8afbfd84c89a"],
Cell[CellGroupData[{
Cell[1479, 51, 83, 0, 54, "Subsection",ExpressionUUID->"9328d8c3-7478-4f1e-9afb-f4bf737dba27"],
Cell[1565, 53, 3492, 85, 304, "Input",ExpressionUUID->"da1286ec-9f7b-491b-a8bd-6f40f49e4617"],
Cell[5060, 140, 147, 3, 30, "Input",ExpressionUUID->"4a4d5bc8-df05-4bee-9876-65faf35a30f2"],
Cell[5210, 145, 5538, 134, 451, "Input",ExpressionUUID->"b463ea84-bb2b-4087-a343-40324ab51aba"],
Cell[10751, 281, 4932, 121, 493, "Input",ExpressionUUID->"a7040f13-bde1-4f17-84d9-7827296b064f"],
Cell[15686, 404, 5389, 136, 493, "Input",ExpressionUUID->"9344cfc9-726a-4cc3-88d7-d0c192809383"],
Cell[21078, 542, 4941, 128, 409, "Input",ExpressionUUID->"be113b05-7cc3-4156-8f16-2519b53baf8e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[26056, 675, 82, 0, 54, "Subsection",ExpressionUUID->"fd9a5f6e-0e35-4373-b5d5-25cd03f7d29c"],
Cell[26141, 677, 2532, 67, 241, "Input",ExpressionUUID->"ae214f32-ca01-4b97-b2b5-745ae699f687"],
Cell[28676, 746, 1497, 41, 157, "Input",ExpressionUUID->"33d2fe09-8078-4246-91a7-81e88b6912ba"],
Cell[30176, 789, 146, 3, 30, "Input",ExpressionUUID->"a60b0f38-675f-4b5f-a9ea-10ea525c8aac"],
Cell[30325, 794, 16873, 417, 1340, "Input",ExpressionUUID->"8695e2ae-2018-47d6-9b39-4b21c64db11e"],
Cell[47201, 1213, 19442, 479, 1537, "Input",ExpressionUUID->"0959faeb-2e1d-4407-9152-06ae1cece027"]
}, Open  ]],
Cell[CellGroupData[{
Cell[66680, 1697, 83, 0, 54, "Subsection",ExpressionUUID->"4f30b4b7-cb77-487a-bb75-6368f93240c0"],
Cell[66766, 1699, 2534, 67, 241, "Input",ExpressionUUID->"1e886e48-bed1-46ec-b0e8-f2f660cd1483"],
Cell[69303, 1768, 1657, 44, 157, "Input",ExpressionUUID->"7ae9cbf8-eafa-4a4c-8430-8df65d45cce1"],
Cell[70963, 1814, 147, 3, 30, "Input",ExpressionUUID->"ac8acd25-61b5-406b-ab7a-4fe3c6db448f"],
Cell[71113, 1819, 304, 9, 30, "Input",ExpressionUUID->"89136b45-8d01-4d01-83cc-c39b176723d6"],
Cell[71420, 1830, 9853, 252, 786, "Input",ExpressionUUID->"76f671ce-1399-4c93-a171-de4e0bc69396"],
Cell[81276, 2084, 16559, 412, 1264, "Input",ExpressionUUID->"d2c67ddc-74c2-4aba-afe5-799468bb6108"]
}, Open  ]],
Cell[CellGroupData[{
Cell[97872, 2501, 82, 0, 54, "Subsection",ExpressionUUID->"c62a2b35-b85e-461b-a3cd-0bca6d485abb"],
Cell[97957, 2503, 2550, 67, 241, "Input",ExpressionUUID->"eb47d246-5c37-4620-abb5-43974ec28eed"],
Cell[100510, 2572, 1597, 43, 157, "Input",ExpressionUUID->"adc197a7-fecd-4e0e-8e35-8b304f12c1f0"],
Cell[102110, 2617, 146, 3, 30, "Input",ExpressionUUID->"a1064c17-854d-4b30-b856-eac97f80127f"],
Cell[102259, 2622, 13128, 293, 1836, "Input",ExpressionUUID->"e2a14dd3-bdb6-489b-bcb3-2f016cc53cef"]
}, Open  ]],
Cell[CellGroupData[{
Cell[115424, 2920, 85, 0, 54, "Subsection",ExpressionUUID->"c6414af0-f2aa-48eb-a4d5-07defec83b5e"],
Cell[115512, 2922, 2552, 67, 241, "Input",ExpressionUUID->"566300fc-abb6-4a73-9f21-67e72a12c626"],
Cell[118067, 2991, 1598, 43, 157, "Input",ExpressionUUID->"f3472e2a-0268-4bb8-82ff-37827c5d7cbf"],
Cell[119668, 3036, 149, 3, 30, "Input",ExpressionUUID->"d2f972fb-8132-4b79-8719-2bd2dc0fbd4c"],
Cell[119820, 3041, 737, 23, 52, "Input",ExpressionUUID->"e3c8210a-f163-48f6-ac28-02b2f0f712bb"],
Cell[120560, 3066, 6482, 139, 1206, "Input",ExpressionUUID->"cfcbf234-37ed-445a-81c4-0c90c90f4929"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[127091, 3211, 86, 0, 53, "Section",ExpressionUUID->"fc84090a-4548-4414-861e-25b4429b11c4"],
Cell[CellGroupData[{
Cell[127202, 3215, 83, 0, 54, "Subsection",ExpressionUUID->"92e034cd-5112-4739-b1c7-fcf2c92f83f2"],
Cell[127288, 3217, 3492, 85, 304, "Input",ExpressionUUID->"a6b4b1f3-a8d9-4acf-bd1f-a174eb32a547"],
Cell[130783, 3304, 147, 3, 30, "Input",ExpressionUUID->"ddeb07b4-9a5c-42b5-b450-76d0ee1eaf21"],
Cell[130933, 3309, 5577, 135, 451, "Input",ExpressionUUID->"1f00daeb-249f-409c-850d-3fb5cbfd3898"],
Cell[136513, 3446, 5058, 124, 493, "Input",ExpressionUUID->"3d3a1964-183a-4f5a-ac33-ce0c54fb3db6"],
Cell[141574, 3572, 5551, 139, 493, "Input",ExpressionUUID->"0e742bd4-4d23-4d68-af0c-fd0abf114a42"],
Cell[147128, 3713, 5048, 131, 409, "Input",ExpressionUUID->"21b09f7d-d9ed-40e4-aeb5-1a3a6b502bab"]
}, Open  ]],
Cell[CellGroupData[{
Cell[152213, 3849, 82, 0, 54, "Subsection",ExpressionUUID->"a436870a-14ee-4514-ab23-d7158049409a"],
Cell[152298, 3851, 2532, 67, 241, "Input",ExpressionUUID->"e14adafb-0dbe-4b2d-9a5d-ee22232145ca"],
Cell[154833, 3920, 1497, 41, 157, "Input",ExpressionUUID->"7a826de1-5d75-4a3f-bae3-cd8388bf118e"],
Cell[156333, 3963, 146, 3, 30, "Input",ExpressionUUID->"2eca83dc-c884-4dbc-a139-9e0b6a41880a"],
Cell[156482, 3968, 16873, 417, 1340, "Input",ExpressionUUID->"df329ad2-349a-41bb-8cce-56855dba723b"],
Cell[173358, 4387, 19442, 479, 1537, "Input",ExpressionUUID->"2d0720fb-d1fe-4d62-8067-4597b28fa084"]
}, Open  ]],
Cell[CellGroupData[{
Cell[192837, 4871, 83, 0, 54, "Subsection",ExpressionUUID->"25b4cdaa-5b71-4205-98b3-f92453496c7c"],
Cell[192923, 4873, 2534, 67, 241, "Input",ExpressionUUID->"a14ff901-38cc-40ec-886d-03e0b85495ab"],
Cell[195460, 4942, 1669, 44, 157, "Input",ExpressionUUID->"b6f1eb1a-5592-45f6-89d6-7b1be172e2f8"],
Cell[197132, 4988, 147, 3, 30, "Input",ExpressionUUID->"a942df48-763b-4704-9bc4-d775d6ecfe6c"],
Cell[197282, 4993, 304, 9, 30, "Input",ExpressionUUID->"cc8f180e-d58c-453b-831a-8f55e4858d2e"],
Cell[197589, 5004, 9879, 253, 786, "Input",ExpressionUUID->"6de8c975-c532-4053-a69c-51e694b4577d"],
Cell[207471, 5259, 16559, 412, 1264, "Input",ExpressionUUID->"33979527-b4ce-4bda-8215-08bbb5bb6403"],
Cell[224033, 5673, 10195, 261, 786, "Input",ExpressionUUID->"694282ac-8b50-468d-bac9-fc573422def2"],
Cell[234231, 5936, 17256, 424, 1368, "Input",ExpressionUUID->"c3279fd6-7a89-4667-b1ea-7135457e04a2"]
}, Open  ]],
Cell[CellGroupData[{
Cell[251524, 6365, 82, 0, 54, "Subsection",ExpressionUUID->"cae9e62b-dbf6-4d84-baa5-23c4f578ba9e"],
Cell[251609, 6367, 2552, 67, 241, "Input",ExpressionUUID->"e45ed864-7a95-4173-a3f9-3db148e32dab"],
Cell[254164, 6436, 1609, 43, 157, "Input",ExpressionUUID->"99046abf-c62d-4b1e-bed5-9d55557cbe68"],
Cell[255776, 6481, 146, 3, 30, "Input",ExpressionUUID->"116e5ab8-eae2-4052-8b99-c1b26817a349"],
Cell[255925, 6486, 13156, 293, 1836, "Input",ExpressionUUID->"45608c94-8031-4053-ae21-cae84a9750ac"]
}, Open  ]],
Cell[CellGroupData[{
Cell[269118, 6784, 85, 0, 54, "Subsection",ExpressionUUID->"3dba5668-cca4-4768-8aba-8fa9ceb4b607"],
Cell[269206, 6786, 2552, 67, 241, "Input",ExpressionUUID->"7aa37f5c-401f-4f55-beb7-9478ca483a5e"],
Cell[271761, 6855, 1610, 43, 157, "Input",ExpressionUUID->"d6cd92c3-a5a5-430c-8b65-25912837f824"],
Cell[273374, 6900, 149, 3, 30, "Input",ExpressionUUID->"50094081-223d-4222-a6eb-c4036f0a3cc4"],
Cell[273526, 6905, 737, 23, 52, "Input",ExpressionUUID->"6d7ffbe1-5532-4be6-8bba-3b71dffcc6e9"],
Cell[274266, 6930, 6498, 139, 1206, "Input",ExpressionUUID->"a0fa3665-c9bb-4343-9eec-1428c9a9f953"]
}, Open  ]]
}, Open  ]]
}
]
*)

